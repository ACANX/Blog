<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#33363b">
    <meta name="msapplication-TileColor" content="#33363b">
    
    
    
    
    <meta name="keywords" content="ACANX, 面朝大海, Java">
    
    
    <link rel="apple-touch-icon" sizes="180x180" href="/Blog/favicons/apple-touch-icon.png">
    
    
    <link rel="icon" type="image/png" sizes="192x192" href="/Blog/favicons/android-chrome-192x192.png">
    
    
    <link rel="icon" type="image/png" sizes="32x32" href="/Blog/favicons/favicon-32x32.png">
    
    
    <link rel="icon" type="image/png" sizes="16x16" href="/Blog/favicons/favicon-16x16.png">
    
    
    <link rel="mask-icon" href="/Blog/favicons/safari-pinned-tab.svg" color="#33363b">
    
    
    <link rel="manifest" href="/Blog/favicons/site.webmanifest">
    
    
    <meta name="msapplication-config" content="/Blog/favicons/browserconfig.xml">
    
    
    <link rel="alternate" href="/Blog/atom.xml" title="面朝大海" type="application/atom+xml" />
    
    
    <link rel="shortcut icon" type="image/x-icon" href="/Blog/favicons/favicon.ico">
    
    
    <link rel="stylesheet" type="text/css" href="/Blog/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/Blog/css/index.css">
    
    <link rel="stylesheet" type="text/css" href="/Blog/css/sidebar.css">
    
    
<link rel="stylesheet" type="text/css" href="/Blog/css/page.css">
<link rel="stylesheet" type="text/css" href="/Blog/css/post.css">

    <link rel="stylesheet" type="text/css" href="/Blog/css/custom.css">
    <link rel="stylesheet" type="text/css" href="/Blog/css/atom-one-dark.css">
    <link rel="stylesheet" type="text/css" href="/Blog/css/lightgallery.min.css">
    <script type="text/javascript" src="/Blog/js/jquery.min.js"></script>
    <script defer type="text/javascript" src="/Blog/js/util.js"></script>
    <script defer type="text/javascript" src="/Blog/js/clipboard.min.js"></script>
    <script defer type="text/javascript" src="/Blog/js/scrollspy.js"></script>
    <script defer type="text/javascript" src="/Blog/js/fontawesome-all.min.js"></script>
    <script defer type="text/javascript" src="/Blog/js/lightgallery.min.js"></script>
    <script defer type="text/javascript" src="/Blog/js/lg-fullscreen.min.js"></script>
    <script defer type="text/javascript" src="/Blog/js/lg-hash.min.js"></script>
    <script defer type="text/javascript" src="/Blog/js/lg-pager.min.js"></script>
    <script defer type="text/javascript" src="/Blog/js/lg-thumbnail.min.js"></script>
    <script defer type="text/javascript" src="/Blog/js/lg-zoom.min.js"></script>
    
    <script defer src="/Blog/js/busuanzi.pure.mini.js"></script>
    
    
    <script defer type="text/javascript" src="/Blog/js/search.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      var searchPath = "search.xml";
      if (searchPath.length === 0) {
        searchPath = "search.xml";
      }
      var path = "/Blog/" + searchPath;
      searchFunc(path, "search-input", "search-result");
    });
    </script>
    
    
    <script defer type="text/javascript" src="/Blog/js/index.js"></script>
    <script type="text/javascript">
    $(document).ready(function () {
      var cb = null;
      var els = $(".post figure.highlight");
      if (els.length) {
        // Enabled Hexo highlight line number.
        $(els).each(function (i, e) {
          // $(e).before("<button class=\"copy button\">Copy</button>");
          $(e).before([
            "<div class=\"code-titlebar\">",
              "<div class=\"titlebar-left\">",
                "<button class=\"copy\" aria-label=\"Copy\"><i class=\"far fa-copy\"></i></button>",
              "</div>",
              "<div class=\"titlebar-center\">",
                "code",
              "</div>",
              "<div class=\"titlebar-right\">",
                "<button class=\"button-dot dot-minimize\" aria-label=\"Decoration\"></button>",
                "<button class=\"button-dot dot-maximize\" aria-label=\"Decoration\"></button>",
                "<button class=\"button-dot dot-close\" aria-label=\"Decoration\"></button>",
              "</div>",
            "</div>"
          ].join(""));
        });
        cb = new ClipboardJS("button.copy", {
          "target": function (trigger) {
              // Get target element by DOM API.
              return trigger.parentNode.parentNode.nextElementSibling.firstChild.firstChild.firstChild.lastChild.firstChild.firstChild;
          }
        });
      } else {
        // Disabled Hexo highlight line number.
        els = $(".post pre code");
        $(els).each(function (i, e) {
          // Add button before pre, not code.
          // $(e).parent().before("<button class=\"copy button\">Copy</button>");
          $(e).before([
            "<div class=\"code-titlebar\">",
              "<div class=\"titlebar-left\">",
                "<button class=\"copy\" aria-label=\"Copy\"><i class=\"far fa-copy\"></i></button>",
              "</div>",
              "<div class=\"titlebar-center\">",
                "code",
              "</div>",
              "<div class=\"titlebar-right\">",
                "<button class=\"button-dot dot-minimize\" aria-label=\"Decoration\"></button>",
                "<button class=\"button-dot dot-maximize\" aria-label=\"Decoration\"></button>",
                "<button class=\"button-dot dot-close\" aria-label=\"Decoration\"></button>",
              "</div>",
            "</div>"
          ].join(""));
        });
        cb = new ClipboardJS("button.copy", {
          "target": function (trigger) {
              // Get target element by DOM API.
              return trigger.parentNode.parentNode.nextElementSibling;
          }
        });
      }
      cb.on("success", function (e) {
        e.clearSelection();
        var trigger = e.trigger;
        // Change button text as a user tip.
        trigger.innerHTML = "<i class=\"far fa-check-square\"></i>";
        $(trigger).addClass("copied");
        // Change button text back;
        setTimeout(function () {
          trigger.innerHTML = "<i class=\"far fa-copy\"></i>";
          $(trigger).removeClass("copied");
        }, 1500);
      });
    });
    </script>
    
    <script defer type="text/javascript" src="/Blog/js/custom.js"></script>
    <title>Spring-IoC容器源码导读 | 面朝大海 - ACANX</title>
  <meta name="generator" content="Hexo 5.4.0"></head>
  <body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"  data-spy="scroll" data-target=".list-group">
    
<header id="header" class="header" style="background: #33363b;">
  <div class="container">
    <div class="header-container">
      <div class="header-title">
        <h1 class="title"><a href="/Blog/">面朝大海</a></h1>
        <h2 class="subtitle">ACANX</h2>
      </div>
      
      <div class="logo">
        <img src="/Blog/images/logo.png" alt="logo">
      </div>
      
    </div>
    <nav id="nav" class="nav">
      <a id="nav-toggle" class="nav-toggle" aria-hidden="true"><i class="fas fa-bars" aria-label="Toggle Navbar"></i></a>
      <ul id="menu" role="menubar" aria-hidden="false">
        
        <li role="menuitem"><a href="/Blog/"><i class="fas fa-home"></i><span class="menu-text">首页</span></a></li>
        
        <li role="menuitem"><a href="/Blog/archives/"><i class="fas fa-archive"></i><span class="menu-text">归档</span></a></li>
        
        <li role="menuitem"><a href="/Blog/categories/"><i class="fas fa-th-list"></i><span class="menu-text">分类</span></a></li>
        
        <li role="menuitem"><a href="/Blog/tags/"><i class="fas fa-tags"></i><span class="menu-text">标签</span></a></li>
        
        <li role="menuitem"><a href="/Blog/about/"><i class="fas fa-user-edit"></i><span class="menu-text">关于</span></a></li>
        
      </ul>
    </nav>
  </div>
</header>


    <main id="main" class="main">
      <div class="container">
        <div class="main-container">
          <div class="content">
            
<div id="post" class="page">
  
  <article class="article post card" itemscope itemtype="http://schema.org/Article">
    <div class="post-block">
      <link itemprop="mainEntityOfPage" href="https://acanx.gitee.io/Blog/2019/11/22/Spring-IoC%E5%AE%B9%E5%99%A8%E6%BA%90%E7%A0%81%E5%AF%BC%E8%AF%BB/">
      <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
       <meta itemprop="name" content="ACANX">
       <meta itemprop="description" content="面朝大海的静态博客 <a target="_blank" rel="noopener" href="https://blog.acanx.com">另一个博客</a>">
       <meta itemprop="image" content="/Blog/images/avatar.png">
      </span>
      <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
       <meta itemprop="name" content="面朝大海">
      </span>
    </div>
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">Spring-IoC容器源码导读</h1>
      <div class="post-meta">
        
        <span class="post-date">
          <i class="far fa-calendar-plus"></i><span><time title="post-date" itemprop="dateCreated datePublished" datetime="2019-11-22T22:10:48+08:00">2019-11-22 22:10:48</time></span>
        </span>
        
        
        
        <span class="post-meta-divider divider">|</span>
        
        <span class="post-categories">
          
          <i class="far fa-folder-open"></i><span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/Blog/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a></span>
        </span>
        
        
      </div>
    </header>
    <main class="post-main" itemprop="articleBody">
      <h1 id="1-几个重要类-接口"><a href="#1-几个重要类-接口" class="headerlink" title="1.几个重要类/接口"></a>1.几个重要类/接口</h1><h2 id="阅读前的准备"><a href="#阅读前的准备" class="headerlink" title="阅读前的准备"></a>阅读前的准备</h2><ul>
<li>源码下载：<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework">https://github.com/spring-projects/spring-framework</a>  </li>
<li><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-framework.git">https://github.com/spring-projects/spring-framework.git</a></li>
</ul>
</li>
<li>源码版本：v5.2.1.RELEASE</li>
</ul>
<h2 id="1-1-BeanFactory-顶级接口（低配版的IoC容器）"><a href="#1-1-BeanFactory-顶级接口（低配版的IoC容器）" class="headerlink" title="1.1 BeanFactory 顶级接口（低配版的IoC容器）"></a>1.1 BeanFactory 顶级接口（低配版的IoC容器）</h2><h3 id="BeanFactory接口定义说明"><a href="#BeanFactory接口定义说明" class="headerlink" title="BeanFactory接口定义说明"></a>BeanFactory接口定义说明</h3><ul>
<li>BeanFactory是低配版的IoC容器，定义了Ioc容器基本的功能</li>
</ul>
<h3 id="完整版源码："><a href="#完整版源码：" class="headerlink" title="完整版源码："></a>完整版源码：</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Copyright 2002-2019 the original author or authors.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"> * you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"> * You may obtain a copy of the License at</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"> * See the License for the specific language governing permissions and</span><br><span class="hljs-comment"> * limitations under the License.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">package</span> org.springframework.beans.factory;<br><br><span class="hljs-keyword">import</span> org.springframework.beans.BeansException;<br><span class="hljs-keyword">import</span> org.springframework.core.ResolvableType;<br><span class="hljs-keyword">import</span> org.springframework.lang.Nullable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * The root interface for accessing a Spring bean container.</span><br><span class="hljs-comment"> * This is the basic client view of a bean container;</span><br><span class="hljs-comment"> * further interfaces such as &#123;<span class="hljs-doctag">@link</span> ListableBeanFactory&#125; and</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@link</span> org.springframework.beans.factory.config.ConfigurableBeanFactory&#125;</span><br><span class="hljs-comment"> * are available for specific purposes.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;This interface is implemented by objects that hold a number of bean definitions,</span><br><span class="hljs-comment"> * each uniquely identified by a String name. Depending on the bean definition,</span><br><span class="hljs-comment"> * the factory will return either an independent instance of a contained object</span><br><span class="hljs-comment"> * (the Prototype design pattern), or a single shared instance (a superior</span><br><span class="hljs-comment"> * alternative to the Singleton design pattern, in which the instance is a</span><br><span class="hljs-comment"> * singleton in the scope of the factory). Which type of instance will be returned</span><br><span class="hljs-comment"> * depends on the bean factory configuration: the API is the same. Since Spring</span><br><span class="hljs-comment"> * 2.0, further scopes are available depending on the concrete application</span><br><span class="hljs-comment"> * context (e.g. &quot;request&quot; and &quot;session&quot; scopes in a web environment).</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;The point of this approach is that the BeanFactory is a central registry</span><br><span class="hljs-comment"> * of application components, and centralizes configuration of application</span><br><span class="hljs-comment"> * components (no more do individual objects need to read properties files,</span><br><span class="hljs-comment"> * for example). See chapters 4 and 11 of &quot;Expert One-on-One J2EE Design and</span><br><span class="hljs-comment"> * Development&quot; for a discussion of the benefits of this approach.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;Note that it is generally better to rely on Dependency Injection</span><br><span class="hljs-comment"> * (&quot;push&quot; configuration) to configure application objects through setters</span><br><span class="hljs-comment"> * or constructors, rather than use any form of &quot;pull&quot; configuration like a</span><br><span class="hljs-comment"> * BeanFactory lookup. Spring&#x27;s Dependency Injection functionality is</span><br><span class="hljs-comment"> * implemented using this BeanFactory interface and its subinterfaces.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;Normally a BeanFactory will load bean definitions stored in a configuration</span><br><span class="hljs-comment"> * source (such as an XML document), and use the &#123;<span class="hljs-doctag">@code</span> org.springframework.beans&#125;</span><br><span class="hljs-comment"> * package to configure the beans. However, an implementation could simply return</span><br><span class="hljs-comment"> * Java objects it creates as necessary directly in Java code. There are no</span><br><span class="hljs-comment"> * constraints on how the definitions could be stored: LDAP, RDBMS, XML,</span><br><span class="hljs-comment"> * properties file, etc. Implementations are encouraged to support references</span><br><span class="hljs-comment"> * amongst beans (Dependency Injection).</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;In contrast to the methods in &#123;<span class="hljs-doctag">@link</span> ListableBeanFactory&#125;, all of the</span><br><span class="hljs-comment"> * operations in this interface will also check parent factories if this is a</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@link</span> HierarchicalBeanFactory&#125;. If a bean is not found in this factory instance,</span><br><span class="hljs-comment"> * the immediate parent factory will be asked. Beans in this factory instance</span><br><span class="hljs-comment"> * are supposed to override beans of the same name in any parent factory.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;Bean factory implementations should support the standard bean lifecycle interfaces</span><br><span class="hljs-comment"> * as far as possible. The full set of initialization methods and their standard order is:</span><br><span class="hljs-comment"> * &lt;ol&gt;</span><br><span class="hljs-comment"> * &lt;li&gt;BeanNameAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setBeanName&#125;</span><br><span class="hljs-comment"> * &lt;li&gt;BeanClassLoaderAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setBeanClassLoader&#125;</span><br><span class="hljs-comment"> * &lt;li&gt;BeanFactoryAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setBeanFactory&#125;</span><br><span class="hljs-comment"> * &lt;li&gt;EnvironmentAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setEnvironment&#125;</span><br><span class="hljs-comment"> * &lt;li&gt;EmbeddedValueResolverAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setEmbeddedValueResolver&#125;</span><br><span class="hljs-comment"> * &lt;li&gt;ResourceLoaderAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setResourceLoader&#125;</span><br><span class="hljs-comment"> * (only applicable when running in an application context)</span><br><span class="hljs-comment"> * &lt;li&gt;ApplicationEventPublisherAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setApplicationEventPublisher&#125;</span><br><span class="hljs-comment"> * (only applicable when running in an application context)</span><br><span class="hljs-comment"> * &lt;li&gt;MessageSourceAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setMessageSource&#125;</span><br><span class="hljs-comment"> * (only applicable when running in an application context)</span><br><span class="hljs-comment"> * &lt;li&gt;ApplicationContextAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setApplicationContext&#125;</span><br><span class="hljs-comment"> * (only applicable when running in an application context)</span><br><span class="hljs-comment"> * &lt;li&gt;ServletContextAware&#x27;s &#123;<span class="hljs-doctag">@code</span> setServletContext&#125;</span><br><span class="hljs-comment"> * (only applicable when running in a web application context)</span><br><span class="hljs-comment"> * &lt;li&gt;&#123;<span class="hljs-doctag">@code</span> postProcessBeforeInitialization&#125; methods of BeanPostProcessors</span><br><span class="hljs-comment"> * &lt;li&gt;InitializingBean&#x27;s &#123;<span class="hljs-doctag">@code</span> afterPropertiesSet&#125;</span><br><span class="hljs-comment"> * &lt;li&gt;a custom init-method definition</span><br><span class="hljs-comment"> * &lt;li&gt;&#123;<span class="hljs-doctag">@code</span> postProcessAfterInitialization&#125; methods of BeanPostProcessors</span><br><span class="hljs-comment"> * &lt;/ol&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;On shutdown of a bean factory, the following lifecycle methods apply:</span><br><span class="hljs-comment"> * &lt;ol&gt;</span><br><span class="hljs-comment"> * &lt;li&gt;&#123;<span class="hljs-doctag">@code</span> postProcessBeforeDestruction&#125; methods of DestructionAwareBeanPostProcessors</span><br><span class="hljs-comment"> * &lt;li&gt;DisposableBean&#x27;s &#123;<span class="hljs-doctag">@code</span> destroy&#125;</span><br><span class="hljs-comment"> * &lt;li&gt;a custom destroy-method definition</span><br><span class="hljs-comment"> * &lt;/ol&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Rod Johnson</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Juergen Hoeller</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Chris Beams</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 13 April 2001</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> BeanNameAware#setBeanName</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> BeanClassLoaderAware#setBeanClassLoader</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> BeanFactoryAware#setBeanFactory</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.context.ResourceLoaderAware#setResourceLoader</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.context.ApplicationEventPublisherAware#setApplicationEventPublisher</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.context.MessageSourceAware#setMessageSource</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.context.ApplicationContextAware#setApplicationContext</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.web.context.ServletContextAware#setServletContext</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.beans.factory.config.BeanPostProcessor#postProcessBeforeInitialization</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> InitializingBean#afterPropertiesSet</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.beans.factory.support.RootBeanDefinition#getInitMethodName</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.beans.factory.config.BeanPostProcessor#postProcessAfterInitialization</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> DisposableBean#destroy</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.beans.factory.support.RootBeanDefinition#getDestroyMethodName</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanFactory</span> </span>&#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Used to dereference a &#123;<span class="hljs-doctag">@link</span> FactoryBean&#125; instance and distinguish it from</span><br><span class="hljs-comment">	 * beans &lt;i&gt;created&lt;/i&gt; by the FactoryBean. For example, if the bean named</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@code</span> myJndiObject&#125; is a FactoryBean, getting &#123;<span class="hljs-doctag">@code</span> &amp;myJndiObject&#125;</span><br><span class="hljs-comment">	 * will return the factory, not the instance returned by the factory.</span><br><span class="hljs-comment">	 */</span><br>	String FACTORY_BEAN_PREFIX = <span class="hljs-string">&quot;&amp;&quot;</span>;<br><br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return an instance, which may be shared or independent, of the specified bean.</span><br><span class="hljs-comment">	 * &lt;p&gt;This method allows a Spring BeanFactory to be used as a replacement for the</span><br><span class="hljs-comment">	 * Singleton or Prototype design pattern. Callers may retain references to</span><br><span class="hljs-comment">	 * returned objects in the case of Singleton beans.</span><br><span class="hljs-comment">	 * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span><br><span class="hljs-comment">	 * Will ask the parent factory if the bean cannot be found in this factory instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to retrieve</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> an instance of the bean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the specified name</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeansException if the bean could not be obtained</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">Object <span class="hljs-title">getBean</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return an instance, which may be shared or independent, of the specified bean.</span><br><span class="hljs-comment">	 * &lt;p&gt;Behaves the same as &#123;<span class="hljs-doctag">@link</span> #getBean(String)&#125;, but provides a measure of type</span><br><span class="hljs-comment">	 * safety by throwing a BeanNotOfRequiredTypeException if the bean is not of the</span><br><span class="hljs-comment">	 * required type. This means that ClassCastException can&#x27;t be thrown on casting</span><br><span class="hljs-comment">	 * the result correctly, as can happen with &#123;<span class="hljs-doctag">@link</span> #getBean(String)&#125;.</span><br><span class="hljs-comment">	 * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span><br><span class="hljs-comment">	 * Will ask the parent factory if the bean cannot be found in this factory instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to retrieve</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> requiredType type the bean must match; can be an interface or superclass</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> an instance of the bean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no such bean definition</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeanNotOfRequiredTypeException if the bean is not of the required type</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeansException if the bean could not be created</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getBean</span><span class="hljs-params">(String name, Class&lt;T&gt; requiredType)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return an instance, which may be shared or independent, of the specified bean.</span><br><span class="hljs-comment">	 * &lt;p&gt;Allows for specifying explicit constructor arguments / factory method arguments,</span><br><span class="hljs-comment">	 * overriding the specified default arguments (if any) in the bean definition.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to retrieve</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> args arguments to use when creating a bean instance using explicit arguments</span><br><span class="hljs-comment">	 * (only applied when creating a new instance as opposed to retrieving an existing one)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> an instance of the bean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no such bean definition</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeanDefinitionStoreException if arguments have been given but</span><br><span class="hljs-comment">	 * the affected bean isn&#x27;t a prototype</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeansException if the bean could not be created</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 2.5</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">Object <span class="hljs-title">getBean</span><span class="hljs-params">(String name, Object... args)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the bean instance that uniquely matches the given object type, if any.</span><br><span class="hljs-comment">	 * &lt;p&gt;This method goes into &#123;<span class="hljs-doctag">@link</span> ListableBeanFactory&#125; by-type lookup territory</span><br><span class="hljs-comment">	 * but may also be translated into a conventional by-name lookup based on the name</span><br><span class="hljs-comment">	 * of the given type. For more extensive retrieval operations across sets of beans,</span><br><span class="hljs-comment">	 * use &#123;<span class="hljs-doctag">@link</span> ListableBeanFactory&#125; and/or &#123;<span class="hljs-doctag">@link</span> BeanFactoryUtils&#125;.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> requiredType type the bean must match; can be an interface or superclass</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> an instance of the single bean matching the required type</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if no bean of the given type was found</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoUniqueBeanDefinitionException if more than one bean of the given type was found</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeansException if the bean could not be created</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 3.0</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> ListableBeanFactory</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getBean</span><span class="hljs-params">(Class&lt;T&gt; requiredType)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return an instance, which may be shared or independent, of the specified bean.</span><br><span class="hljs-comment">	 * &lt;p&gt;Allows for specifying explicit constructor arguments / factory method arguments,</span><br><span class="hljs-comment">	 * overriding the specified default arguments (if any) in the bean definition.</span><br><span class="hljs-comment">	 * &lt;p&gt;This method goes into &#123;<span class="hljs-doctag">@link</span> ListableBeanFactory&#125; by-type lookup territory</span><br><span class="hljs-comment">	 * but may also be translated into a conventional by-name lookup based on the name</span><br><span class="hljs-comment">	 * of the given type. For more extensive retrieval operations across sets of beans,</span><br><span class="hljs-comment">	 * use &#123;<span class="hljs-doctag">@link</span> ListableBeanFactory&#125; and/or &#123;<span class="hljs-doctag">@link</span> BeanFactoryUtils&#125;.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> requiredType type the bean must match; can be an interface or superclass</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> args arguments to use when creating a bean instance using explicit arguments</span><br><span class="hljs-comment">	 * (only applied when creating a new instance as opposed to retrieving an existing one)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> an instance of the bean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no such bean definition</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeanDefinitionStoreException if arguments have been given but</span><br><span class="hljs-comment">	 * the affected bean isn&#x27;t a prototype</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeansException if the bean could not be created</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 4.1</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getBean</span><span class="hljs-params">(Class&lt;T&gt; requiredType, Object... args)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return a provider for the specified bean, allowing for lazy on-demand retrieval</span><br><span class="hljs-comment">	 * of instances, including availability and uniqueness options.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> requiredType type the bean must match; can be an interface or superclass</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> a corresponding provider handle</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.1</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBeanProvider(ResolvableType)</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">ObjectProvider&lt;T&gt; <span class="hljs-title">getBeanProvider</span><span class="hljs-params">(Class&lt;T&gt; requiredType)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return a provider for the specified bean, allowing for lazy on-demand retrieval</span><br><span class="hljs-comment">	 * of instances, including availability and uniqueness options.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> requiredType type the bean must match; can be a generic type declaration.</span><br><span class="hljs-comment">	 * Note that collection types are not supported here, in contrast to reflective</span><br><span class="hljs-comment">	 * injection points. For programmatically retrieving a list of beans matching a</span><br><span class="hljs-comment">	 * specific type, specify the actual bean type as an argument here and subsequently</span><br><span class="hljs-comment">	 * use &#123;<span class="hljs-doctag">@link</span> ObjectProvider#orderedStream()&#125; or its lazy streaming/iteration options.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> a corresponding provider handle</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.1</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> ObjectProvider#iterator()</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> ObjectProvider#stream()</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> ObjectProvider#orderedStream()</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">ObjectProvider&lt;T&gt; <span class="hljs-title">getBeanProvider</span><span class="hljs-params">(ResolvableType requiredType)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Does this bean factory contain a bean definition or externally registered singleton</span><br><span class="hljs-comment">	 * instance with the given name?</span><br><span class="hljs-comment">	 * &lt;p&gt;If the given name is an alias, it will be translated back to the corresponding</span><br><span class="hljs-comment">	 * canonical bean name.</span><br><span class="hljs-comment">	 * &lt;p&gt;If this factory is hierarchical, will ask any parent factory if the bean cannot</span><br><span class="hljs-comment">	 * be found in this factory instance.</span><br><span class="hljs-comment">	 * &lt;p&gt;If a bean definition or singleton instance matching the given name is found,</span><br><span class="hljs-comment">	 * this method will return &#123;<span class="hljs-doctag">@code</span> true&#125; whether the named bean definition is concrete</span><br><span class="hljs-comment">	 * or abstract, lazy or eager, in scope or not. Therefore, note that a &#123;<span class="hljs-doctag">@code</span> true&#125;</span><br><span class="hljs-comment">	 * return value from this method does not necessarily indicate that &#123;<span class="hljs-doctag">@link</span> #getBean&#125;</span><br><span class="hljs-comment">	 * will be able to obtain an instance for the same name.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to query</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> whether a bean with the given name is present</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">containsBean</span><span class="hljs-params">(String name)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Is this bean a shared singleton? That is, will &#123;<span class="hljs-doctag">@link</span> #getBean&#125; always</span><br><span class="hljs-comment">	 * return the same instance?</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: This method returning &#123;<span class="hljs-doctag">@code</span> false&#125; does not clearly indicate</span><br><span class="hljs-comment">	 * independent instances. It indicates non-singleton instances, which may correspond</span><br><span class="hljs-comment">	 * to a scoped bean as well. Use the &#123;<span class="hljs-doctag">@link</span> #isPrototype&#125; operation to explicitly</span><br><span class="hljs-comment">	 * check for independent instances.</span><br><span class="hljs-comment">	 * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span><br><span class="hljs-comment">	 * Will ask the parent factory if the bean cannot be found in this factory instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to query</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> whether this bean corresponds to a singleton instance</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #isPrototype</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isSingleton</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Is this bean a prototype? That is, will &#123;<span class="hljs-doctag">@link</span> #getBean&#125; always return</span><br><span class="hljs-comment">	 * independent instances?</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: This method returning &#123;<span class="hljs-doctag">@code</span> false&#125; does not clearly indicate</span><br><span class="hljs-comment">	 * a singleton object. It indicates non-independent instances, which may correspond</span><br><span class="hljs-comment">	 * to a scoped bean as well. Use the &#123;<span class="hljs-doctag">@link</span> #isSingleton&#125; operation to explicitly</span><br><span class="hljs-comment">	 * check for a shared singleton instance.</span><br><span class="hljs-comment">	 * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span><br><span class="hljs-comment">	 * Will ask the parent factory if the bean cannot be found in this factory instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to query</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> whether this bean will always deliver independent instances</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 2.0.3</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #isSingleton</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isPrototype</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Check whether the bean with the given name matches the specified type.</span><br><span class="hljs-comment">	 * More specifically, check whether a &#123;<span class="hljs-doctag">@link</span> #getBean&#125; call for the given name</span><br><span class="hljs-comment">	 * would return an object that is assignable to the specified target type.</span><br><span class="hljs-comment">	 * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span><br><span class="hljs-comment">	 * Will ask the parent factory if the bean cannot be found in this factory instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to query</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> typeToMatch the type to match against (as a &#123;<span class="hljs-doctag">@code</span> ResolvableType&#125;)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@code</span> true&#125; if the bean type matches,</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@code</span> false&#125; if it doesn&#x27;t match or cannot be determined yet</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 4.2</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getType</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isTypeMatch</span><span class="hljs-params">(String name, ResolvableType typeToMatch)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Check whether the bean with the given name matches the specified type.</span><br><span class="hljs-comment">	 * More specifically, check whether a &#123;<span class="hljs-doctag">@link</span> #getBean&#125; call for the given name</span><br><span class="hljs-comment">	 * would return an object that is assignable to the specified target type.</span><br><span class="hljs-comment">	 * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span><br><span class="hljs-comment">	 * Will ask the parent factory if the bean cannot be found in this factory instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to query</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> typeToMatch the type to match against (as a &#123;<span class="hljs-doctag">@code</span> Class&#125;)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@code</span> true&#125; if the bean type matches,</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@code</span> false&#125; if it doesn&#x27;t match or cannot be determined yet</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 2.0.1</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getType</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isTypeMatch</span><span class="hljs-params">(String name, Class&lt;?&gt; typeToMatch)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Determine the type of the bean with the given name. More specifically,</span><br><span class="hljs-comment">	 * determine the type of object that &#123;<span class="hljs-doctag">@link</span> #getBean&#125; would return for the given name.</span><br><span class="hljs-comment">	 * &lt;p&gt;For a &#123;<span class="hljs-doctag">@link</span> FactoryBean&#125;, return the type of object that the FactoryBean creates,</span><br><span class="hljs-comment">	 * as exposed by &#123;<span class="hljs-doctag">@link</span> FactoryBean#getObjectType()&#125;. This may lead to the initialization</span><br><span class="hljs-comment">	 * of a previously uninitialized &#123;<span class="hljs-doctag">@code</span> FactoryBean&#125; (see &#123;<span class="hljs-doctag">@link</span> #getType(String, boolean)&#125;).</span><br><span class="hljs-comment">	 * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span><br><span class="hljs-comment">	 * Will ask the parent factory if the bean cannot be found in this factory instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to query</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the type of the bean, or &#123;<span class="hljs-doctag">@code</span> null&#125; if not determinable</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 1.1.2</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #isTypeMatch</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	Class&lt;?&gt; getType(String name) <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Determine the type of the bean with the given name. More specifically,</span><br><span class="hljs-comment">	 * determine the type of object that &#123;<span class="hljs-doctag">@link</span> #getBean&#125; would return for the given name.</span><br><span class="hljs-comment">	 * &lt;p&gt;For a &#123;<span class="hljs-doctag">@link</span> FactoryBean&#125;, return the type of object that the FactoryBean creates,</span><br><span class="hljs-comment">	 * as exposed by &#123;<span class="hljs-doctag">@link</span> FactoryBean#getObjectType()&#125;. Depending on the</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@code</span> allowFactoryBeanInit&#125; flag, this may lead to the initialization of a previously</span><br><span class="hljs-comment">	 * uninitialized &#123;<span class="hljs-doctag">@code</span> FactoryBean&#125; if no early type information is available.</span><br><span class="hljs-comment">	 * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span><br><span class="hljs-comment">	 * Will ask the parent factory if the bean cannot be found in this factory instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to query</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> allowFactoryBeanInit whether a &#123;<span class="hljs-doctag">@code</span> FactoryBean&#125; may get initialized</span><br><span class="hljs-comment">	 * just for the purpose of determining its object type</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the type of the bean, or &#123;<span class="hljs-doctag">@code</span> null&#125; if not determinable</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.2</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBean</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #isTypeMatch</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	Class&lt;?&gt; getType(String name, <span class="hljs-keyword">boolean</span> allowFactoryBeanInit) <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the aliases for the given bean name, if any.</span><br><span class="hljs-comment">	 * All of those aliases point to the same bean when used in a &#123;<span class="hljs-doctag">@link</span> #getBean&#125; call.</span><br><span class="hljs-comment">	 * &lt;p&gt;If the given name is an alias, the corresponding original bean name</span><br><span class="hljs-comment">	 * and other aliases (if any) will be returned, with the original bean name</span><br><span class="hljs-comment">	 * being the first element in the array.</span><br><span class="hljs-comment">	 * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the bean name to check for aliases</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the aliases, or an empty array if none</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBean</span><br><span class="hljs-comment">	 */</span><br>	String[] getAliases(String name);<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="BeanFactory方法属性摘要"><a href="#BeanFactory方法属性摘要" class="headerlink" title="BeanFactory方法属性摘要"></a>BeanFactory方法属性摘要</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanFactory</span> </span>&#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	String FACTORY_BEAN_PREFIX = <span class="hljs-string">&quot;&amp;&quot;</span>;<br><br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">Object <span class="hljs-title">getBean</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getBean</span><span class="hljs-params">(String name, Class&lt;T&gt; requiredType)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">Object <span class="hljs-title">getBean</span><span class="hljs-params">(String name, Object... args)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getBean</span><span class="hljs-params">(Class&lt;T&gt; requiredType)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getBean</span><span class="hljs-params">(Class&lt;T&gt; requiredType, Object... args)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">ObjectProvider&lt;T&gt; <span class="hljs-title">getBeanProvider</span><span class="hljs-params">(Class&lt;T&gt; requiredType)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">ObjectProvider&lt;T&gt; <span class="hljs-title">getBeanProvider</span><span class="hljs-params">(ResolvableType requiredType)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">containsBean</span><span class="hljs-params">(String name)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isSingleton</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isPrototype</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isTypeMatch</span><span class="hljs-params">(String name, ResolvableType typeToMatch)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isTypeMatch</span><span class="hljs-params">(String name, Class&lt;?&gt; typeToMatch)</span> <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	Class&lt;?&gt; getType(String name) <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	Class&lt;?&gt; getType(String name, <span class="hljs-keyword">boolean</span> allowFactoryBeanInit) <span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	String[] getAliases(String name);<br><br>&#125;<br></code></pre></td></tr></table></figure>


<h3 id="1-2-HierarchicalBeanFactory接口"><a href="#1-2-HierarchicalBeanFactory接口" class="headerlink" title="1.2 HierarchicalBeanFactory接口"></a>1.2 HierarchicalBeanFactory接口</h3><h3 id="完整版源码：-1"><a href="#完整版源码：-1" class="headerlink" title="完整版源码："></a>完整版源码：</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Copyright 2002-2012 the original author or authors.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"> * you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"> * You may obtain a copy of the License at</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"> * See the License for the specific language governing permissions and</span><br><span class="hljs-comment"> * limitations under the License.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">package</span> org.springframework.beans.factory;<br><br><span class="hljs-keyword">import</span> org.springframework.lang.Nullable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Sub-interface implemented by bean factories that can be part</span><br><span class="hljs-comment"> * of a hierarchy.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;The corresponding &#123;<span class="hljs-doctag">@code</span> setParentBeanFactory&#125; method for bean</span><br><span class="hljs-comment"> * factories that allow setting the parent in a configurable</span><br><span class="hljs-comment"> * fashion can be found in the ConfigurableBeanFactory interface.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Rod Johnson</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Juergen Hoeller</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 07.07.2003</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.beans.factory.config.ConfigurableBeanFactory#setParentBeanFactory</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HierarchicalBeanFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BeanFactory</span> </span>&#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the parent bean factory, or &#123;<span class="hljs-doctag">@code</span> null&#125; if there is none.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">BeanFactory <span class="hljs-title">getParentBeanFactory</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return whether the local bean factory contains a bean of the given name,</span><br><span class="hljs-comment">	 * ignoring beans defined in ancestor contexts.</span><br><span class="hljs-comment">	 * &lt;p&gt;This is an alternative to &#123;<span class="hljs-doctag">@code</span> containsBean&#125;, ignoring a bean</span><br><span class="hljs-comment">	 * of the given name from an ancestor bean factory.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> name the name of the bean to query</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> whether a bean with the given name is defined in the local factory</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> BeanFactory#containsBean</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">containsLocalBean</span><span class="hljs-params">(String name)</span></span>;<br><br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="HierarchicalBeanFactory方法属性摘要"><a href="#HierarchicalBeanFactory方法属性摘要" class="headerlink" title="HierarchicalBeanFactory方法属性摘要"></a>HierarchicalBeanFactory方法属性摘要</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HierarchicalBeanFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BeanFactory</span> </span>&#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">BeanFactory <span class="hljs-title">getParentBeanFactory</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">containsLocalBean</span><span class="hljs-params">(String name)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1-3-ListableBeanFactory接口"><a href="#1-3-ListableBeanFactory接口" class="headerlink" title="1.3 ListableBeanFactory接口"></a>1.3 ListableBeanFactory接口</h3><h3 id="完整版源码：-2"><a href="#完整版源码：-2" class="headerlink" title="完整版源码："></a>完整版源码：</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Copyright 2002-2019 the original author or authors.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"> * you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"> * You may obtain a copy of the License at</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"> * See the License for the specific language governing permissions and</span><br><span class="hljs-comment"> * limitations under the License.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">package</span> org.springframework.beans.factory;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.Annotation;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">import</span> org.springframework.beans.BeansException;<br><span class="hljs-keyword">import</span> org.springframework.core.ResolvableType;<br><span class="hljs-keyword">import</span> org.springframework.lang.Nullable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Extension of the &#123;<span class="hljs-doctag">@link</span> BeanFactory&#125; interface to be implemented by bean factories</span><br><span class="hljs-comment"> * that can enumerate all their bean instances, rather than attempting bean lookup</span><br><span class="hljs-comment"> * by name one by one as requested by clients. BeanFactory implementations that</span><br><span class="hljs-comment"> * preload all their bean definitions (such as XML-based factories) may implement</span><br><span class="hljs-comment"> * this interface.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;If this is a &#123;<span class="hljs-doctag">@link</span> HierarchicalBeanFactory&#125;, the return values will &lt;i&gt;not&lt;/i&gt;</span><br><span class="hljs-comment"> * take any BeanFactory hierarchy into account, but will relate only to the beans</span><br><span class="hljs-comment"> * defined in the current factory. Use the &#123;<span class="hljs-doctag">@link</span> BeanFactoryUtils&#125; helper class</span><br><span class="hljs-comment"> * to consider beans in ancestor factories too.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;The methods in this interface will just respect bean definitions of this factory.</span><br><span class="hljs-comment"> * They will ignore any singleton beans that have been registered by other means like</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@link</span> org.springframework.beans.factory.config.ConfigurableBeanFactory&#125;&#x27;s</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@code</span> registerSingleton&#125; method, with the exception of</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@code</span> getBeanNamesOfType&#125; and &#123;<span class="hljs-doctag">@code</span> getBeansOfType&#125; which will check</span><br><span class="hljs-comment"> * such manually registered singletons too. Of course, BeanFactory&#x27;s &#123;<span class="hljs-doctag">@code</span> getBean&#125;</span><br><span class="hljs-comment"> * does allow transparent access to such special beans as well. However, in typical</span><br><span class="hljs-comment"> * scenarios, all beans will be defined by external bean definitions anyway, so most</span><br><span class="hljs-comment"> * applications don&#x27;t need to worry about this differentiation.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;&lt;b&gt;<span class="hljs-doctag">NOTE:</span>&lt;/b&gt; With the exception of &#123;<span class="hljs-doctag">@code</span> getBeanDefinitionCount&#125;</span><br><span class="hljs-comment"> * and &#123;<span class="hljs-doctag">@code</span> containsBeanDefinition&#125;, the methods in this interface</span><br><span class="hljs-comment"> * are not designed for frequent invocation. Implementations may be slow.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Rod Johnson</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Juergen Hoeller</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 16 April 2001</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> HierarchicalBeanFactory</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> BeanFactoryUtils</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ListableBeanFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BeanFactory</span> </span>&#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Check if this bean factory contains a bean definition with the given name.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does not consider any hierarchy this factory may participate in,</span><br><span class="hljs-comment">	 * and ignores any singleton beans that have been registered by</span><br><span class="hljs-comment">	 * other means than bean definitions.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> beanName the name of the bean to look for</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> if this bean factory contains a bean definition with the given name</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #containsBean</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">containsBeanDefinition</span><span class="hljs-params">(String beanName)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the number of beans defined in the factory.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does not consider any hierarchy this factory may participate in,</span><br><span class="hljs-comment">	 * and ignores any singleton beans that have been registered by</span><br><span class="hljs-comment">	 * other means than bean definitions.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the number of beans defined in the factory</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getBeanDefinitionCount</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the names of all beans defined in this factory.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does not consider any hierarchy this factory may participate in,</span><br><span class="hljs-comment">	 * and ignores any singleton beans that have been registered by</span><br><span class="hljs-comment">	 * other means than bean definitions.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the names of all beans defined in this factory,</span><br><span class="hljs-comment">	 * or an empty array if none defined</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanDefinitionNames();<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the names of beans matching the given type (including subclasses),</span><br><span class="hljs-comment">	 * judging from either bean definitions or the value of &#123;<span class="hljs-doctag">@code</span> getObjectType&#125;</span><br><span class="hljs-comment">	 * in the case of FactoryBeans.</span><br><span class="hljs-comment">	 * &lt;p&gt;&lt;b&gt;<span class="hljs-doctag">NOTE:</span> This method introspects top-level beans only.&lt;/b&gt; It does &lt;i&gt;not&lt;/i&gt;</span><br><span class="hljs-comment">	 * check nested beans which might match the specified type as well.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does consider objects created by FactoryBeans, which means that FactoryBeans</span><br><span class="hljs-comment">	 * will get initialized. If the object created by the FactoryBean doesn&#x27;t match,</span><br><span class="hljs-comment">	 * the raw FactoryBean itself will be matched against the type.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does not consider any hierarchy this factory may participate in.</span><br><span class="hljs-comment">	 * Use BeanFactoryUtils&#x27; &#123;<span class="hljs-doctag">@code</span> beanNamesForTypeIncludingAncestors&#125;</span><br><span class="hljs-comment">	 * to include beans in ancestor factories too.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: Does &lt;i&gt;not&lt;/i&gt; ignore singleton beans that have been registered</span><br><span class="hljs-comment">	 * by other means than bean definitions.</span><br><span class="hljs-comment">	 * &lt;p&gt;This version of &#123;<span class="hljs-doctag">@code</span> getBeanNamesForType&#125; matches all kinds of beans,</span><br><span class="hljs-comment">	 * be it singletons, prototypes, or FactoryBeans. In most implementations, the</span><br><span class="hljs-comment">	 * result will be the same as for &#123;<span class="hljs-doctag">@code</span> getBeanNamesForType(type, true, true)&#125;.</span><br><span class="hljs-comment">	 * &lt;p&gt;Bean names returned by this method should always return bean names &lt;i&gt;in the</span><br><span class="hljs-comment">	 * order of definition&lt;/i&gt; in the backend configuration, as far as possible.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> type the generically typed class or interface to match</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the names of beans (or objects created by FactoryBeans) matching</span><br><span class="hljs-comment">	 * the given object type (including subclasses), or an empty array if none</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 4.2</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #isTypeMatch(String, ResolvableType)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> FactoryBean#getObjectType</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> BeanFactoryUtils#beanNamesForTypeIncludingAncestors(ListableBeanFactory, ResolvableType)</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanNamesForType(ResolvableType type);<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the names of beans matching the given type (including subclasses),</span><br><span class="hljs-comment">	 * judging from either bean definitions or the value of &#123;<span class="hljs-doctag">@code</span> getObjectType&#125;</span><br><span class="hljs-comment">	 * in the case of FactoryBeans.</span><br><span class="hljs-comment">	 * &lt;p&gt;&lt;b&gt;<span class="hljs-doctag">NOTE:</span> This method introspects top-level beans only.&lt;/b&gt; It does &lt;i&gt;not&lt;/i&gt;</span><br><span class="hljs-comment">	 * check nested beans which might match the specified type as well.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does consider objects created by FactoryBeans if the &quot;allowEagerInit&quot; flag is set,</span><br><span class="hljs-comment">	 * which means that FactoryBeans will get initialized. If the object created by the</span><br><span class="hljs-comment">	 * FactoryBean doesn&#x27;t match, the raw FactoryBean itself will be matched against the</span><br><span class="hljs-comment">	 * type. If &quot;allowEagerInit&quot; is not set, only raw FactoryBeans will be checked</span><br><span class="hljs-comment">	 * (which doesn&#x27;t require initialization of each FactoryBean).</span><br><span class="hljs-comment">	 * &lt;p&gt;Does not consider any hierarchy this factory may participate in.</span><br><span class="hljs-comment">	 * Use BeanFactoryUtils&#x27; &#123;<span class="hljs-doctag">@code</span> beanNamesForTypeIncludingAncestors&#125;</span><br><span class="hljs-comment">	 * to include beans in ancestor factories too.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: Does &lt;i&gt;not&lt;/i&gt; ignore singleton beans that have been registered</span><br><span class="hljs-comment">	 * by other means than bean definitions.</span><br><span class="hljs-comment">	 * &lt;p&gt;Bean names returned by this method should always return bean names &lt;i&gt;in the</span><br><span class="hljs-comment">	 * order of definition&lt;/i&gt; in the backend configuration, as far as possible.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> type the generically typed class or interface to match</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> includeNonSingletons whether to include prototype or scoped beans too</span><br><span class="hljs-comment">	 * or just singletons (also applies to FactoryBeans)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> allowEagerInit whether to initialize &lt;i&gt;lazy-init singletons&lt;/i&gt; and</span><br><span class="hljs-comment">	 * &lt;i&gt;objects created by FactoryBeans&lt;/i&gt; (or by factory methods with a</span><br><span class="hljs-comment">	 * &quot;factory-bean&quot; reference) for the type check. Note that FactoryBeans need to be</span><br><span class="hljs-comment">	 * eagerly initialized to determine their type: So be aware that passing in &quot;true&quot;</span><br><span class="hljs-comment">	 * for this flag will initialize FactoryBeans and &quot;factory-bean&quot; references.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the names of beans (or objects created by FactoryBeans) matching</span><br><span class="hljs-comment">	 * the given object type (including subclasses), or an empty array if none</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.2</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> FactoryBean#getObjectType</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> BeanFactoryUtils#beanNamesForTypeIncludingAncestors(ListableBeanFactory, ResolvableType, boolean, boolean)</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanNamesForType(ResolvableType type, <span class="hljs-keyword">boolean</span> includeNonSingletons, <span class="hljs-keyword">boolean</span> allowEagerInit);<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the names of beans matching the given type (including subclasses),</span><br><span class="hljs-comment">	 * judging from either bean definitions or the value of &#123;<span class="hljs-doctag">@code</span> getObjectType&#125;</span><br><span class="hljs-comment">	 * in the case of FactoryBeans.</span><br><span class="hljs-comment">	 * &lt;p&gt;&lt;b&gt;<span class="hljs-doctag">NOTE:</span> This method introspects top-level beans only.&lt;/b&gt; It does &lt;i&gt;not&lt;/i&gt;</span><br><span class="hljs-comment">	 * check nested beans which might match the specified type as well.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does consider objects created by FactoryBeans, which means that FactoryBeans</span><br><span class="hljs-comment">	 * will get initialized. If the object created by the FactoryBean doesn&#x27;t match,</span><br><span class="hljs-comment">	 * the raw FactoryBean itself will be matched against the type.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does not consider any hierarchy this factory may participate in.</span><br><span class="hljs-comment">	 * Use BeanFactoryUtils&#x27; &#123;<span class="hljs-doctag">@code</span> beanNamesForTypeIncludingAncestors&#125;</span><br><span class="hljs-comment">	 * to include beans in ancestor factories too.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: Does &lt;i&gt;not&lt;/i&gt; ignore singleton beans that have been registered</span><br><span class="hljs-comment">	 * by other means than bean definitions.</span><br><span class="hljs-comment">	 * &lt;p&gt;This version of &#123;<span class="hljs-doctag">@code</span> getBeanNamesForType&#125; matches all kinds of beans,</span><br><span class="hljs-comment">	 * be it singletons, prototypes, or FactoryBeans. In most implementations, the</span><br><span class="hljs-comment">	 * result will be the same as for &#123;<span class="hljs-doctag">@code</span> getBeanNamesForType(type, true, true)&#125;.</span><br><span class="hljs-comment">	 * &lt;p&gt;Bean names returned by this method should always return bean names &lt;i&gt;in the</span><br><span class="hljs-comment">	 * order of definition&lt;/i&gt; in the backend configuration, as far as possible.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> type the class or interface to match, or &#123;<span class="hljs-doctag">@code</span> null&#125; for all bean names</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the names of beans (or objects created by FactoryBeans) matching</span><br><span class="hljs-comment">	 * the given object type (including subclasses), or an empty array if none</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> FactoryBean#getObjectType</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> BeanFactoryUtils#beanNamesForTypeIncludingAncestors(ListableBeanFactory, Class)</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanNamesForType(<span class="hljs-meta">@Nullable</span> Class&lt;?&gt; type);<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the names of beans matching the given type (including subclasses),</span><br><span class="hljs-comment">	 * judging from either bean definitions or the value of &#123;<span class="hljs-doctag">@code</span> getObjectType&#125;</span><br><span class="hljs-comment">	 * in the case of FactoryBeans.</span><br><span class="hljs-comment">	 * &lt;p&gt;&lt;b&gt;<span class="hljs-doctag">NOTE:</span> This method introspects top-level beans only.&lt;/b&gt; It does &lt;i&gt;not&lt;/i&gt;</span><br><span class="hljs-comment">	 * check nested beans which might match the specified type as well.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does consider objects created by FactoryBeans if the &quot;allowEagerInit&quot; flag is set,</span><br><span class="hljs-comment">	 * which means that FactoryBeans will get initialized. If the object created by the</span><br><span class="hljs-comment">	 * FactoryBean doesn&#x27;t match, the raw FactoryBean itself will be matched against the</span><br><span class="hljs-comment">	 * type. If &quot;allowEagerInit&quot; is not set, only raw FactoryBeans will be checked</span><br><span class="hljs-comment">	 * (which doesn&#x27;t require initialization of each FactoryBean).</span><br><span class="hljs-comment">	 * &lt;p&gt;Does not consider any hierarchy this factory may participate in.</span><br><span class="hljs-comment">	 * Use BeanFactoryUtils&#x27; &#123;<span class="hljs-doctag">@code</span> beanNamesForTypeIncludingAncestors&#125;</span><br><span class="hljs-comment">	 * to include beans in ancestor factories too.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: Does &lt;i&gt;not&lt;/i&gt; ignore singleton beans that have been registered</span><br><span class="hljs-comment">	 * by other means than bean definitions.</span><br><span class="hljs-comment">	 * &lt;p&gt;Bean names returned by this method should always return bean names &lt;i&gt;in the</span><br><span class="hljs-comment">	 * order of definition&lt;/i&gt; in the backend configuration, as far as possible.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> type the class or interface to match, or &#123;<span class="hljs-doctag">@code</span> null&#125; for all bean names</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> includeNonSingletons whether to include prototype or scoped beans too</span><br><span class="hljs-comment">	 * or just singletons (also applies to FactoryBeans)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> allowEagerInit whether to initialize &lt;i&gt;lazy-init singletons&lt;/i&gt; and</span><br><span class="hljs-comment">	 * &lt;i&gt;objects created by FactoryBeans&lt;/i&gt; (or by factory methods with a</span><br><span class="hljs-comment">	 * &quot;factory-bean&quot; reference) for the type check. Note that FactoryBeans need to be</span><br><span class="hljs-comment">	 * eagerly initialized to determine their type: So be aware that passing in &quot;true&quot;</span><br><span class="hljs-comment">	 * for this flag will initialize FactoryBeans and &quot;factory-bean&quot; references.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the names of beans (or objects created by FactoryBeans) matching</span><br><span class="hljs-comment">	 * the given object type (including subclasses), or an empty array if none</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> FactoryBean#getObjectType</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> BeanFactoryUtils#beanNamesForTypeIncludingAncestors(ListableBeanFactory, Class, boolean, boolean)</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanNamesForType(<span class="hljs-meta">@Nullable</span> Class&lt;?&gt; type, <span class="hljs-keyword">boolean</span> includeNonSingletons, <span class="hljs-keyword">boolean</span> allowEagerInit);<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the bean instances that match the given object type (including</span><br><span class="hljs-comment">	 * subclasses), judging from either bean definitions or the value of</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@code</span> getObjectType&#125; in the case of FactoryBeans.</span><br><span class="hljs-comment">	 * &lt;p&gt;&lt;b&gt;<span class="hljs-doctag">NOTE:</span> This method introspects top-level beans only.&lt;/b&gt; It does &lt;i&gt;not&lt;/i&gt;</span><br><span class="hljs-comment">	 * check nested beans which might match the specified type as well.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does consider objects created by FactoryBeans, which means that FactoryBeans</span><br><span class="hljs-comment">	 * will get initialized. If the object created by the FactoryBean doesn&#x27;t match,</span><br><span class="hljs-comment">	 * the raw FactoryBean itself will be matched against the type.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does not consider any hierarchy this factory may participate in.</span><br><span class="hljs-comment">	 * Use BeanFactoryUtils&#x27; &#123;<span class="hljs-doctag">@code</span> beansOfTypeIncludingAncestors&#125;</span><br><span class="hljs-comment">	 * to include beans in ancestor factories too.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: Does &lt;i&gt;not&lt;/i&gt; ignore singleton beans that have been registered</span><br><span class="hljs-comment">	 * by other means than bean definitions.</span><br><span class="hljs-comment">	 * &lt;p&gt;This version of getBeansOfType matches all kinds of beans, be it</span><br><span class="hljs-comment">	 * singletons, prototypes, or FactoryBeans. In most implementations, the</span><br><span class="hljs-comment">	 * result will be the same as for &#123;<span class="hljs-doctag">@code</span> getBeansOfType(type, true, true)&#125;.</span><br><span class="hljs-comment">	 * &lt;p&gt;The Map returned by this method should always return bean names and</span><br><span class="hljs-comment">	 * corresponding bean instances &lt;i&gt;in the order of definition&lt;/i&gt; in the</span><br><span class="hljs-comment">	 * backend configuration, as far as possible.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> type the class or interface to match, or &#123;<span class="hljs-doctag">@code</span> null&#125; for all concrete beans</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> a Map with the matching beans, containing the bean names as</span><br><span class="hljs-comment">	 * keys and the corresponding bean instances as values</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeansException if a bean could not be created</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 1.1.2</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> FactoryBean#getObjectType</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> BeanFactoryUtils#beansOfTypeIncludingAncestors(ListableBeanFactory, Class)</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">Map&lt;String, T&gt; <span class="hljs-title">getBeansOfType</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Class&lt;T&gt; type)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the bean instances that match the given object type (including</span><br><span class="hljs-comment">	 * subclasses), judging from either bean definitions or the value of</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@code</span> getObjectType&#125; in the case of FactoryBeans.</span><br><span class="hljs-comment">	 * &lt;p&gt;&lt;b&gt;<span class="hljs-doctag">NOTE:</span> This method introspects top-level beans only.&lt;/b&gt; It does &lt;i&gt;not&lt;/i&gt;</span><br><span class="hljs-comment">	 * check nested beans which might match the specified type as well.</span><br><span class="hljs-comment">	 * &lt;p&gt;Does consider objects created by FactoryBeans if the &quot;allowEagerInit&quot; flag is set,</span><br><span class="hljs-comment">	 * which means that FactoryBeans will get initialized. If the object created by the</span><br><span class="hljs-comment">	 * FactoryBean doesn&#x27;t match, the raw FactoryBean itself will be matched against the</span><br><span class="hljs-comment">	 * type. If &quot;allowEagerInit&quot; is not set, only raw FactoryBeans will be checked</span><br><span class="hljs-comment">	 * (which doesn&#x27;t require initialization of each FactoryBean).</span><br><span class="hljs-comment">	 * &lt;p&gt;Does not consider any hierarchy this factory may participate in.</span><br><span class="hljs-comment">	 * Use BeanFactoryUtils&#x27; &#123;<span class="hljs-doctag">@code</span> beansOfTypeIncludingAncestors&#125;</span><br><span class="hljs-comment">	 * to include beans in ancestor factories too.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note: Does &lt;i&gt;not&lt;/i&gt; ignore singleton beans that have been registered</span><br><span class="hljs-comment">	 * by other means than bean definitions.</span><br><span class="hljs-comment">	 * &lt;p&gt;The Map returned by this method should always return bean names and</span><br><span class="hljs-comment">	 * corresponding bean instances &lt;i&gt;in the order of definition&lt;/i&gt; in the</span><br><span class="hljs-comment">	 * backend configuration, as far as possible.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> type the class or interface to match, or &#123;<span class="hljs-doctag">@code</span> null&#125; for all concrete beans</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> includeNonSingletons whether to include prototype or scoped beans too</span><br><span class="hljs-comment">	 * or just singletons (also applies to FactoryBeans)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> allowEagerInit whether to initialize &lt;i&gt;lazy-init singletons&lt;/i&gt; and</span><br><span class="hljs-comment">	 * &lt;i&gt;objects created by FactoryBeans&lt;/i&gt; (or by factory methods with a</span><br><span class="hljs-comment">	 * &quot;factory-bean&quot; reference) for the type check. Note that FactoryBeans need to be</span><br><span class="hljs-comment">	 * eagerly initialized to determine their type: So be aware that passing in &quot;true&quot;</span><br><span class="hljs-comment">	 * for this flag will initialize FactoryBeans and &quot;factory-bean&quot; references.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> a Map with the matching beans, containing the bean names as</span><br><span class="hljs-comment">	 * keys and the corresponding bean instances as values</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeansException if a bean could not be created</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> FactoryBean#getObjectType</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> BeanFactoryUtils#beansOfTypeIncludingAncestors(ListableBeanFactory, Class, boolean, boolean)</span><br><span class="hljs-comment">	 */</span><br>	&lt;T&gt; <span class="hljs-function">Map&lt;String, T&gt; <span class="hljs-title">getBeansOfType</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Class&lt;T&gt; type, <span class="hljs-keyword">boolean</span> includeNonSingletons, <span class="hljs-keyword">boolean</span> allowEagerInit)</span></span><br><span class="hljs-function">			<span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Find all names of beans which are annotated with the supplied &#123;<span class="hljs-doctag">@link</span> Annotation&#125;</span><br><span class="hljs-comment">	 * type, without creating corresponding bean instances yet.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note that this method considers objects created by FactoryBeans, which means</span><br><span class="hljs-comment">	 * that FactoryBeans will get initialized in order to determine their object type.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> annotationType the type of annotation to look for</span><br><span class="hljs-comment">	 * (at class, interface or factory method level of the specified bean)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the names of all matching beans</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 4.0</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #findAnnotationOnBean</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanNamesForAnnotation(Class&lt;? extends Annotation&gt; annotationType);<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Find all beans which are annotated with the supplied &#123;<span class="hljs-doctag">@link</span> Annotation&#125; type,</span><br><span class="hljs-comment">	 * returning a Map of bean names with corresponding bean instances.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note that this method considers objects created by FactoryBeans, which means</span><br><span class="hljs-comment">	 * that FactoryBeans will get initialized in order to determine their object type.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> annotationType the type of annotation to look for</span><br><span class="hljs-comment">	 * (at class, interface or factory method level of the specified bean)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> a Map with the matching beans, containing the bean names as</span><br><span class="hljs-comment">	 * keys and the corresponding bean instances as values</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> BeansException if a bean could not be created</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 3.0</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #findAnnotationOnBean</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">Map&lt;String, Object&gt; <span class="hljs-title">getBeansWithAnnotation</span><span class="hljs-params">(Class&lt;? extends Annotation&gt; annotationType)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Find an &#123;<span class="hljs-doctag">@link</span> Annotation&#125; of &#123;<span class="hljs-doctag">@code</span> annotationType&#125; on the specified bean,</span><br><span class="hljs-comment">	 * traversing its interfaces and super classes if no annotation can be found on</span><br><span class="hljs-comment">	 * the given class itself, as well as checking the bean&#x27;s factory method (if any).</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> beanName the name of the bean to look for annotations on</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> annotationType the type of annotation to look for</span><br><span class="hljs-comment">	 * (at class, interface or factory method level of the specified bean)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the annotation of the given type if found, or &#123;<span class="hljs-doctag">@code</span> null&#125; otherwise</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 3.0</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBeanNamesForAnnotation</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getBeansWithAnnotation</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	&lt;A extends Annotation&gt; <span class="hljs-function">A <span class="hljs-title">findAnnotationOnBean</span><span class="hljs-params">(String beanName, Class&lt;A&gt; annotationType)</span></span><br><span class="hljs-function">			<span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="ListableBeanFactory方法属性摘要"><a href="#ListableBeanFactory方法属性摘要" class="headerlink" title="ListableBeanFactory方法属性摘要"></a>ListableBeanFactory方法属性摘要</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ListableBeanFactory</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BeanFactory</span> </span>&#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">containsBeanDefinition</span><span class="hljs-params">(String beanName)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getBeanDefinitionCount</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanDefinitionNames();<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanNamesForType(ResolvableType type);<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanNamesForType(ResolvableType type, <span class="hljs-keyword">boolean</span> includeNonSingletons, <span class="hljs-keyword">boolean</span> allowEagerInit);<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanNamesForType(<span class="hljs-meta">@Nullable</span> Class&lt;?&gt; type);<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 */</span><br>	String[] getBeanNamesForType(<span class="hljs-meta">@Nullable</span> Class&lt;?&gt; type, <span class="hljs-keyword">boolean</span> includeNonSingletons, <span class="hljs-keyword">boolean</span> allowEagerInit);<br><br><br>	&lt;T&gt; <span class="hljs-function">Map&lt;String, T&gt; <span class="hljs-title">getBeansOfType</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Class&lt;T&gt; type)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br><br>	&lt;T&gt; <span class="hljs-function">Map&lt;String, T&gt; <span class="hljs-title">getBeansOfType</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Class&lt;T&gt; type, <span class="hljs-keyword">boolean</span> includeNonSingletons, <span class="hljs-keyword">boolean</span> allowEagerInit)</span></span><br><span class="hljs-function">			<span class="hljs-keyword">throws</span> BeansException</span>;<br><br><br>	String[] getBeanNamesForAnnotation(Class&lt;? extends Annotation&gt; annotationType);<br><br><br>	<span class="hljs-function">Map&lt;String, Object&gt; <span class="hljs-title">getBeansWithAnnotation</span><span class="hljs-params">(Class&lt;? extends Annotation&gt; annotationType)</span> <span class="hljs-keyword">throws</span> BeansException</span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	&lt;A extends Annotation&gt; <span class="hljs-function">A <span class="hljs-title">findAnnotationOnBean</span><span class="hljs-params">(String beanName, Class&lt;A&gt; annotationType)</span></span><br><span class="hljs-function">			<span class="hljs-keyword">throws</span> NoSuchBeanDefinitionException</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="1-4-ApplicationContext接口"><a href="#1-4-ApplicationContext接口" class="headerlink" title="1.4 ApplicationContext接口"></a>1.4 ApplicationContext接口</h2><h3 id="ApplicationContext接口解析"><a href="#ApplicationContext接口解析" class="headerlink" title="ApplicationContext接口解析"></a>ApplicationContext接口解析</h3><ul>
<li>相比于BeanFactory,ApplicationContext是高配版的Ioc容器，其在BeanFactory的基础上实现了更加复杂的扩展功能</li>
<li>ListableBeanFactory, HierarchicalBeanFactory都是BeanFactory的子接口，ApplicationContext继承了这两个接口，ApplicationContext进一步扩展了BeanFactory接口的功能</li>
<li>. . .</li>
</ul>
<h3 id="完整版源码：-3"><a href="#完整版源码：-3" class="headerlink" title="完整版源码："></a>完整版源码：</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Copyright 2002-2014 the original author or authors.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"> * you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"> * You may obtain a copy of the License at</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"> * See the License for the specific language governing permissions and</span><br><span class="hljs-comment"> * limitations under the License.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">package</span> org.springframework.context;<br><br><span class="hljs-keyword">import</span> org.springframework.beans.factory.HierarchicalBeanFactory;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.ListableBeanFactory;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.config.AutowireCapableBeanFactory;<br><span class="hljs-keyword">import</span> org.springframework.core.env.EnvironmentCapable;<br><span class="hljs-keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;<br><span class="hljs-keyword">import</span> org.springframework.lang.Nullable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Central interface to provide configuration for an application.</span><br><span class="hljs-comment"> * This is read-only while the application is running, but may be</span><br><span class="hljs-comment"> * reloaded if the implementation supports this.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;An ApplicationContext provides:</span><br><span class="hljs-comment"> * &lt;ul&gt;</span><br><span class="hljs-comment"> * &lt;li&gt;Bean factory methods for accessing application components.</span><br><span class="hljs-comment"> * Inherited from &#123;<span class="hljs-doctag">@link</span> org.springframework.beans.factory.ListableBeanFactory&#125;.</span><br><span class="hljs-comment"> * &lt;li&gt;The ability to load file resources in a generic fashion.</span><br><span class="hljs-comment"> * Inherited from the &#123;<span class="hljs-doctag">@link</span> org.springframework.core.io.ResourceLoader&#125; interface.</span><br><span class="hljs-comment"> * &lt;li&gt;The ability to publish events to registered listeners.</span><br><span class="hljs-comment"> * Inherited from the &#123;<span class="hljs-doctag">@link</span> ApplicationEventPublisher&#125; interface.</span><br><span class="hljs-comment"> * &lt;li&gt;The ability to resolve messages, supporting internationalization.</span><br><span class="hljs-comment"> * Inherited from the &#123;<span class="hljs-doctag">@link</span> MessageSource&#125; interface.</span><br><span class="hljs-comment"> * &lt;li&gt;Inheritance from a parent context. Definitions in a descendant context</span><br><span class="hljs-comment"> * will always take priority. This means, for example, that a single parent</span><br><span class="hljs-comment"> * context can be used by an entire web application, while each servlet has</span><br><span class="hljs-comment"> * its own child context that is independent of that of any other servlet.</span><br><span class="hljs-comment"> * &lt;/ul&gt;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;In addition to standard &#123;<span class="hljs-doctag">@link</span> org.springframework.beans.factory.BeanFactory&#125;</span><br><span class="hljs-comment"> * lifecycle capabilities, ApplicationContext implementations detect and invoke</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@link</span> ApplicationContextAware&#125; beans as well as &#123;<span class="hljs-doctag">@link</span> ResourceLoaderAware&#125;,</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@link</span> ApplicationEventPublisherAware&#125; and &#123;<span class="hljs-doctag">@link</span> MessageSourceAware&#125; beans.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Rod Johnson</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Juergen Hoeller</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> ConfigurableApplicationContext</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.beans.factory.BeanFactory</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.core.io.ResourceLoader</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ApplicationContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">EnvironmentCapable</span>, <span class="hljs-title">ListableBeanFactory</span>, <span class="hljs-title">HierarchicalBeanFactory</span>,</span><br><span class="hljs-class">		<span class="hljs-title">MessageSource</span>, <span class="hljs-title">ApplicationEventPublisher</span>, <span class="hljs-title">ResourcePatternResolver</span> </span>&#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the unique id of this application context.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the unique id of the context, or &#123;<span class="hljs-doctag">@code</span> null&#125; if none</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getId</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return a name for the deployed application that this context belongs to.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> a name for the deployed application, or the empty String by default</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">String <span class="hljs-title">getApplicationName</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return a friendly name for this context.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> a display name for this context (never &#123;<span class="hljs-doctag">@code</span> null&#125;)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">String <span class="hljs-title">getDisplayName</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the timestamp when this context was first loaded.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the timestamp (ms) when this context was first loaded</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getStartupDate</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the parent context, or &#123;<span class="hljs-doctag">@code</span> null&#125; if there is no parent</span><br><span class="hljs-comment">	 * and this is the root of the context hierarchy.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the parent context, or &#123;<span class="hljs-doctag">@code</span> null&#125; if there is no parent</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">ApplicationContext <span class="hljs-title">getParent</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Expose AutowireCapableBeanFactory functionality for this context.</span><br><span class="hljs-comment">	 * &lt;p&gt;This is not typically used by application code, except for the purpose of</span><br><span class="hljs-comment">	 * initializing bean instances that live outside of the application context,</span><br><span class="hljs-comment">	 * applying the Spring bean lifecycle (fully or partly) to them.</span><br><span class="hljs-comment">	 * &lt;p&gt;Alternatively, the internal BeanFactory exposed by the</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@link</span> ConfigurableApplicationContext&#125; interface offers access to the</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@link</span> AutowireCapableBeanFactory&#125; interface too. The present method mainly</span><br><span class="hljs-comment">	 * serves as a convenient, specific facility on the ApplicationContext interface.</span><br><span class="hljs-comment">	 * &lt;p&gt;&lt;b&gt;<span class="hljs-doctag">NOTE:</span> As of 4.2, this method will consistently throw IllegalStateException</span><br><span class="hljs-comment">	 * after the application context has been closed.&lt;/b&gt; In current Spring Framework</span><br><span class="hljs-comment">	 * versions, only refreshable application contexts behave that way; as of 4.2,</span><br><span class="hljs-comment">	 * all application context implementations will be required to comply.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the AutowireCapableBeanFactory for this context</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@throws</span> IllegalStateException if the context does not support the</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@link</span> AutowireCapableBeanFactory&#125; interface, or does not hold an</span><br><span class="hljs-comment">	 * autowire-capable bean factory yet (e.g. if &#123;<span class="hljs-doctag">@code</span> refresh()&#125; has</span><br><span class="hljs-comment">	 * never been called), or if the context has been closed already</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> ConfigurableApplicationContext#refresh()</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> ConfigurableApplicationContext#getBeanFactory()</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">AutowireCapableBeanFactory <span class="hljs-title">getAutowireCapableBeanFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IllegalStateException</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="ApplicationContext方法属性摘要"><a href="#ApplicationContext方法属性摘要" class="headerlink" title="ApplicationContext方法属性摘要"></a>ApplicationContext方法属性摘要</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ApplicationContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">EnvironmentCapable</span>, <span class="hljs-title">ListableBeanFactory</span>, <span class="hljs-title">HierarchicalBeanFactory</span>,</span><br><span class="hljs-class">		<span class="hljs-title">MessageSource</span>, <span class="hljs-title">ApplicationEventPublisher</span>, <span class="hljs-title">ResourcePatternResolver</span> </span>&#123;<br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getId</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function">String <span class="hljs-title">getApplicationName</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function">String <span class="hljs-title">getDisplayName</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getStartupDate</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">ApplicationContext <span class="hljs-title">getParent</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-function">AutowireCapableBeanFactory <span class="hljs-title">getAutowireCapableBeanFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IllegalStateException</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="1-5-BeanDefination接口"><a href="#1-5-BeanDefination接口" class="headerlink" title="1.5 BeanDefination接口"></a>1.5 BeanDefination接口</h2><h3 id="BeanDefination接口定义解析"><a href="#BeanDefination接口定义解析" class="headerlink" title="BeanDefination接口定义解析"></a>BeanDefination接口定义解析</h3><ul>
<li>BeanDefination用于管理Ioc容器中JavaBean与JavaBean之间的依赖关系，其抽象了Java开发人员对于JavaBean的定义</li>
<li>Spring将开发人员定义的JavaBean的数据结构转化为内存中的BeanDefination数据结构进行维护</li>
</ul>
<h3 id="完整版源码：-4"><a href="#完整版源码：-4" class="headerlink" title="完整版源码："></a>完整版源码：</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Copyright 2002-2019 the original author or authors.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment"> * you may not use this file except in compliance with the License.</span><br><span class="hljs-comment"> * You may obtain a copy of the License at</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment"> * See the License for the specific language governing permissions and</span><br><span class="hljs-comment"> * limitations under the License.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">package</span> org.springframework.beans.factory.config;<br><br><span class="hljs-keyword">import</span> org.springframework.beans.BeanMetadataElement;<br><span class="hljs-keyword">import</span> org.springframework.beans.MutablePropertyValues;<br><span class="hljs-keyword">import</span> org.springframework.core.AttributeAccessor;<br><span class="hljs-keyword">import</span> org.springframework.core.ResolvableType;<br><span class="hljs-keyword">import</span> org.springframework.lang.Nullable;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * A BeanDefinition describes a bean instance, which has property values,</span><br><span class="hljs-comment"> * constructor argument values, and further information supplied by</span><br><span class="hljs-comment"> * concrete implementations.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * &lt;p&gt;This is just a minimal interface: The main intention is to allow a</span><br><span class="hljs-comment"> * &#123;<span class="hljs-doctag">@link</span> BeanFactoryPostProcessor&#125; to introspect and modify property values</span><br><span class="hljs-comment"> * and other bean metadata.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Juergen Hoeller</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Rob Harrop</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 19.03.2004</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> ConfigurableListableBeanFactory#getBeanDefinition</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.beans.factory.support.RootBeanDefinition</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@see</span> org.springframework.beans.factory.support.ChildBeanDefinition</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanDefinition</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AttributeAccessor</span>, <span class="hljs-title">BeanMetadataElement</span> </span>&#123;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Scope identifier for the standard singleton scope: &quot;singleton&quot;.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note that extended bean factories might support further scopes.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #setScope</span><br><span class="hljs-comment">	 */</span><br>	String SCOPE_SINGLETON = ConfigurableBeanFactory.SCOPE_SINGLETON;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Scope identifier for the standard prototype scope: &quot;prototype&quot;.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note that extended bean factories might support further scopes.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #setScope</span><br><span class="hljs-comment">	 */</span><br>	String SCOPE_PROTOTYPE = ConfigurableBeanFactory.SCOPE_PROTOTYPE;<br><br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Role hint indicating that a &#123;<span class="hljs-doctag">@code</span> BeanDefinition&#125; is a major part</span><br><span class="hljs-comment">	 * of the application. Typically corresponds to a user-defined bean.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">int</span> ROLE_APPLICATION = <span class="hljs-number">0</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Role hint indicating that a &#123;<span class="hljs-doctag">@code</span> BeanDefinition&#125; is a supporting</span><br><span class="hljs-comment">	 * part of some larger configuration, typically an outer</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@link</span> org.springframework.beans.factory.parsing.ComponentDefinition&#125;.</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@code</span> SUPPORT&#125; beans are considered important enough to be aware</span><br><span class="hljs-comment">	 * of when looking more closely at a particular</span><br><span class="hljs-comment">	 * &#123;<span class="hljs-doctag">@link</span> org.springframework.beans.factory.parsing.ComponentDefinition&#125;,</span><br><span class="hljs-comment">	 * but not when looking at the overall configuration of an application.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">int</span> ROLE_SUPPORT = <span class="hljs-number">1</span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Role hint indicating that a &#123;<span class="hljs-doctag">@code</span> BeanDefinition&#125; is providing an</span><br><span class="hljs-comment">	 * entirely background role and has no relevance to the end-user. This hint is</span><br><span class="hljs-comment">	 * used when registering beans that are completely part of the internal workings</span><br><span class="hljs-comment">	 * of a &#123;<span class="hljs-doctag">@link</span> org.springframework.beans.factory.parsing.ComponentDefinition&#125;.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">int</span> ROLE_INFRASTRUCTURE = <span class="hljs-number">2</span>;<br><br><br>	<span class="hljs-comment">// Modifiable attributes</span><br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Set the name of the parent definition of this bean definition, if any.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setParentName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String parentName)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the name of the parent definition of this bean definition, if any.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getParentName</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Specify the bean class name of this bean definition.</span><br><span class="hljs-comment">	 * &lt;p&gt;The class name can be modified during bean factory post-processing,</span><br><span class="hljs-comment">	 * typically replacing the original class name with a parsed variant of it.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #setParentName</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #setFactoryBeanName</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #setFactoryMethodName</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setBeanClassName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String beanClassName)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the current bean class name of this bean definition.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note that this does not have to be the actual class name used at runtime, in</span><br><span class="hljs-comment">	 * case of a child definition overriding/inheriting the class name from its parent.</span><br><span class="hljs-comment">	 * Also, this may just be the class that a factory method is called on, or it may</span><br><span class="hljs-comment">	 * even be empty in case of a factory bean reference that a method is called on.</span><br><span class="hljs-comment">	 * Hence, do &lt;i&gt;not&lt;/i&gt; consider this to be the definitive bean type at runtime but</span><br><span class="hljs-comment">	 * rather only use it for parsing purposes at the individual bean definition level.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getParentName()</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getFactoryBeanName()</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #getFactoryMethodName()</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getBeanClassName</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Override the target scope of this bean, specifying a new scope name.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #SCOPE_SINGLETON</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #SCOPE_PROTOTYPE</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setScope</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String scope)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the name of the current target scope for this bean,</span><br><span class="hljs-comment">	 * or &#123;<span class="hljs-doctag">@code</span> null&#125; if not known yet.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getScope</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Set whether this bean should be lazily initialized.</span><br><span class="hljs-comment">	 * &lt;p&gt;If &#123;<span class="hljs-doctag">@code</span> false&#125;, the bean will get instantiated on startup by bean</span><br><span class="hljs-comment">	 * factories that perform eager initialization of singletons.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setLazyInit</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> lazyInit)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return whether this bean should be lazily initialized, i.e. not</span><br><span class="hljs-comment">	 * eagerly instantiated on startup. Only applicable to a singleton bean.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isLazyInit</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Set the names of the beans that this bean depends on being initialized.</span><br><span class="hljs-comment">	 * The bean factory will guarantee that these beans get initialized first.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setDependsOn</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String... dependsOn)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the bean names that this bean depends on.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	String[] getDependsOn();<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Set whether this bean is a candidate for getting autowired into some other bean.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note that this flag is designed to only affect type-based autowiring.</span><br><span class="hljs-comment">	 * It does not affect explicit references by name, which will get resolved even</span><br><span class="hljs-comment">	 * if the specified bean is not marked as an autowire candidate. As a consequence,</span><br><span class="hljs-comment">	 * autowiring by name will nevertheless inject a bean if the name matches.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setAutowireCandidate</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> autowireCandidate)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return whether this bean is a candidate for getting autowired into some other bean.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isAutowireCandidate</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Set whether this bean is a primary autowire candidate.</span><br><span class="hljs-comment">	 * &lt;p&gt;If this value is &#123;<span class="hljs-doctag">@code</span> true&#125; for exactly one bean among multiple</span><br><span class="hljs-comment">	 * matching candidates, it will serve as a tie-breaker.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setPrimary</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> primary)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return whether this bean is a primary autowire candidate.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isPrimary</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Specify the factory bean to use, if any.</span><br><span class="hljs-comment">	 * This the name of the bean to call the specified factory method on.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #setFactoryMethodName</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFactoryBeanName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String factoryBeanName)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the factory bean name, if any.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getFactoryBeanName</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Specify a factory method, if any. This method will be invoked with</span><br><span class="hljs-comment">	 * constructor arguments, or with no arguments if none are specified.</span><br><span class="hljs-comment">	 * The method will be invoked on the specified factory bean, if any,</span><br><span class="hljs-comment">	 * or otherwise as a static method on the local bean class.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #setFactoryBeanName</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #setBeanClassName</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFactoryMethodName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String factoryMethodName)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return a factory method, if any.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getFactoryMethodName</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the constructor argument values for this bean.</span><br><span class="hljs-comment">	 * &lt;p&gt;The returned instance can be modified during bean factory post-processing.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the ConstructorArgumentValues object (never &#123;<span class="hljs-doctag">@code</span> null&#125;)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">ConstructorArgumentValues <span class="hljs-title">getConstructorArgumentValues</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return if there are constructor argument values defined for this bean.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.0.2</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasConstructorArgumentValues</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> !getConstructorArgumentValues().isEmpty();<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the property values to be applied to a new instance of the bean.</span><br><span class="hljs-comment">	 * &lt;p&gt;The returned instance can be modified during bean factory post-processing.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the MutablePropertyValues object (never &#123;<span class="hljs-doctag">@code</span> null&#125;)</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">MutablePropertyValues <span class="hljs-title">getPropertyValues</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return if there are property values values defined for this bean.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.0.2</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasPropertyValues</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> !getPropertyValues().isEmpty();<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Set the name of the initializer method.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.1</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setInitMethodName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String initMethodName)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the name of the initializer method.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.1</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getInitMethodName</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Set the name of the destroy method.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.1</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setDestroyMethodName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String destroyMethodName)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the name of the destroy method.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.1</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getDestroyMethodName</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Set the role hint for this &#123;<span class="hljs-doctag">@code</span> BeanDefinition&#125;. The role hint</span><br><span class="hljs-comment">	 * provides the frameworks as well as tools with an indication of</span><br><span class="hljs-comment">	 * the role and importance of a particular &#123;<span class="hljs-doctag">@code</span> BeanDefinition&#125;.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.1</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #ROLE_APPLICATION</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #ROLE_SUPPORT</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #ROLE_INFRASTRUCTURE</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setRole</span><span class="hljs-params">(<span class="hljs-keyword">int</span> role)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Get the role hint for this &#123;<span class="hljs-doctag">@code</span> BeanDefinition&#125;. The role hint</span><br><span class="hljs-comment">	 * provides the frameworks as well as tools with an indication of</span><br><span class="hljs-comment">	 * the role and importance of a particular &#123;<span class="hljs-doctag">@code</span> BeanDefinition&#125;.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #ROLE_APPLICATION</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #ROLE_SUPPORT</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #ROLE_INFRASTRUCTURE</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getRole</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Set a human-readable description of this bean definition.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.1</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setDescription</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String description)</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return a human-readable description of this bean definition.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getDescription</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-comment">// Read-only attributes</span><br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return a resolvable type for this bean definition,</span><br><span class="hljs-comment">	 * based on the bean class or other specific metadata.</span><br><span class="hljs-comment">	 * &lt;p&gt;This is typically fully resolved on a runtime-merged bean definition</span><br><span class="hljs-comment">	 * but not necessarily on a configuration-time definition instance.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span> the resolvable type (potentially &#123;<span class="hljs-doctag">@link</span> ResolvableType#NONE&#125;)</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 5.2</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> ConfigurableBeanFactory#getMergedBeanDefinition</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function">ResolvableType <span class="hljs-title">getResolvableType</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return whether this a &lt;b&gt;Singleton&lt;/b&gt;, with a single, shared instance</span><br><span class="hljs-comment">	 * returned on all calls.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #SCOPE_SINGLETON</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isSingleton</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return whether this a &lt;b&gt;Prototype&lt;/b&gt;, with an independent instance</span><br><span class="hljs-comment">	 * returned for each call.</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@since</span> 3.0</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@see</span> #SCOPE_PROTOTYPE</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isPrototype</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return whether this bean is &quot;abstract&quot;, that is, not meant to be instantiated.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isAbstract</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return a description of the resource that this bean definition</span><br><span class="hljs-comment">	 * came from (for the purpose of showing context in case of errors).</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getResourceDescription</span><span class="hljs-params">()</span></span>;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * Return the originating BeanDefinition, or &#123;<span class="hljs-doctag">@code</span> null&#125; if none.</span><br><span class="hljs-comment">	 * Allows for retrieving the decorated bean definition, if any.</span><br><span class="hljs-comment">	 * &lt;p&gt;Note that this method returns the immediate originator. Iterate through the</span><br><span class="hljs-comment">	 * originator chain to find the original BeanDefinition as defined by the user.</span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">BeanDefinition <span class="hljs-title">getOriginatingBeanDefinition</span><span class="hljs-params">()</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="BeanDefination方法属性摘要"><a href="#BeanDefination方法属性摘要" class="headerlink" title="BeanDefination方法属性摘要"></a>BeanDefination方法属性摘要</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanDefinition</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AttributeAccessor</span>, <span class="hljs-title">BeanMetadataElement</span> </span>&#123;<br><br>	String SCOPE_SINGLETON = ConfigurableBeanFactory.SCOPE_SINGLETON;<br><br>	String SCOPE_PROTOTYPE = ConfigurableBeanFactory.SCOPE_PROTOTYPE;<br><br>	<span class="hljs-keyword">int</span> ROLE_APPLICATION = <span class="hljs-number">0</span>;<br><br><br>	<span class="hljs-keyword">int</span> ROLE_SUPPORT = <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// infrastructure</span><br>	<span class="hljs-keyword">int</span> ROLE_INFRASTRUCTURE = <span class="hljs-number">2</span>;<br><br><br>	<span class="hljs-comment">// Modifiable attributes</span><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setParentName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String parentName)</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getParentName</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setBeanClassName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String beanClassName)</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getBeanClassName</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setScope</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String scope)</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getScope</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setLazyInit</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> lazyInit)</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isLazyInit</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setDependsOn</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String... dependsOn)</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	String[] getDependsOn();<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setAutowireCandidate</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> autowireCandidate)</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isAutowireCandidate</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setPrimary</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> primary)</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isPrimary</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFactoryBeanName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String factoryBeanName)</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getFactoryBeanName</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFactoryMethodName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String factoryMethodName)</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getFactoryMethodName</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function">ConstructorArgumentValues <span class="hljs-title">getConstructorArgumentValues</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasConstructorArgumentValues</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> !getConstructorArgumentValues().isEmpty();<br>	&#125;<br><br><br>	<span class="hljs-function">MutablePropertyValues <span class="hljs-title">getPropertyValues</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">default</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">hasPropertyValues</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> !getPropertyValues().isEmpty();<br>	&#125;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setInitMethodName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String initMethodName)</span></span>;<br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getInitMethodName</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setDestroyMethodName</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String destroyMethodName)</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getDestroyMethodName</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setRole</span><span class="hljs-params">(<span class="hljs-keyword">int</span> role)</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getRole</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setDescription</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String description)</span></span>;<br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getDescription</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-comment">// Read-only attributes</span><br><br><br>	<span class="hljs-function">ResolvableType <span class="hljs-title">getResolvableType</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isSingleton</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isPrototype</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isAbstract</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">String <span class="hljs-title">getResourceDescription</span><span class="hljs-params">()</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">BeanDefinition <span class="hljs-title">getOriginatingBeanDefinition</span><span class="hljs-params">()</span></span>;<br><br>&#125;<br><br><br><br><span class="hljs-comment">// org.springframework.core.AttributeAccessor</span><br><span class="hljs-keyword">package</span> org.springframework.core;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AttributeAccessor</span> </span>&#123;<br><br>	<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setAttribute</span><span class="hljs-params">(String name, <span class="hljs-meta">@Nullable</span> Object value)</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">Object <span class="hljs-title">getAttribute</span><span class="hljs-params">(String name)</span></span>;<br><br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function">Object <span class="hljs-title">removeAttribute</span><span class="hljs-params">(String name)</span></span>;<br><br><br>	<span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">hasAttribute</span><span class="hljs-params">(String name)</span></span>;<br><br><br>	String[] attributeNames();<br><br>&#125;<br><br><br><br><span class="hljs-comment">// org.springframework.beans.BeanMetadataElemen</span><br><span class="hljs-keyword">package</span> org.springframework.beans;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BeanMetadataElement</span> </span>&#123;<br><br>	<span class="hljs-meta">@Nullable</span><br>	<span class="hljs-function"><span class="hljs-keyword">default</span> Object <span class="hljs-title">getSource</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>	&#125;<br><br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h1 id="2-从一个Demo程序开始"><a href="#2-从一个Demo程序开始" class="headerlink" title="2.从一个Demo程序开始"></a>2.从一个Demo程序开始</h1><h2 id="2-1-Demo项目配置"><a href="#2-1-Demo项目配置" class="headerlink" title="2.1 Demo项目配置"></a>2.1 Demo项目配置</h2><h3 id="maven的pom-xml配置文件"><a href="#maven的pom-xml配置文件" class="headerlink" title="maven的pom.xml配置文件"></a>maven的pom.xml配置文件</h3><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--        &lt;parent&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--            &lt;groupId&gt;com.acanx&lt;/groupId&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--            &lt;artifactId&gt;ACANX-JavaEE-Dependencies&lt;/artifactId&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--            &lt;version&gt;0.0.1&lt;/version&gt;--&gt;</span><br>    <span class="hljs-comment">&lt;!--        &lt;/parent&gt;--&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.acanx<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>JavaWeb-Spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>JavaWeb-Spring<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>JavaWeb-Spring project<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">spring.version</span>&gt;</span>5.2.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">spring.version</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- log4j日志文件管理包版本 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">slf4j.version</span>&gt;</span>2.0.0-alpha1<span class="hljs-tag">&lt;/<span class="hljs-name">slf4j.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logback.version</span>&gt;</span>1.3.0-alpha5<span class="hljs-tag">&lt;/<span class="hljs-name">logback.version</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- log4j日志包版本号 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">log4j2.version</span>&gt;</span>2.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">log4j2.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">log4j.version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">log4j.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">junit.version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">junit.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">fastjson.version</span>&gt;</span>1.2.62<span class="hljs-tag">&lt;/<span class="hljs-name">fastjson.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven-compiler-plugin.version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">maven-compiler-plugin.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;logback.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 添加fastjson --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--  单元测试--&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;maven-compiler-plugin.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<h2 id="2-2-Demo程序"><a href="#2-2-Demo程序" class="headerlink" title="2.2 Demo程序"></a>2.2 Demo程序</h2><h3 id="2-2-1启动类"><a href="#2-2-1启动类" class="headerlink" title="2.2.1启动类"></a>2.2.1启动类</h3><ul>
<li>代码位置:com.acanx.spring.xml.CspringIocConfigByFileSystemXmlApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> com.acanx.spring.xml;<br><br><span class="hljs-keyword">import</span> com.acanx.spring.bean.Car;<br><span class="hljs-keyword">import</span> org.apache.commons.logging.Log;<br><span class="hljs-keyword">import</span> org.apache.commons.logging.LogFactory;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;<br><span class="hljs-keyword">import</span> org.springframework.context.support.FileSystemXmlApplicationContext;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ACANX-JavaWeb / com.acanx.spring.xml / SpringIocConfigByXmlFileInClassPath.java</span><br><span class="hljs-comment"> * 文件由 ACANX 创建于 2019/7/30 - 13:39</span><br><span class="hljs-comment"> * Description  SpringIocConfigByXmlFileInClassPath:</span><br><span class="hljs-comment"> * 补充说明： 使用FileSystemXmlApplicationContext加载文件系统下的配置文件</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> ACANX</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 0.0.1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2019/7/30  13:39</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@since</span> 0.0.1-SNAPSHOT</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CspringIocConfigByFileSystemXmlApplicationContext</span> </span>&#123;<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger= LoggerFactory.getLogger(CspringIocConfigByFileSystemXmlApplicationContext.class);<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span>  </span>&#123;<br>        logger.info(<span class="hljs-string">&quot;-------------------&quot;</span>);<br>        logger.info(System.getProperty(<span class="hljs-string">&quot;org.apache.commons.logging.LogFactory&quot;</span>));<br>        logger.info(System.getProperty(<span class="hljs-string">&quot;org.apache.commons.logging.Log&quot;</span>));<br>        logger.info(<span class="hljs-string">&quot;-------------------&quot;</span>);<br>        String location=<span class="hljs-string">&quot;D:\\ProgramCode\\JavaCode\\ACANX-JavaWeb\\JavaWeb-Spring\\ApplicationContextC.xml&quot;</span>;<br>        ApplicationContext applicationContext = <span class="hljs-keyword">new</span> FileSystemXmlApplicationContext(location);<br>        Car car = (Car) applicationContext.getBean(<span class="hljs-string">&quot;myCar&quot;</span>);<br>        logger.info(car.toString());<br>        logger.info(<span class="hljs-string">&quot;Info :&#123;&#125;&quot;</span>,logger.isInfoEnabled());<br>        String[] beanNames=applicationContext.getBeanDefinitionNames();<br>        <span class="hljs-keyword">for</span> (String beanName:beanNames) &#123;<br>             logger.info(beanName+<span class="hljs-string">&quot;::::: &quot;</span>+applicationContext.getBean(beanName).toString());<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-2-2使用到的Bena对象"><a href="#2-2-2使用到的Bena对象" class="headerlink" title="2.2.2使用到的Bena对象"></a>2.2.2使用到的Bena对象</h3><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.acanx.spring.bean;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span>  String name;<br><br>    <span class="hljs-keyword">private</span>  String price;<br><br>	<span class="hljs-comment">// get set 默认构造方法已省略</span><br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="2-2-3-springContext的xml文件ApplicationContextC-xml"><a href="#2-2-3-springContext的xml文件ApplicationContextC-xml" class="headerlink" title="2.2.3 springContext的xml文件ApplicationContextC.xml"></a>2.2.3 springContext的xml文件ApplicationContextC.xml</h3><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;myCar&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.acanx.spring.bean.Car&quot;</span> &gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;QQAI&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;price&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2222&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<h3 id="2-2-4-配置日志-logback-xml（resources文件夹下）"><a href="#2-2-4-配置日志-logback-xml（resources文件夹下）" class="headerlink" title="2.2.4 配置日志 logback.xml（resources文件夹下）"></a>2.2.4 配置日志 logback.xml（resources文件夹下）</h3><figure class="hljs highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">scan</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">scanPeriod</span>=<span class="hljs-string">&quot;60 seconds&quot;</span> <span class="hljs-attr">debug</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LOG_PATH&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.log&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;APP_NAME&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;IOCDemo&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--设置系统日志目录--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;APP_DIR&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;app-IOCDemo&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CONSOLE_LOG_PATTERN&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;[CLP]$&#123;CONSOLE_LOG_PATTERN:-%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(%-15.15method)&#123;cyan&#125; %clr([%4.4line&#123;4&#125;])&#123;magenta&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&#125;&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FILE_LOG_PATTERN&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;FILE_LOG_PATTERN:-%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS&#125;&#125; $&#123;LOG_LEVEL_PATTERN:-%5p&#125; $&#123;PID:- &#125; --- [%t] %-40.40logger&#123;39&#125; : %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&#125;&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CONSOLE_LOGBACK_PATTERN&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;[控制台] %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level | %-80logger # %-40M [%4line] : %msg%n&quot;</span>/&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">contextName</span>&gt;</span>logback<span class="hljs-tag">&lt;/<span class="hljs-name">contextName</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--输出到控制台--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>TRACE<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOGBACK_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--  文件名 [%file]--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;CONSOLE_LOGBACK_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ERROR_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span>&gt;</span>.log/ACANX-JavaWeb/LOG-ERROR.log<span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>.log/server-error-%d&#123;yyyyMMdd&#125;.log.%i<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>5MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOGBACK_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;WARN_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>WARN<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span>&gt;</span>.log/ACANX-JavaWeb/LOG-WARN.log<span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>.log/ACANX-JavaWeb/server-WARN-%d&#123;yyyyMMdd&#125;.log.%i<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>5MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOGBACK_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;INFO_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span>&gt;</span>.log/ACANX-JavaWeb/LOG-INFO.log<span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>INFO<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>.log/ACANX-JavaWeb/server-info-%d&#123;yyyyMMdd&#125;.log.%i<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>5MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOGBACK_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--格式化输出：%d表示日期，%thread表示线程名，%-5level：级别从左显示5个字符宽度%msg：日志消息，%n是换行符--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;CONSOLE_LOGBACK_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;TRACE_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>TRACE<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span>&gt;</span>.log/ACANX-JavaWeb/LOG-TRACE.log<span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>.log/ACANX-JavaWeb/server-TRACE-%d&#123;yyyyMMdd&#125;.log.%i<br>            <span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>5MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOGBACK_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FULL_LEVEL_FILE&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">File</span>&gt;</span>.log/ACANX-JavaWeb/LOG-FULL.log<span class="hljs-tag">&lt;/<span class="hljs-name">File</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>TRACE<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--  文件名 [%file] --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$&#123;CONSOLE_LOGBACK_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>.log/ACANX-JavaWeb/LOG-FULL-%d&#123;yyyyMMdd&#125;.log.%i<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>5MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOGBACK_PATTERN&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;TRACE&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;CONSOLE&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;WARN_FILE&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ERROR_FILE&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;INFO_FILE&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;TRACE_FILE&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;FULL_LEVEL_FILE&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;TRACE&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.springframework.context&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;TRACE&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.apache&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;TRACE&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.alibaba&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;TRACE&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- 如果这里设置了additivity=true 代码打印信息向上传递,将打印信息传递到root ，并且自己的appender-ref 也会打印，这样就是打印了俩次日志--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<h1 id="3-Spring-IOC容器的创建"><a href="#3-Spring-IOC容器的创建" class="headerlink" title="3.Spring IOC容器的创建"></a>3.Spring IOC容器的创建</h1><h2 id="3-1-进入FileSystemXmlApplicationContext（AbstractXmlApplicationContext抽象类的具体实现类）"><a href="#3-1-进入FileSystemXmlApplicationContext（AbstractXmlApplicationContext抽象类的具体实现类）" class="headerlink" title="3.1 进入FileSystemXmlApplicationContext（AbstractXmlApplicationContext抽象类的具体实现类）"></a>3.1 进入FileSystemXmlApplicationContext（AbstractXmlApplicationContext抽象类的具体实现类）</h2><ul>
<li>代码位置: org.springframework.context.support.FileSystemXmlApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FileSystemXmlApplicationContext</span><span class="hljs-params">(String configLocation)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>	<span class="hljs-keyword">this</span>(<span class="hljs-keyword">new</span> String[] &#123;configLocation&#125;, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">null</span>);<br>&#125;<br><br><br>   <span class="hljs-comment">// 上面的this 来到下面的重载构造方法</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FileSystemXmlApplicationContext</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">		String[] configLocations, <span class="hljs-keyword">boolean</span> refresh, <span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span></span><br><span class="hljs-function">		<span class="hljs-keyword">throws</span> BeansException </span>&#123;<br><br>	<span class="hljs-keyword">super</span>(parent);  <span class="hljs-comment">// 初始化父容器AbstractApplicationContext</span><br>	setConfigLocations(configLocations); <span class="hljs-comment">// 设置资源文件的位置</span><br>	<span class="hljs-keyword">if</span> (refresh) &#123;<br>		refresh();<span class="hljs-comment">// 核心方法，具体定义在超类AbstractApplicationContext（抽象类）中，是一个模板方法</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-2-初始化父容器AbstractApplicationContext"><a href="#3-2-初始化父容器AbstractApplicationContext" class="headerlink" title="3.2 初始化父容器AbstractApplicationContext"></a>3.2 初始化父容器AbstractApplicationContext</h2><h3 id="3-2-1-AbstractXmlApplicationContext抽象类（FileSystemXmlApplicationContext的父类）"><a href="#3-2-1-AbstractXmlApplicationContext抽象类（FileSystemXmlApplicationContext的父类）" class="headerlink" title="3.2.1 AbstractXmlApplicationContext抽象类（FileSystemXmlApplicationContext的父类）"></a>3.2.1 AbstractXmlApplicationContext抽象类（FileSystemXmlApplicationContext的父类）</h3><ul>
<li>代码位置: org.springframework.context.support.AbstractXmlApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AbstractXmlApplicationContext</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span> </span>&#123;<br>	<span class="hljs-keyword">super</span>(parent);<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-2-2-AbstractRefreshableConfigApplicationContext抽象类（-AbstractXmlApplicationContext的父类）"><a href="#3-2-2-AbstractRefreshableConfigApplicationContext抽象类（-AbstractXmlApplicationContext的父类）" class="headerlink" title="3.2.2 AbstractRefreshableConfigApplicationContext抽象类（ AbstractXmlApplicationContext的父类）"></a>3.2.2 AbstractRefreshableConfigApplicationContext抽象类（ AbstractXmlApplicationContext的父类）</h3><ul>
<li>代码位置:org.springframework.context.support.AbstractRefreshableConfigApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AbstractRefreshableConfigApplicationContext</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span> </span>&#123;<br>	<span class="hljs-keyword">super</span>(parent);<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-2-3-AbstractRefreshableApplicationContext抽象类"><a href="#3-2-3-AbstractRefreshableApplicationContext抽象类" class="headerlink" title="3.2.3 AbstractRefreshableApplicationContext抽象类"></a>3.2.3 AbstractRefreshableApplicationContext抽象类</h3><ul>
<li> 代码位置:org.springframework.context.support.AbstractRefreshableApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AbstractRefreshableApplicationContext</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span> </span>&#123;<br>	<span class="hljs-keyword">super</span>(parent);<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-2-4-AbstractApplicationContext抽象类"><a href="#3-2-4-AbstractApplicationContext抽象类" class="headerlink" title="3.2.4 AbstractApplicationContext抽象类"></a>3.2.4 AbstractApplicationContext抽象类</h3><ul>
<li>代码位置:org.springframework.context.support.AbstractApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AbstractApplicationContext</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span> </span>&#123;<br>	<span class="hljs-keyword">this</span>();<br>	setParent(parent);<br>&#125;<br><br>   <span class="hljs-comment">//上面对应的this()方法 </span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AbstractApplicationContext</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-keyword">this</span>.resourcePatternResolver = getResourcePatternResolver();<br>&#125;<br><br>   <span class="hljs-comment">//上面对应的 getResourcePatternResolver()方法</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> ResourcePatternResolver <span class="hljs-title">getResourcePatternResolver</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PathMatchingResourcePatternResolver(<span class="hljs-keyword">this</span>);<br>&#125;<br><br>   <span class="hljs-comment">// this()之后的setParent(parent);方法</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setParent</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span> </span>&#123;<br>	<span class="hljs-keyword">this</span>.parent = parent;<br>	<span class="hljs-keyword">if</span> (parent != <span class="hljs-keyword">null</span>) &#123;<br>		Environment parentEnvironment = parent.getEnvironment();<br>		<span class="hljs-keyword">if</span> (parentEnvironment <span class="hljs-keyword">instanceof</span> ConfigurableEnvironment) &#123;<br>			getEnvironment().merge((ConfigurableEnvironment) parentEnvironment);<br>		&#125;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-5-PathMatchingResourcePatternResolver类"><a href="#3-5-PathMatchingResourcePatternResolver类" class="headerlink" title="3.5 PathMatchingResourcePatternResolver类"></a>3.5 PathMatchingResourcePatternResolver类</h2><ul>
<li>PathMatchingResourcePatternResolver(this)对应的构造方法</li>
<li>代码位置:org.springframework.core.io.support.PathMatchingResourcePatternResolver.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PathMatchingResourcePatternResolver</span><span class="hljs-params">(ResourceLoader resourceLoader)</span> </span>&#123;<br>	Assert.notNull(resourceLoader, <span class="hljs-string">&quot;ResourceLoader must not be null&quot;</span>);<br>	<span class="hljs-keyword">this</span>.resourceLoader = resourceLoader;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="4-setConfigLocations-String…-locations-方法"><a href="#4-setConfigLocations-String…-locations-方法" class="headerlink" title="4.setConfigLocations(String… locations) 方法"></a>4.setConfigLocations(String… locations) 方法</h1><ul>
<li>设置资源文件的位置</li>
</ul>
<h2 id="4-1-AbstractRefreshableConfigApplicationContext-setConfigLocations-Nullable-String…-locations-方法"><a href="#4-1-AbstractRefreshableConfigApplicationContext-setConfigLocations-Nullable-String…-locations-方法" class="headerlink" title="4.1 AbstractRefreshableConfigApplicationContext.setConfigLocations(@Nullable String… locations) 方法"></a>4.1 AbstractRefreshableConfigApplicationContext.setConfigLocations(@Nullable String… locations) 方法</h2><ul>
<li> 代码位置:org.springframework.context.support.AbstractRefreshableConfigApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setConfigLocations</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String... locations)</span> </span>&#123;<br>	<span class="hljs-keyword">if</span> (locations != <span class="hljs-keyword">null</span>) &#123;<br>		Assert.noNullElements(locations, <span class="hljs-string">&quot;Config locations must not be null&quot;</span>);<br>		<span class="hljs-keyword">this</span>.configLocations = <span class="hljs-keyword">new</span> String[locations.length];<br>		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; locations.length; i++) &#123;<br>			<span class="hljs-keyword">this</span>.configLocations[i] = resolvePath(locations[i]).trim();<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-keyword">this</span>.configLocations = <span class="hljs-keyword">null</span>;<br>	&#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="5-refresh-方法"><a href="#5-refresh-方法" class="headerlink" title="5. refresh()方法"></a>5. refresh()方法</h1><ul>
<li>AbstractApplicationContext抽象类中定义的refresh()模板方法</li>
<li>定义了需要执行刷新操作的一些步骤，只是一个模板，个性化的逻辑由其子类来具体实现<h2 id="5-1-refresh-方法定义"><a href="#5-1-refresh-方法定义" class="headerlink" title="5.1 refresh()方法定义"></a>5.1 refresh()方法定义</h2></li>
<li> 代码位置:org.springframework.context.support.AbstractApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException, IllegalStateException </span>&#123;<br>	<span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>.startupShutdownMonitor) &#123;<br>		<span class="hljs-comment">// Prepare this context for refreshing.</span><br>		prepareRefresh();<br><br>		<span class="hljs-comment">// Tell the subclass to refresh the internal bean factory.</span><br>		<span class="hljs-comment">// 创建BeanFactory</span><br>		ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();<br><br>		<span class="hljs-comment">// Prepare the bean factory for use in this context.</span><br>		prepareBeanFactory(beanFactory);<br><br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-comment">// Allows post-processing of the bean factory in context subclasses.</span><br>			postProcessBeanFactory(beanFactory);<br><br>			<span class="hljs-comment">// Invoke factory processors registered as beans in the context.</span><br>			invokeBeanFactoryPostProcessors(beanFactory);<br><br>			<span class="hljs-comment">// Register bean processors that intercept bean creation.</span><br>			registerBeanPostProcessors(beanFactory);<br><br>			<span class="hljs-comment">// Initialize message source for this context.</span><br>			initMessageSource();<br><br>			<span class="hljs-comment">// Initialize event multicaster for this context.</span><br>			initApplicationEventMulticaster();<br><br>			<span class="hljs-comment">// Initialize other special beans in specific context subclasses.</span><br>			onRefresh();<br><br>			<span class="hljs-comment">// Check for listener beans and register them.</span><br>			registerListeners();<br><br>			<span class="hljs-comment">// Instantiate all remaining (non-lazy-init) singletons.</span><br>			<span class="hljs-comment">// 实例化Bean</span><br>			finishBeanFactoryInitialization(beanFactory);<br><br>			<span class="hljs-comment">// Last step: publish corresponding event.</span><br>			finishRefresh();<br>		&#125;<br><br>		<span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>			<span class="hljs-keyword">if</span> (logger.isWarnEnabled()) &#123;<br>				logger.warn(<span class="hljs-string">&quot;Exception encountered during context initialization - &quot;</span> +<br>						<span class="hljs-string">&quot;cancelling refresh attempt: &quot;</span> + ex);<br>			&#125;<br><br>			<span class="hljs-comment">// Destroy already created singletons to avoid dangling resources.</span><br>			destroyBeans();<br><br>			<span class="hljs-comment">// Reset &#x27;active&#x27; flag.</span><br>			cancelRefresh(ex);<br><br>			<span class="hljs-comment">// Propagate exception to caller.</span><br>			<span class="hljs-keyword">throw</span> ex;<br>		&#125;<br><br>		<span class="hljs-keyword">finally</span> &#123;<br>			<span class="hljs-comment">// Reset common introspection caches in Spring&#x27;s core, since we</span><br>			<span class="hljs-comment">// might not ever need metadata for singleton beans anymore...</span><br>			resetCommonCaches();<br>		&#125;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="5-2-prepareRefresh-方法"><a href="#5-2-prepareRefresh-方法" class="headerlink" title="5.2 prepareRefresh()方法"></a>5.2 prepareRefresh()方法</h2><ul>
<li>正式Refresh()操作前的准备工作</li>
<li>代码位置:org.springframework.context.support.AbstractApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepareRefresh</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// Switch to active.</span><br>	<span class="hljs-keyword">this</span>.startupDate = System.currentTimeMillis();<br>	<span class="hljs-keyword">this</span>.closed.set(<span class="hljs-keyword">false</span>);<br>	<span class="hljs-keyword">this</span>.active.set(<span class="hljs-keyword">true</span>);<br><br>	<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>		<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>			logger.trace(<span class="hljs-string">&quot;Refreshing &quot;</span> + <span class="hljs-keyword">this</span>);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			logger.debug(<span class="hljs-string">&quot;Refreshing &quot;</span> + getDisplayName());<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// Initialize any placeholder property sources in the context environment.</span><br>	initPropertySources();<br><br>	<span class="hljs-comment">// Validate that all properties marked as required are resolvable:</span><br>	<span class="hljs-comment">// see ConfigurablePropertyResolver#setRequiredProperties</span><br>	getEnvironment().validateRequiredProperties();<br><br>	<span class="hljs-comment">// Store pre-refresh ApplicationListeners...</span><br>	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.earlyApplicationListeners == <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-keyword">this</span>.earlyApplicationListeners = <span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;(<span class="hljs-keyword">this</span>.applicationListeners);<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-comment">// Reset local application listeners to pre-refresh state.</span><br>		<span class="hljs-keyword">this</span>.applicationListeners.clear();<br>		<span class="hljs-keyword">this</span>.applicationListeners.addAll(<span class="hljs-keyword">this</span>.earlyApplicationListeners);<br>	&#125;<br><br>	<span class="hljs-comment">// Allow for the collection of early ApplicationEvents,</span><br>	<span class="hljs-comment">// to be published once the multicaster is available...</span><br>	<span class="hljs-keyword">this</span>.earlyApplicationEvents = <span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;();<br>&#125;<br><br><span class="hljs-comment">// 上述定义的initPropertySources()方法，具体由子类实现</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initPropertySources</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// For subclasses: do nothing by default.</span><br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="5-3-obtainFreshBeanFactory-方法"><a href="#5-3-obtainFreshBeanFactory-方法" class="headerlink" title="5.3 obtainFreshBeanFactory()方法"></a>5.3 obtainFreshBeanFactory()方法</h2><ul>
<li>创建BeanFactory的核心方法</li>
<li>代码位置:org.springframework.context.support.AbstractApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> ConfigurableListableBeanFactory <span class="hljs-title">obtainFreshBeanFactory</span><span class="hljs-params">()</span> </span>&#123;<br>	refreshBeanFactory();<span class="hljs-comment">// 刷新BeanFactory，抽象方法由其子类实现,5.3.1中有说明</span><br>	<span class="hljs-keyword">return</span> getBeanFactory();<span class="hljs-comment">// 获取BeanFactory，父类的抽象方法继承并由其子类实现</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">refreshBeanFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException, IllegalStateException</span>;<br><br><span class="hljs-meta">@Override</span> <span class="hljs-comment">// 该方法在ConfigurableApplicationContext接口中定义</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> ConfigurableListableBeanFactory <span class="hljs-title">getBeanFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IllegalStateException</span>;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-3-1-refreshBeanFactory-方法的一种实现"><a href="#5-3-1-refreshBeanFactory-方法的一种实现" class="headerlink" title="5.3.1 refreshBeanFactory()方法的一种实现"></a>5.3.1 refreshBeanFactory()方法的一种实现</h3><ul>
<li>org.springframework.context.support.AbstractRefreshableApplicationContext中的具体实现如下</li>
<li>refreshBeanFactory()方法是AbstractApplicationContext中定义的抽象方法</li>
<li>AbstractRefreshableApplicationContext中的refreshBeanFactory()方法是该抽象方法的一个具体实现</li>
<li>主要作用：刷新BeanFactory<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// AbstractRefreshableApplicationContext中refreshBeanFactory()方法的一种实现</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">refreshBeanFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>	<span class="hljs-comment">// 检查上下文中是否已存在BeanFactory</span><br>	<span class="hljs-keyword">if</span> (hasBeanFactory()) &#123;<br>		<span class="hljs-comment">// 存在BeanFactory时先销毁已存在的BeanFactory</span><br>		destroyBeans();<span class="hljs-comment">//调用AbstractApplicationContext中的实现</span><br>		<span class="hljs-comment">/**</span><br><span class="hljs-comment">		* 以下是AbstractApplicationContext中destroyBeans()方法的实现</span><br><span class="hljs-comment">		* protected void destroyBeans() &#123;</span><br><span class="hljs-comment">		*    getBeanFactory().destroySingletons();</span><br><span class="hljs-comment">		* &#125;</span><br><span class="hljs-comment">		*/</span><br>		closeBeanFactory();<span class="hljs-comment">// 调用本抽象类中的closeBeanFactory()方法，具体代码在下面列出</span><br>	&#125;<br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-comment">// 创建新的BeanFactory</span><br>		<span class="hljs-comment">// 下面这行代码只会创建一个空的BeanFactory，并未有任何Bean</span><br>		DefaultListableBeanFactory beanFactory = createBeanFactory();<br>		beanFactory.setSerializationId(getId());<br>		customizeBeanFactory(beanFactory);<br>		loadBeanDefinitions(beanFactory);<span class="hljs-comment">// refreshBeanFactory()方法实现的核心</span><br>		<span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>.beanFactoryMonitor) &#123;<br>			<span class="hljs-keyword">this</span>.beanFactory = beanFactory;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (IOException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ApplicationContextException(<span class="hljs-string">&quot;I/O error parsing bean definition source for &quot;</span> + getDisplayName(), ex);<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// AbstractRefreshableApplicationContext抽象类中refreshBeanFactory()方法内调用的closeBeanFactory()方法</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">closeBeanFactory</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>.beanFactoryMonitor) &#123;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.beanFactory != <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-comment">//销毁已存在的BeanFactory</span><br>			<span class="hljs-keyword">this</span>.beanFactory.setSerializationId(<span class="hljs-keyword">null</span>);<br>			<span class="hljs-keyword">this</span>.beanFactory = <span class="hljs-keyword">null</span>;<br>		&#125;<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">//AbstractRefreshableApplicationContext抽象类中refreshBeanFactory()方法内调用createBeanFactory()方法</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> DefaultListableBeanFactory <span class="hljs-title">createBeanFactory</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// 调用下面 AbstractApplicationContext中的getInternalParentBeanFactory()方法</span><br>	<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DefaultListableBeanFactory(getInternalParentBeanFactory());<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="AbstractApplicationContext中的getInternalParentBeanFactory-方法"><a href="#AbstractApplicationContext中的getInternalParentBeanFactory-方法" class="headerlink" title="AbstractApplicationContext中的getInternalParentBeanFactory()方法"></a>AbstractApplicationContext中的getInternalParentBeanFactory()方法</h4><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> BeanFactory <span class="hljs-title">getInternalParentBeanFactory</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-keyword">return</span> (getParent() <span class="hljs-keyword">instanceof</span> ConfigurableApplicationContext ?<br>			((ConfigurableApplicationContext) getParent()).getBeanFactory() : getParent());<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="DefaultListableBeanFactory的构造方法"><a href="#DefaultListableBeanFactory的构造方法" class="headerlink" title="DefaultListableBeanFactory的构造方法"></a>DefaultListableBeanFactory的构造方法</h4><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DefaultListableBeanFactory</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> BeanFactory parentBeanFactory)</span> </span>&#123;<br>	<span class="hljs-keyword">super</span>(parentBeanFactory);<span class="hljs-comment">// 调用AbstractAutowireCapableBeanFactory(抽象类)的构造方法</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="DefaultListableBeanFactory父类AbstractAutowireCapableBeanFactory-抽象类-的构造方法"><a href="#DefaultListableBeanFactory父类AbstractAutowireCapableBeanFactory-抽象类-的构造方法" class="headerlink" title="DefaultListableBeanFactory父类AbstractAutowireCapableBeanFactory(抽象类)的构造方法"></a>DefaultListableBeanFactory父类AbstractAutowireCapableBeanFactory(抽象类)的构造方法</h4><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AbstractAutowireCapableBeanFactory</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> BeanFactory parentBeanFactory)</span> </span>&#123;<br>	<span class="hljs-keyword">this</span>();<br>	setParentBeanFactory(parentBeanFactory);<br>&#125;<br></code></pre></td></tr></table></figure>


<h4 id="AbstractRefreshableApplicationContext中的customizeBeanFactory-beanFactory-方法"><a href="#AbstractRefreshableApplicationContext中的customizeBeanFactory-beanFactory-方法" class="headerlink" title="AbstractRefreshableApplicationContext中的customizeBeanFactory(beanFactory)方法"></a>AbstractRefreshableApplicationContext中的customizeBeanFactory(beanFactory)方法</h4><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">customizeBeanFactory</span><span class="hljs-params">(DefaultListableBeanFactory beanFactory)</span> </span>&#123;<br>	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.allowBeanDefinitionOverriding != <span class="hljs-keyword">null</span>) &#123;<br>		beanFactory.setAllowBeanDefinitionOverriding(<span class="hljs-keyword">this</span>.allowBeanDefinitionOverriding);<br>	&#125;<br>	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.allowCircularReferences != <span class="hljs-keyword">null</span>) &#123;<br>		beanFactory.setAllowCircularReferences(<span class="hljs-keyword">this</span>.allowCircularReferences);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="AbstractRefreshableApplicationContext中的loadBeanDefinitions-beanFactory-方法"><a href="#AbstractRefreshableApplicationContext中的loadBeanDefinitions-beanFactory-方法" class="headerlink" title="AbstractRefreshableApplicationContext中的loadBeanDefinitions(beanFactory)方法"></a>AbstractRefreshableApplicationContext中的loadBeanDefinitions(beanFactory)方法</h4><ul>
<li>是实现refreshBeanFactory()方法的核心</li>
<li>org.springframework.context.support.AbstractRefreshableApplicationContext中定义的抽象方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(DefaultListableBeanFactory beanFactory)</span></span><br><span class="hljs-function">		<span class="hljs-keyword">throws</span> BeansException, IOException</span>;<br></code></pre></td></tr></table></figure></li>
<li>该抽象方法的一个具体实现在org.springframework.context.support.AbstractXmlApplicationContext中</li>
</ul>
<h4 id="org-springframework-context-support-AbstractXmlApplicationContext中的loadBeanDefinitions-DefaultListableBeanFactory-beanFactory-方法"><a href="#org-springframework-context-support-AbstractXmlApplicationContext中的loadBeanDefinitions-DefaultListableBeanFactory-beanFactory-方法" class="headerlink" title="org.springframework.context.support.AbstractXmlApplicationContext中的loadBeanDefinitions(DefaultListableBeanFactory beanFactory)方法"></a>org.springframework.context.support.AbstractXmlApplicationContext中的loadBeanDefinitions(DefaultListableBeanFactory beanFactory)方法</h4><ul>
<li>org.springframework.context.support.AbstractRefreshableApplicationContext中定义的抽象方法loadBeanDefinitions(DefaultListableBeanFactory beanFactory)的一个实现<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(DefaultListableBeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException, IOException </span>&#123;<br>	<span class="hljs-comment">// Create a new XmlBeanDefinitionReader for the given BeanFactory.</span><br>	<span class="hljs-comment">// 通过上一步创建的空BeanFactory来创建新的XmlBeanDefinitionReader对象</span><br>	<span class="hljs-comment">// XmlBeanDefinitionReader用于解析xml文件中定义的bean</span><br>	XmlBeanDefinitionReader beanDefinitionReader = <span class="hljs-keyword">new</span> XmlBeanDefinitionReader(beanFactory); <span class="hljs-comment">//</span><br><br>	<span class="hljs-comment">// Configure the bean definition reader with this context&#x27;s</span><br>	<span class="hljs-comment">// resource loading environment.</span><br>	beanDefinitionReader.setEnvironment(<span class="hljs-keyword">this</span>.getEnvironment());<br>	beanDefinitionReader.setResourceLoader(<span class="hljs-keyword">this</span>);<br>	beanDefinitionReader.setEntityResolver(<span class="hljs-keyword">new</span> ResourceEntityResolver(<span class="hljs-keyword">this</span>));<br><br>	<span class="hljs-comment">// Allow a subclass to provide custom initialization of the reader,</span><br>	<span class="hljs-comment">// then proceed with actually loading the bean definitions.</span><br>	initBeanDefinitionReader(beanDefinitionReader);<br>	loadBeanDefinitions(beanDefinitionReader); <span class="hljs-comment">//这是一个重载方法，入参是上面生成的beanDefinitionReader</span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="new-XmlBeanDefinitionReader-beanFactory"><a href="#new-XmlBeanDefinitionReader-beanFactory" class="headerlink" title="new XmlBeanDefinitionReader(beanFactory)"></a>new XmlBeanDefinitionReader(beanFactory)</h4><ul>
<li>XmlBeanDefinitionReader(beanFactory)构造方法调用其父类AbstractBeanDefinitionReader的构造方法，具体如下<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-title">AbstractBeanDefinitionReader</span><span class="hljs-params">(BeanDefinitionRegistry registry)</span> </span>&#123;<br>	Assert.notNull(registry, <span class="hljs-string">&quot;BeanDefinitionRegistry must not be null&quot;</span>);<br>	<span class="hljs-keyword">this</span>.registry = registry;<br><br>	<span class="hljs-comment">// Determine ResourceLoader to use.</span><br>	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.registry <span class="hljs-keyword">instanceof</span> ResourceLoader) &#123;<br>		<span class="hljs-keyword">this</span>.resourceLoader = (ResourceLoader) <span class="hljs-keyword">this</span>.registry;<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-keyword">this</span>.resourceLoader = <span class="hljs-keyword">new</span> PathMatchingResourcePatternResolver();<br>	&#125;<br><br>	<span class="hljs-comment">// Inherit Environment if possible</span><br>	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.registry <span class="hljs-keyword">instanceof</span> EnvironmentCapable) &#123;<br>		<span class="hljs-keyword">this</span>.environment = ((EnvironmentCapable) <span class="hljs-keyword">this</span>.registry).getEnvironment();<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-keyword">this</span>.environment = <span class="hljs-keyword">new</span> StandardEnvironment();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="AbstractXmlApplicationContext抽象类中的initBeanDefinitionReader-beanDefinitionReader-方法"><a href="#AbstractXmlApplicationContext抽象类中的initBeanDefinitionReader-beanDefinitionReader-方法" class="headerlink" title="AbstractXmlApplicationContext抽象类中的initBeanDefinitionReader(beanDefinitionReader)方法"></a>AbstractXmlApplicationContext抽象类中的initBeanDefinitionReader(beanDefinitionReader)方法</h4><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initBeanDefinitionReader</span><span class="hljs-params">(XmlBeanDefinitionReader reader)</span> </span>&#123;<br>	reader.setValidating(<span class="hljs-keyword">this</span>.validating);<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="AbstractXmlApplicationContext抽象类中的loadBeanDefinitions-XmlBeanDefinitionReader-reader-方法"><a href="#AbstractXmlApplicationContext抽象类中的loadBeanDefinitions-XmlBeanDefinitionReader-reader-方法" class="headerlink" title="AbstractXmlApplicationContext抽象类中的loadBeanDefinitions(XmlBeanDefinitionReader reader)方法"></a>AbstractXmlApplicationContext抽象类中的loadBeanDefinitions(XmlBeanDefinitionReader reader)方法</h4><ul>
<li>主要功能是解析资源文件的位置</li>
<li>调用XmlBeanDefinitionReader对象的loadBeanDefinitions方法解析bean的定义<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(XmlBeanDefinitionReader reader)</span> <span class="hljs-keyword">throws</span> BeansException, IOException </span>&#123;<br>	Resource[] configResources = getConfigResources();<br>	<span class="hljs-keyword">if</span> (configResources != <span class="hljs-keyword">null</span>) &#123;<br>		reader.loadBeanDefinitions(configResources); <span class="hljs-comment">//具体调用AbstractBeanDefinitionReader中实现的loadBeanDefinitions(Resource... resources)方法</span><br>	&#125;<br>	String[] configLocations = getConfigLocations();<br>	<span class="hljs-keyword">if</span> (configLocations != <span class="hljs-keyword">null</span>) &#123;<br>		reader.loadBeanDefinitions(configLocations);<span class="hljs-comment">//具体调用AbstractBeanDefinitionReader中实现的loadBeanDefinitions(String... locations)</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="reader-loadBeanDefinitions-configResources-方法与reader-loadBeanDefinitions-configLocations-方法"><a href="#reader-loadBeanDefinitions-configResources-方法与reader-loadBeanDefinitions-configLocations-方法" class="headerlink" title="reader.loadBeanDefinitions(configResources)方法与reader.loadBeanDefinitions(configLocations)方法"></a>reader.loadBeanDefinitions(configResources)方法与reader.loadBeanDefinitions(configLocations)方法</h5><ul>
<li>XmlBeanDefinitionReader对象的loadBeanDefinitions方法用于解析bean的定义</li>
<li>reader是XmlBeanDefinitionReader类型的对象，loadBeanDefinitions方法定义在BeanDefinitionReader接口中，</li>
<li>loadBeanDefinitions方法具体是在AbstractBeanDefinitionReader抽象类中实现的，具体代码如下：<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(Resource... resources)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br>	Assert.notNull(resources, <span class="hljs-string">&quot;Resource array must not be null&quot;</span>);<br>	<span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br>	<span class="hljs-comment">// 遍历每一个资源并依次调用重载方法loadBeanDefinitions(Resource resource)，定义在XmlBeanDefinitionReader中，具体实现在XmlBeanDefinitionReader中</span><br>	<span class="hljs-keyword">for</span> (Resource resource : resources) &#123;<br>		count += loadBeanDefinitions(resource);<span class="hljs-comment">//</span><br>	&#125;<br>	<span class="hljs-keyword">return</span> count;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(String... locations)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br>	Assert.notNull(locations, <span class="hljs-string">&quot;Location array must not be null&quot;</span>);<br>	<span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br>	<span class="hljs-comment">//遍历资源数组，调用重载方法loadBeanDefinitions(String location)</span><br>	<span class="hljs-keyword">for</span> (String location : locations) &#123;<br>		count += loadBeanDefinitions(location);<span class="hljs-comment">//</span><br>	&#125;<br>	<span class="hljs-keyword">return</span> count;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="count-loadBeanDefinitions-resource-中的loadBeanDefinitions-resource-方法"><a href="#count-loadBeanDefinitions-resource-中的loadBeanDefinitions-resource-方法" class="headerlink" title="count += loadBeanDefinitions(resource)中的loadBeanDefinitions(resource)方法"></a>count += loadBeanDefinitions(resource)中的loadBeanDefinitions(resource)方法</h4><ul>
<li>loadBeanDefinitions(resource)方法在BeanDefinitionReader接口中定义，具体实现是在XmlBeanDefinitionReader中</li>
<li>XmlBeanDefinitionReader中的实现代码如下：<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(Resource resource)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br>	<span class="hljs-keyword">return</span> loadBeanDefinitions(<span class="hljs-keyword">new</span> EncodedResource(resource));<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>可以看到，上面的方法又调用了loadBeanDefinitions(new EncodedResource(resource))方法，该方法在BeanDefinitionReader接口中定义，具体实现在XmlBeanDefinitionReader中,具体实现，详细代码如下：<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(EncodedResource encodedResource)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br>	Assert.notNull(encodedResource, <span class="hljs-string">&quot;EncodedResource must not be null&quot;</span>);<br>	<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>		logger.trace(<span class="hljs-string">&quot;Loading XML bean definitions from &quot;</span> + encodedResource);<br>	&#125;<br><br>	Set&lt;EncodedResource&gt; currentResources = <span class="hljs-keyword">this</span>.resourcesCurrentlyBeingLoaded.get();<br>	<span class="hljs-keyword">if</span> (currentResources == <span class="hljs-keyword">null</span>) &#123;<br>		currentResources = <span class="hljs-keyword">new</span> HashSet&lt;&gt;(<span class="hljs-number">4</span>);<br>		<span class="hljs-keyword">this</span>.resourcesCurrentlyBeingLoaded.set(currentResources);<br>	&#125;<br>	<span class="hljs-keyword">if</span> (!currentResources.add(encodedResource)) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(<span class="hljs-string">&quot;Detected cyclic loading of &quot;</span> + encodedResource + <span class="hljs-string">&quot; - check your import definitions!&quot;</span>);<br>	&#125;<br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-comment">//以流的形式读取资源文件</span><br>		InputStream inputStream = encodedResource.getResource().getInputStream();<br>		<span class="hljs-keyword">try</span> &#123;<br>			InputSource inputSource = <span class="hljs-keyword">new</span> InputSource(inputStream);<br>			<span class="hljs-keyword">if</span> (encodedResource.getEncoding() != <span class="hljs-keyword">null</span>) &#123;<br>				inputSource.setEncoding(encodedResource.getEncoding());<br>			&#125;<br>			<span class="hljs-comment">// 调用doLoadBeanDefinitions解析载入文件中的bean定义</span><br>			<span class="hljs-keyword">return</span> doLoadBeanDefinitions(inputSource, encodedResource.getResource());<br>		&#125;<br>		<span class="hljs-keyword">finally</span> &#123;<br>			inputStream.close();<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (IOException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(<br>				<span class="hljs-string">&quot;IOException parsing XML document from &quot;</span> + encodedResource.getResource(), ex);<br>	&#125;<br>	<span class="hljs-keyword">finally</span> &#123;<br>		currentResources.remove(encodedResource);<br>		<span class="hljs-keyword">if</span> (currentResources.isEmpty()) &#123;<br>			<span class="hljs-keyword">this</span>.resourcesCurrentlyBeingLoaded.remove();<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="count-loadBeanDefinitions-location-中的loadBeanDefinitions-location-方法"><a href="#count-loadBeanDefinitions-location-中的loadBeanDefinitions-location-方法" class="headerlink" title="count += loadBeanDefinitions(location)中的loadBeanDefinitions(location)方法"></a>count += loadBeanDefinitions(location)中的loadBeanDefinitions(location)方法</h4><ul>
<li>loadBeanDefinitions(location)方法的具体实现AbstractBeanDefinitionReader中；<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(String location)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br>	<span class="hljs-keyword">return</span> loadBeanDefinitions(location, <span class="hljs-keyword">null</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
<li>解析资源文件的路径，得到Resource[]资源数组</li>
<li>上面AbstractBeanDefinitionReader中的loadBeanDefinitions(String location)方法又调用了同类里面的一个重载方法loadBeanDefinitions(String location, @Nullable Set<Resource> actualResources) 具体实现如下：<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">loadBeanDefinitions</span><span class="hljs-params">(String location, <span class="hljs-meta">@Nullable</span> Set&lt;Resource&gt; actualResources)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br>		ResourceLoader resourceLoader = getResourceLoader();<br>		<span class="hljs-keyword">if</span> (resourceLoader == <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(<br>					<span class="hljs-string">&quot;Cannot load bean definitions from location [&quot;</span> + location + <span class="hljs-string">&quot;]: no ResourceLoader available&quot;</span>);<br>		&#125;<br><br>		<span class="hljs-keyword">if</span> (resourceLoader <span class="hljs-keyword">instanceof</span> ResourcePatternResolver) &#123;<br>			<span class="hljs-comment">// Resource pattern matching available.</span><br>			<span class="hljs-keyword">try</span> &#123;<br>				Resource[] resources = ((ResourcePatternResolver) resourceLoader).getResources(location);<br>				<span class="hljs-comment">//下一行的核心逻辑  调用上面提到的重载方法loadBeanDefinitions(Resource resource)</span><br>				<span class="hljs-keyword">int</span> count = loadBeanDefinitions(resources);<br>				<span class="hljs-keyword">if</span> (actualResources != <span class="hljs-keyword">null</span>) &#123;<br>					Collections.addAll(actualResources, resources);<br>				&#125;<br>				<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>					logger.trace(<span class="hljs-string">&quot;Loaded &quot;</span> + count + <span class="hljs-string">&quot; bean definitions from location pattern [&quot;</span> + location + <span class="hljs-string">&quot;]&quot;</span>);<br>				&#125;<br>				<span class="hljs-keyword">return</span> count;<br>			&#125;<br>			<span class="hljs-keyword">catch</span> (IOException ex) &#123;<br>				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(<br>						<span class="hljs-string">&quot;Could not resolve bean definition resource pattern [&quot;</span> + location + <span class="hljs-string">&quot;]&quot;</span>, ex);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-comment">// Can only load single resources by absolute URL.</span><br>			Resource resource = resourceLoader.getResource(location);<br>			<span class="hljs-keyword">int</span> count = loadBeanDefinitions(resource);<br>			<span class="hljs-keyword">if</span> (actualResources != <span class="hljs-keyword">null</span>) &#123;<br>				actualResources.add(resource);<br>			&#125;<br>			<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>				logger.trace(<span class="hljs-string">&quot;Loaded &quot;</span> + count + <span class="hljs-string">&quot; bean definitions from location [&quot;</span> + location + <span class="hljs-string">&quot;]&quot;</span>);<br>			&#125;<br>			<span class="hljs-keyword">return</span> count;<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="XmlBeanDefinitionReader类中的doLoadBeanDefinitions-InputSource-inputSource-Resource-resource-方法"><a href="#XmlBeanDefinitionReader类中的doLoadBeanDefinitions-InputSource-inputSource-Resource-resource-方法" class="headerlink" title="XmlBeanDefinitionReader类中的doLoadBeanDefinitions(InputSource inputSource, Resource resource)方法"></a>XmlBeanDefinitionReader类中的doLoadBeanDefinitions(InputSource inputSource, Resource resource)方法</h4><ul>
<li>该方法是载入定义bean的核心方法</li>
<li>代码位置：org.springframework.beans.factory.xml.XmlBeanDefinitionReader<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">int</span> <span class="hljs-title">doLoadBeanDefinitions</span><span class="hljs-params">(InputSource inputSource, Resource resource)</span></span><br><span class="hljs-function">		<span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br><br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-comment">// 解析XML文档</span><br>		Document doc = doLoadDocument(inputSource, resource);<br>		<span class="hljs-comment">// 下面一行代码 注册Bean</span><br>		<span class="hljs-keyword">int</span> count = registerBeanDefinitions(doc, resource);<br>		<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>			logger.debug(<span class="hljs-string">&quot;Loaded &quot;</span> + count + <span class="hljs-string">&quot; bean definitions from &quot;</span> + resource);<br>		&#125;<br>		<span class="hljs-keyword">return</span> count;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (BeanDefinitionStoreException ex) &#123;<br>		<span class="hljs-keyword">throw</span> ex;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (SAXParseException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> XmlBeanDefinitionStoreException(resource.getDescription(),<br>				<span class="hljs-string">&quot;Line &quot;</span> + ex.getLineNumber() + <span class="hljs-string">&quot; in XML document from &quot;</span> + resource + <span class="hljs-string">&quot; is invalid&quot;</span>, ex);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (SAXException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> XmlBeanDefinitionStoreException(resource.getDescription(),<br>				<span class="hljs-string">&quot;XML document from &quot;</span> + resource + <span class="hljs-string">&quot; is invalid&quot;</span>, ex);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (ParserConfigurationException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(resource.getDescription(),<br>				<span class="hljs-string">&quot;Parser configuration exception parsing XML from &quot;</span> + resource, ex);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (IOException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(resource.getDescription(),<br>				<span class="hljs-string">&quot;IOException parsing XML document from &quot;</span> + resource, ex);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(resource.getDescription(),<br>				<span class="hljs-string">&quot;Unexpected exception parsing XML document from &quot;</span> + resource, ex);<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// 注册Bean的方法</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">registerBeanDefinitions</span><span class="hljs-params">(Document doc, Resource resource)</span> <span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br>	BeanDefinitionDocumentReader documentReader = createBeanDefinitionDocumentReader();<br>	<span class="hljs-keyword">int</span> countBefore = getRegistry().getBeanDefinitionCount();<br>	<span class="hljs-comment">// 注册bean的核心逻辑</span><br>	documentReader.registerBeanDefinitions(doc, createReaderContext(resource));<br>	<span class="hljs-keyword">return</span> getRegistry().getBeanDefinitionCount() - countBefore;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="DefaultBeanDefinitionDocumentReader-registerBeanDefinitions-Document-doc-XmlReaderContext-readerContext"><a href="#DefaultBeanDefinitionDocumentReader-registerBeanDefinitions-Document-doc-XmlReaderContext-readerContext" class="headerlink" title="DefaultBeanDefinitionDocumentReader.registerBeanDefinitions(Document doc, XmlReaderContext readerContext)"></a>DefaultBeanDefinitionDocumentReader.registerBeanDefinitions(Document doc, XmlReaderContext readerContext)</h4><ul>
<li>功能：</li>
<li>代码位置：org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanDefinitions</span><span class="hljs-params">(Document doc, XmlReaderContext readerContext)</span> </span>&#123;<br>	<span class="hljs-keyword">this</span>.readerContext = readerContext;<br>	<span class="hljs-comment">// 核心逻辑</span><br>	doRegisterBeanDefinitions(doc.getDocumentElement());<br>&#125;<br><br><span class="hljs-comment">// registerBeanDefinitions方法中调用的doRegisterBeanDefinitions方法</span><br><span class="hljs-meta">@SuppressWarnings(&quot;deprecation&quot;)</span>  <span class="hljs-comment">// for Environment.acceptsProfiles(String...)</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doRegisterBeanDefinitions</span><span class="hljs-params">(Element root)</span> </span>&#123;<br>	<span class="hljs-comment">// Any nested &lt;beans&gt; elements will cause recursion in this method. In</span><br>	<span class="hljs-comment">// order to propagate and preserve &lt;beans&gt; default-* attributes correctly,</span><br>	<span class="hljs-comment">// keep track of the current (parent) delegate, which may be null. Create</span><br>	<span class="hljs-comment">// the new (child) delegate with a reference to the parent for fallback purposes,</span><br>	<span class="hljs-comment">// then ultimately reset this.delegate back to its original (parent) reference.</span><br>	<span class="hljs-comment">// this behavior emulates a stack of delegates without actually necessitating one.</span><br>	BeanDefinitionParserDelegate parent = <span class="hljs-keyword">this</span>.delegate;<br>	<span class="hljs-keyword">this</span>.delegate = createDelegate(getReaderContext(), root, parent);<br><br>	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.delegate.isDefaultNamespace(root)) &#123;<br>		String profileSpec = root.getAttribute(PROFILE_ATTRIBUTE);<br>		<span class="hljs-keyword">if</span> (StringUtils.hasText(profileSpec)) &#123;<br>			String[] specifiedProfiles = StringUtils.tokenizeToStringArray(<br>					profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);<br>			<span class="hljs-comment">// We cannot use Profiles.of(...) since profile expressions are not supported</span><br>			<span class="hljs-comment">// in XML config. See SPR-12458 for details.</span><br>			<span class="hljs-keyword">if</span> (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) &#123;<br>				<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>					logger.debug(<span class="hljs-string">&quot;Skipped XML bean definition file due to specified profiles [&quot;</span> + profileSpec +<br>							<span class="hljs-string">&quot;] not matching: &quot;</span> + getReaderContext().getResource());<br>				&#125;<br>				<span class="hljs-keyword">return</span>;<br>			&#125;<br>		&#125;<br>	&#125;<br><br>	preProcessXml(root);<br>	<span class="hljs-comment">// 核心逻辑</span><br>	parseBeanDefinitions(root, <span class="hljs-keyword">this</span>.delegate);<br>	postProcessXml(root);<br><br>	<span class="hljs-keyword">this</span>.delegate = parent;<br>&#125;<br><br><span class="hljs-comment">// 上面方法中调用的parseBeanDefinitions(root, this.delegate)对应的方法实现</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">parseBeanDefinitions</span><span class="hljs-params">(Element root, BeanDefinitionParserDelegate delegate)</span> </span>&#123;<br>	<span class="hljs-keyword">if</span> (delegate.isDefaultNamespace(root)) &#123;<br>		NodeList nl = root.getChildNodes();<br>		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; nl.getLength(); i++) &#123;<br>			Node node = nl.item(i);<br>			<span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> Element) &#123;<br>				Element ele = (Element) node;<br>				<span class="hljs-keyword">if</span> (delegate.isDefaultNamespace(ele)) &#123;<br>					<span class="hljs-comment">// 本方法的核心逻辑</span><br>					parseDefaultElement(ele, delegate);<br>				&#125;<br>				<span class="hljs-keyword">else</span> &#123;<br>					delegate.parseCustomElement(ele);<br>				&#125;<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		delegate.parseCustomElement(root);<br>	&#125;<br>&#125;<br><br><br><span class="hljs-comment">// 上述方法调用的parseDefaultElement(ele, delegate);的具体实现</span><br><span class="hljs-comment">// 根据bean配置的不同，进入不同分支</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">parseDefaultElement</span><span class="hljs-params">(Element ele, BeanDefinitionParserDelegate delegate)</span> </span>&#123;<br>	<span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) &#123;<br>		importBeanDefinitionResource(ele);<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) &#123;<br>		processAliasRegistration(ele);<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) &#123;<br>		<span class="hljs-comment">// 本文示例会进入该方法</span><br>		processBeanDefinition(ele, delegate);<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) &#123;<br>		<span class="hljs-comment">// recurse</span><br>		doRegisterBeanDefinitions(ele);<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// 上述方法最后进入processBeanDefinition(ele, delegate)后的处理过程：</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processBeanDefinition</span><span class="hljs-params">(Element ele, BeanDefinitionParserDelegate delegate)</span> </span>&#123;<br>	BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele);<br>	<span class="hljs-keyword">if</span> (bdHolder != <span class="hljs-keyword">null</span>) &#123;<br>		bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-comment">// Register the final decorated instance.</span><br>			<span class="hljs-comment">// 注册Bean的关键代码</span><br>			BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (BeanDefinitionStoreException ex) &#123;<br>			getReaderContext().error(<span class="hljs-string">&quot;Failed to register bean definition with name &#x27;&quot;</span> +<br>					bdHolder.getBeanName() + <span class="hljs-string">&quot;&#x27;&quot;</span>, ele, ex);<br>		&#125;<br>		<span class="hljs-comment">// Send registration event.</span><br>		getReaderContext().fireComponentRegistered(<span class="hljs-keyword">new</span> BeanComponentDefinition(bdHolder));<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="BeanDefinitionReaderUtils的registerBeanDefinition-bdHolder-getReaderContext-getRegistry-方法"><a href="#BeanDefinitionReaderUtils的registerBeanDefinition-bdHolder-getReaderContext-getRegistry-方法" class="headerlink" title="BeanDefinitionReaderUtils的registerBeanDefinition(bdHolder, getReaderContext().getRegistry())方法"></a>BeanDefinitionReaderUtils的registerBeanDefinition(bdHolder, getReaderContext().getRegistry())方法</h4><ul>
<li>主要作用：</li>
<li>代码位置：org.springframework.beans.factory.support.BeanDefinitionReaderUtils<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanDefinition</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">		BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)</span></span><br><span class="hljs-function">		<span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br><br>	<span class="hljs-comment">// Register bean definition under primary name.</span><br>	String beanName = definitionHolder.getBeanName();<br>	<span class="hljs-comment">// 将Bean的名字和BeanDefinition对象进行注册</span><br>	<span class="hljs-comment">// registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());方法定义在BeanDefinitionRegistry接口中：</span><br>	<span class="hljs-comment">// 具体实现在中实现</span><br>	registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());<br><br>	<span class="hljs-comment">// Register aliases for bean name, if any.</span><br>	String[] aliases = definitionHolder.getAliases();<br>	<span class="hljs-keyword">if</span> (aliases != <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-keyword">for</span> (String alias : aliases) &#123;<br>			registry.registerAlias(beanName, alias);<br>		&#125;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="DefaultListableBeanFactory中registerBeanDefinition-String-beanName-BeanDefinition-beanDefinition"><a href="#DefaultListableBeanFactory中registerBeanDefinition-String-beanName-BeanDefinition-beanDefinition" class="headerlink" title="DefaultListableBeanFactory中registerBeanDefinition(String beanName, BeanDefinition beanDefinition)"></a>DefaultListableBeanFactory中registerBeanDefinition(String beanName, BeanDefinition beanDefinition)</h4><ul>
<li>作用：</li>
<li>DefaultListableBeanFactory的字段beanDefinitionMap是一个ConcurrentHashMap&lt;String, BeanDefinition&gt;，用于存储bean的定义信息</li>
<li>DefaultListableBeanFactory的字段beanDefinitionNames是一个ArrayList<String>类型数据，用于存储Bean的名称</li>
<li>代码位置：org.springframework.beans.factory.support.DefaultListableBeanFactory</li>
<li><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanDefinition</span><span class="hljs-params">(String beanName, BeanDefinition beanDefinition)</span></span><br><span class="hljs-function">		<span class="hljs-keyword">throws</span> BeanDefinitionStoreException </span>&#123;<br><br>	Assert.hasText(beanName, <span class="hljs-string">&quot;Bean name must not be empty&quot;</span>);<br>	Assert.notNull(beanDefinition, <span class="hljs-string">&quot;BeanDefinition must not be null&quot;</span>);<br><br>	<span class="hljs-keyword">if</span> (beanDefinition <span class="hljs-keyword">instanceof</span> AbstractBeanDefinition) &#123;<br>		<span class="hljs-keyword">try</span> &#123;<br>			((AbstractBeanDefinition) beanDefinition).validate();<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (BeanDefinitionValidationException ex) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(beanDefinition.getResourceDescription(), beanName,<br>					<span class="hljs-string">&quot;Validation of bean definition failed&quot;</span>, ex);<br>		&#125;<br>	&#125;<br><br>	BeanDefinition existingDefinition = <span class="hljs-keyword">this</span>.beanDefinitionMap.get(beanName);<br>	<span class="hljs-comment">// 查找是否存在同名的bean</span><br>	<span class="hljs-keyword">if</span> (existingDefinition != <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-comment">// 有同名的bean存在时</span><br>		<span class="hljs-keyword">if</span> (!isAllowBeanDefinitionOverriding()) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionOverrideException(beanName, beanDefinition, existingDefinition);<br>		&#125;<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (existingDefinition.getRole() &lt; beanDefinition.getRole()) &#123;<br>			<span class="hljs-comment">// e.g. was ROLE_APPLICATION, now overriding with ROLE_SUPPORT or ROLE_INFRASTRUCTURE</span><br>			<span class="hljs-keyword">if</span> (logger.isInfoEnabled()) &#123;<br>				logger.info(<span class="hljs-string">&quot;Overriding user-defined bean definition for bean &#x27;&quot;</span> + beanName +<br>						<span class="hljs-string">&quot;&#x27; with a framework-generated bean definition: replacing [&quot;</span> +<br>						existingDefinition + <span class="hljs-string">&quot;] with [&quot;</span> + beanDefinition + <span class="hljs-string">&quot;]&quot;</span>);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!beanDefinition.equals(existingDefinition)) &#123;<br>			<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>				logger.debug(<span class="hljs-string">&quot;Overriding bean definition for bean &#x27;&quot;</span> + beanName +<br>						<span class="hljs-string">&quot;&#x27; with a different definition: replacing [&quot;</span> + existingDefinition +<br>						<span class="hljs-string">&quot;] with [&quot;</span> + beanDefinition + <span class="hljs-string">&quot;]&quot;</span>);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>				logger.trace(<span class="hljs-string">&quot;Overriding bean definition for bean &#x27;&quot;</span> + beanName +<br>						<span class="hljs-string">&quot;&#x27; with an equivalent definition: replacing [&quot;</span> + existingDefinition +<br>						<span class="hljs-string">&quot;] with [&quot;</span> + beanDefinition + <span class="hljs-string">&quot;]&quot;</span>);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-comment">// 没有同名的bean存在时</span><br>		<span class="hljs-keyword">if</span> (hasBeanCreationStarted()) &#123;<br>			<span class="hljs-comment">// Cannot modify startup-time collection elements anymore (for stable iteration)</span><br>			<span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>.beanDefinitionMap) &#123;<br>				<span class="hljs-comment">// beanDefinitionMap存储beanName:BeanDefinition一一对应的K:V信息</span><br>				<span class="hljs-comment">// beanName作为key， beanDefinition作为value存入DefaultListableBeanFactory对象的beanDefinitionMap字段中</span><br>				<span class="hljs-comment">// 完成Bean的注册，将Bean注册到BeanFactory中</span><br>				<span class="hljs-keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);<br>				List&lt;String&gt; updatedDefinitions = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(<span class="hljs-keyword">this</span>.beanDefinitionNames.size() + <span class="hljs-number">1</span>);<br>				updatedDefinitions.addAll(<span class="hljs-keyword">this</span>.beanDefinitionNames);<br>				updatedDefinitions.add(beanName);<br>				<span class="hljs-comment">// 将所有的beanName保存到beanDefinitionNames字段中，数据类型为</span><br>				<span class="hljs-keyword">this</span>.beanDefinitionNames = updatedDefinitions;<br>				removeManualSingletonName(beanName);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-comment">// Still in startup registration phase</span><br>			<span class="hljs-keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);<br>			<span class="hljs-keyword">this</span>.beanDefinitionNames.add(beanName);<br>			removeManualSingletonName(beanName);<br>		&#125;<br>		<span class="hljs-keyword">this</span>.frozenBeanDefinitionNames = <span class="hljs-keyword">null</span>;<br>	&#125;<br><br>	<span class="hljs-keyword">if</span> (existingDefinition != <span class="hljs-keyword">null</span> || containsSingleton(beanName)) &#123;<br>		resetBeanDefinition(beanName);<br>	&#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure></li>
<li>到此上面的 loadBeanDefinitions(XmlBeanDefinitionReader reader)方法基本执行完成</li>
<li>上一级的loadBeanDefinitions(DefaultListableBeanFactory beanFactory)方法也执行到loadBeanDefinitions(XmlBeanDefinitionReader reader)方法后结束</li>
<li>在上述创建BeanFactory的过程中，BeanDefination注册到BeanFactory（DefaultListableBeanFactory）中的类型为ConcurrentHashMap&lt;String, BeanDefinition&gt;，字段名beanDefinitionMap的为对象中</li>
<li>向beanDefinitionMap中注册时beanName为key,beanDefination为value；</li>
<li>DefaultListableBeanFactory对象的字段beanDefinitionNames是一个ArrayList<String>类型数据，用于存储所有已经注册的Bean的名称</li>
<li>refreshBeanFactory()方法执行完成，接下来进入其下一行的getBeanFactory()方法</li>
</ul>
<h3 id="getBeanFactory-方法的一种实现"><a href="#getBeanFactory-方法的一种实现" class="headerlink" title="getBeanFactory()方法的一种实现"></a>getBeanFactory()方法的一种实现</h3><ul>
<li>AbstractRefreshableApplicationContext中getBeanFactory()方法的一种实现</li>
<li>获取BeanFactory<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> ConfigurableListableBeanFactory <span class="hljs-title">getBeanFactory</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>.beanFactoryMonitor) &#123;<br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.beanFactory == <span class="hljs-keyword">null</span>) &#123;<br>		   <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;BeanFactory not initialized or already closed - call &#x27;refresh&#x27; before accessing beans via the ApplicationContext&quot;</span>);<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.beanFactory;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>getBeanFactory()方法执行完，标志上一级的方法obtainFreshBeanFactory()执行完成，接下来将进入AbstractApplicationContext抽象类中定义的refresh()模板方法中的第三步定义的prepareBeanFactory(beanFactory)方法</li>
</ul>
<h1 id="6-prepareBeanFactory-beanFactory-方法"><a href="#6-prepareBeanFactory-beanFactory-方法" class="headerlink" title="6 prepareBeanFactory(beanFactory)方法"></a>6 prepareBeanFactory(beanFactory)方法</h1><ul>
<li>代码位置: org.springframework.context.support.AbstractApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">prepareBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;<br>		<span class="hljs-comment">// Tell the internal bean factory to use the context&#x27;s class loader etc.</span><br>		beanFactory.setBeanClassLoader(getClassLoader());<br>		beanFactory.setBeanExpressionResolver(<span class="hljs-keyword">new</span> StandardBeanExpressionResolver(beanFactory.getBeanClassLoader()));<br>		beanFactory.addPropertyEditorRegistrar(<span class="hljs-keyword">new</span> ResourceEditorRegistrar(<span class="hljs-keyword">this</span>, getEnvironment()));<br><br>		<span class="hljs-comment">// Configure the bean factory with context callbacks.</span><br>		beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> ApplicationContextAwareProcessor(<span class="hljs-keyword">this</span>));<br>		beanFactory.ignoreDependencyInterface(EnvironmentAware.class);<br>		beanFactory.ignoreDependencyInterface(EmbeddedValueResolverAware.class);<br>		beanFactory.ignoreDependencyInterface(ResourceLoaderAware.class);<br>		beanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class);<br>		beanFactory.ignoreDependencyInterface(MessageSourceAware.class);<br>		beanFactory.ignoreDependencyInterface(ApplicationContextAware.class);<br><br>		<span class="hljs-comment">// BeanFactory interface not registered as resolvable type in a plain factory.</span><br>		<span class="hljs-comment">// MessageSource registered (and found for autowiring) as a bean.</span><br>		beanFactory.registerResolvableDependency(BeanFactory.class, beanFactory);<br>		beanFactory.registerResolvableDependency(ResourceLoader.class, <span class="hljs-keyword">this</span>);<br>		beanFactory.registerResolvableDependency(ApplicationEventPublisher.class, <span class="hljs-keyword">this</span>);<br>		beanFactory.registerResolvableDependency(ApplicationContext.class, <span class="hljs-keyword">this</span>);<br><br>		<span class="hljs-comment">// Register early post-processor for detecting inner beans as ApplicationListeners.</span><br>		beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> ApplicationListenerDetector(<span class="hljs-keyword">this</span>));<br><br>		<span class="hljs-comment">// Detect a LoadTimeWeaver and prepare for weaving, if found.</span><br>		<span class="hljs-keyword">if</span> (beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123;<br>			beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> LoadTimeWeaverAwareProcessor(beanFactory));<br>			<span class="hljs-comment">// Set a temporary ClassLoader for type matching.</span><br>			beanFactory.setTempClassLoader(<span class="hljs-keyword">new</span> ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));<br>		&#125;<br><br>		<span class="hljs-comment">// Register default environment beans.</span><br>		<span class="hljs-keyword">if</span> (!beanFactory.containsLocalBean(ENVIRONMENT_BEAN_NAME)) &#123;<br>			beanFactory.registerSingleton(ENVIRONMENT_BEAN_NAME, getEnvironment());<br>		&#125;<br>		<span class="hljs-keyword">if</span> (!beanFactory.containsLocalBean(SYSTEM_PROPERTIES_BEAN_NAME)) &#123;<br>			beanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME, getEnvironment().getSystemProperties());<br>		&#125;<br>		<span class="hljs-keyword">if</span> (!beanFactory.containsLocalBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) &#123;<br>			beanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME, getEnvironment().getSystemEnvironment());<br>		&#125;<br>	&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="7-postProcessBeanFactory-ConfigurableListableBeanFactory-beanFactory"><a href="#7-postProcessBeanFactory-ConfigurableListableBeanFactory-beanFactory" class="headerlink" title="7    postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory)"></a>7    postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory)</h1><ul>
<li>代码位置:org.springframework.context.support.AbstractApplicationContext.java<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;<br>	<span class="hljs-comment">// 该方法是一个空方法，具体的实现依据具体的情况在其子类中继承或进行重写</span><br>	<span class="hljs-comment">// 观察AbstractApplicationContext到FileSystemXmlApplicationContext(location)的继承路径，其子类中并未实现具体的逻辑;</span><br>&#125;<br><br></code></pre></td></tr></table></figure></li>
<li>postProcessBeanFactory(beanFactory)执行完后进入 invokeBeanFactoryPostProcessors(beanFactory)方法</li>
</ul>
<h1 id="8-invokeBeanFactoryPostProcessors-beanFactory-方法"><a href="#8-invokeBeanFactoryPostProcessors-beanFactory-方法" class="headerlink" title="8. invokeBeanFactoryPostProcessors(beanFactory)方法"></a>8. invokeBeanFactoryPostProcessors(beanFactory)方法</h1><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invokeBeanFactoryPostProcessors</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;<br>	PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());<br><br>	<span class="hljs-comment">// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime</span><br>	<span class="hljs-comment">// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)</span><br>	<span class="hljs-keyword">if</span> (beanFactory.getTempClassLoader() == <span class="hljs-keyword">null</span> &amp;&amp; beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123;<br>		beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> LoadTimeWeaverAwareProcessor(beanFactory));<br>		beanFactory.setTempClassLoader(<span class="hljs-keyword">new</span> ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));<br>	&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;BeanFactoryPostProcessor&gt; <span class="hljs-title">getBeanFactoryPostProcessors</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.beanFactoryPostProcessors;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li>PostProcessorRegistrationDelegate的invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory, List<BeanFactoryPostProcessor> beanFactoryPostProcessors)静态方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invokeBeanFactoryPostProcessors</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">		ConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors)</span> </span>&#123;<br><br>	<span class="hljs-comment">// Invoke BeanDefinitionRegistryPostProcessors first, if any.</span><br>	Set&lt;String&gt; processedBeans = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();<br><br>	<span class="hljs-keyword">if</span> (beanFactory <span class="hljs-keyword">instanceof</span> BeanDefinitionRegistry) &#123;<br>		BeanDefinitionRegistry registry = (BeanDefinitionRegistry) beanFactory;<br>		List&lt;BeanFactoryPostProcessor&gt; regularPostProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>		List&lt;BeanDefinitionRegistryPostProcessor&gt; registryProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><br>		<span class="hljs-keyword">for</span> (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors) &#123;<br>			<span class="hljs-keyword">if</span> (postProcessor <span class="hljs-keyword">instanceof</span> BeanDefinitionRegistryPostProcessor) &#123;<br>				BeanDefinitionRegistryPostProcessor registryProcessor =<br>						(BeanDefinitionRegistryPostProcessor) postProcessor;<br>				registryProcessor.postProcessBeanDefinitionRegistry(registry);<br>				registryProcessors.add(registryProcessor);<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				regularPostProcessors.add(postProcessor);<br>			&#125;<br>		&#125;<br><br>		<span class="hljs-comment">// Do not initialize FactoryBeans here: We need to leave all regular beans</span><br>		<span class="hljs-comment">// uninitialized to let the bean factory post-processors apply to them!</span><br>		<span class="hljs-comment">// Separate between BeanDefinitionRegistryPostProcessors that implement</span><br>		<span class="hljs-comment">// PriorityOrdered, Ordered, and the rest.</span><br>		List&lt;BeanDefinitionRegistryPostProcessor&gt; currentRegistryProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><br>		<span class="hljs-comment">// First, invoke the BeanDefinitionRegistryPostProcessors that implement PriorityOrdered.</span><br>		String[] postProcessorNames =<br>				beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);<br>		<span class="hljs-keyword">for</span> (String ppName : postProcessorNames) &#123;<br>			<span class="hljs-keyword">if</span> (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;<br>				currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));<br>				processedBeans.add(ppName);<br>			&#125;<br>		&#125;<br>		sortPostProcessors(currentRegistryProcessors, beanFactory);<br>		registryProcessors.addAll(currentRegistryProcessors);<br>		invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);<br>		currentRegistryProcessors.clear();<br><br>		<span class="hljs-comment">// Next, invoke the BeanDefinitionRegistryPostProcessors that implement Ordered.</span><br>		postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);<br>		<span class="hljs-keyword">for</span> (String ppName : postProcessorNames) &#123;<br>			<span class="hljs-keyword">if</span> (!processedBeans.contains(ppName) &amp;&amp; beanFactory.isTypeMatch(ppName, Ordered.class)) &#123;<br>				currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));<br>				processedBeans.add(ppName);<br>			&#125;<br>		&#125;<br>		sortPostProcessors(currentRegistryProcessors, beanFactory);<br>		registryProcessors.addAll(currentRegistryProcessors);<br>		invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);<br>		currentRegistryProcessors.clear();<br><br>		<span class="hljs-comment">// Finally, invoke all other BeanDefinitionRegistryPostProcessors until no further ones appear.</span><br>		<span class="hljs-keyword">boolean</span> reiterate = <span class="hljs-keyword">true</span>;<br>		<span class="hljs-keyword">while</span> (reiterate) &#123;<br>			reiterate = <span class="hljs-keyword">false</span>;<br>			postProcessorNames = beanFactory.getBeanNamesForType(BeanDefinitionRegistryPostProcessor.class, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);<br>			<span class="hljs-keyword">for</span> (String ppName : postProcessorNames) &#123;<br>				<span class="hljs-keyword">if</span> (!processedBeans.contains(ppName)) &#123;<br>					currentRegistryProcessors.add(beanFactory.getBean(ppName, BeanDefinitionRegistryPostProcessor.class));<br>					processedBeans.add(ppName);<br>					reiterate = <span class="hljs-keyword">true</span>;<br>				&#125;<br>			&#125;<br>			sortPostProcessors(currentRegistryProcessors, beanFactory);<br>			registryProcessors.addAll(currentRegistryProcessors);<br>			invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry);<br>			currentRegistryProcessors.clear();<br>		&#125;<br><br>		<span class="hljs-comment">// Now, invoke the postProcessBeanFactory callback of all processors handled so far.</span><br>		invokeBeanFactoryPostProcessors(registryProcessors, beanFactory);<br>		invokeBeanFactoryPostProcessors(regularPostProcessors, beanFactory);<br>	&#125;<br><br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-comment">// Invoke factory processors registered with the context instance.</span><br>		invokeBeanFactoryPostProcessors(beanFactoryPostProcessors, beanFactory);<br>	&#125;<br><br>	<span class="hljs-comment">// Do not initialize FactoryBeans here: We need to leave all regular beans</span><br>	<span class="hljs-comment">// uninitialized to let the bean factory post-processors apply to them!</span><br>	String[] postProcessorNames =<br>			beanFactory.getBeanNamesForType(BeanFactoryPostProcessor.class, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);<br><br>	<span class="hljs-comment">// Separate between BeanFactoryPostProcessors that implement PriorityOrdered,</span><br>	<span class="hljs-comment">// Ordered, and the rest.</span><br>	List&lt;BeanFactoryPostProcessor&gt; priorityOrderedPostProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>	List&lt;String&gt; orderedPostProcessorNames = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>	List&lt;String&gt; nonOrderedPostProcessorNames = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>	<span class="hljs-keyword">for</span> (String ppName : postProcessorNames) &#123;<br>		<span class="hljs-keyword">if</span> (processedBeans.contains(ppName)) &#123;<br>			<span class="hljs-comment">// skip - already processed in first phase above</span><br>		&#125;<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;<br>			priorityOrderedPostProcessors.add(beanFactory.getBean(ppName, BeanFactoryPostProcessor.class));<br>		&#125;<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (beanFactory.isTypeMatch(ppName, Ordered.class)) &#123;<br>			orderedPostProcessorNames.add(ppName);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			nonOrderedPostProcessorNames.add(ppName);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// First, invoke the BeanFactoryPostProcessors that implement PriorityOrdered.</span><br>	sortPostProcessors(priorityOrderedPostProcessors, beanFactory);<br>	invokeBeanFactoryPostProcessors(priorityOrderedPostProcessors, beanFactory);<br><br>	<span class="hljs-comment">// Next, invoke the BeanFactoryPostProcessors that implement Ordered.</span><br>	List&lt;BeanFactoryPostProcessor&gt; orderedPostProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(orderedPostProcessorNames.size());<br>	<span class="hljs-keyword">for</span> (String postProcessorName : orderedPostProcessorNames) &#123;<br>		orderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));<br>	&#125;<br>	sortPostProcessors(orderedPostProcessors, beanFactory);<br>	invokeBeanFactoryPostProcessors(orderedPostProcessors, beanFactory);<br><br>	<span class="hljs-comment">// Finally, invoke all other BeanFactoryPostProcessors.</span><br>	List&lt;BeanFactoryPostProcessor&gt; nonOrderedPostProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());<br>	<span class="hljs-keyword">for</span> (String postProcessorName : nonOrderedPostProcessorNames) &#123;<br>		nonOrderedPostProcessors.add(beanFactory.getBean(postProcessorName, BeanFactoryPostProcessor.class));<br>	&#125;<br>	invokeBeanFactoryPostProcessors(nonOrderedPostProcessors, beanFactory);<br><br>	<span class="hljs-comment">// Clear cached merged bean definitions since the post-processors might have</span><br>	<span class="hljs-comment">// modified the original metadata, e.g. replacing placeholders in values...</span><br>	beanFactory.clearMetadataCache();<br>&#125;<br><br><span class="hljs-comment">// 上面的方法内部有调用该重载方法</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invokeBeanDefinitionRegistryPostProcessors</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">		Collection&lt;? extends BeanDefinitionRegistryPostProcessor&gt; postProcessors, BeanDefinitionRegistry registry)</span> </span>&#123;<br><br>	<span class="hljs-keyword">for</span> (BeanDefinitionRegistryPostProcessor postProcessor : postProcessors) &#123;<br>		postProcessor.postProcessBeanDefinitionRegistry(registry);<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// 上面的方法内部有调用该方法</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sortPostProcessors</span><span class="hljs-params">(List&lt;?&gt; postProcessors, ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;<br>	Comparator&lt;Object&gt; comparatorToUse = <span class="hljs-keyword">null</span>;<br>	<span class="hljs-keyword">if</span> (beanFactory <span class="hljs-keyword">instanceof</span> DefaultListableBeanFactory) &#123;<br>		comparatorToUse = ((DefaultListableBeanFactory) beanFactory).getDependencyComparator();<br>	&#125;<br>	<span class="hljs-keyword">if</span> (comparatorToUse == <span class="hljs-keyword">null</span>) &#123;<br>		comparatorToUse = OrderComparator.INSTANCE;<br>	&#125;<br>	postProcessors.sort(comparatorToUse);<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="9-registerBeanPostProcessors-beanFactory-方法"><a href="#9-registerBeanPostProcessors-beanFactory-方法" class="headerlink" title="9. registerBeanPostProcessors(beanFactory);方法"></a>9. registerBeanPostProcessors(beanFactory);方法</h1><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanPostProcessors</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;<br>	PostProcessorRegistrationDelegate.registerBeanPostProcessors(beanFactory, <span class="hljs-keyword">this</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<ul>
<li>PostProcessorRegistrationDelegate的registerBeanPostProcessors(ConfigurableListableBeanFactory beanFactory, AbstractApplicationContext applicationContexs)静态方法，具体代码如下：<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanPostProcessors</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">		ConfigurableListableBeanFactory beanFactory, AbstractApplicationContext applicationContext)</span> </span>&#123;<br><br>	String[] postProcessorNames = beanFactory.getBeanNamesForType(BeanPostProcessor.class, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);<br><br>	<span class="hljs-comment">// Register BeanPostProcessorChecker that logs an info message when</span><br>	<span class="hljs-comment">// a bean is created during BeanPostProcessor instantiation, i.e. when</span><br>	<span class="hljs-comment">// a bean is not eligible for getting processed by all BeanPostProcessors.</span><br>	<span class="hljs-keyword">int</span> beanProcessorTargetCount = beanFactory.getBeanPostProcessorCount() + <span class="hljs-number">1</span> + postProcessorNames.length;<br>	beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> BeanPostProcessorChecker(beanFactory, beanProcessorTargetCount));<br><br>	<span class="hljs-comment">// Separate between BeanPostProcessors that implement PriorityOrdered,</span><br>	<span class="hljs-comment">// Ordered, and the rest.</span><br>	List&lt;BeanPostProcessor&gt; priorityOrderedPostProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>	List&lt;BeanPostProcessor&gt; internalPostProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>	List&lt;String&gt; orderedPostProcessorNames = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>	List&lt;String&gt; nonOrderedPostProcessorNames = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>	<span class="hljs-keyword">for</span> (String ppName : postProcessorNames) &#123;<br>		<span class="hljs-keyword">if</span> (beanFactory.isTypeMatch(ppName, PriorityOrdered.class)) &#123;<br>			BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);<br>			priorityOrderedPostProcessors.add(pp);<br>			<span class="hljs-keyword">if</span> (pp <span class="hljs-keyword">instanceof</span> MergedBeanDefinitionPostProcessor) &#123;<br>				internalPostProcessors.add(pp);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (beanFactory.isTypeMatch(ppName, Ordered.class)) &#123;<br>			orderedPostProcessorNames.add(ppName);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			nonOrderedPostProcessorNames.add(ppName);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// First, register the BeanPostProcessors that implement PriorityOrdered.</span><br>	sortPostProcessors(priorityOrderedPostProcessors, beanFactory);<br>	registerBeanPostProcessors(beanFactory, priorityOrderedPostProcessors);<br><br>	<span class="hljs-comment">// Next, register the BeanPostProcessors that implement Ordered.</span><br>	List&lt;BeanPostProcessor&gt; orderedPostProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(orderedPostProcessorNames.size());<br>	<span class="hljs-keyword">for</span> (String ppName : orderedPostProcessorNames) &#123;<br>		BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);<br>		orderedPostProcessors.add(pp);<br>		<span class="hljs-keyword">if</span> (pp <span class="hljs-keyword">instanceof</span> MergedBeanDefinitionPostProcessor) &#123;<br>			internalPostProcessors.add(pp);<br>		&#125;<br>	&#125;<br>	sortPostProcessors(orderedPostProcessors, beanFactory);<br>	registerBeanPostProcessors(beanFactory, orderedPostProcessors);<br><br>	<span class="hljs-comment">// Now, register all regular BeanPostProcessors.</span><br>	List&lt;BeanPostProcessor&gt; nonOrderedPostProcessors = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(nonOrderedPostProcessorNames.size());<br>	<span class="hljs-keyword">for</span> (String ppName : nonOrderedPostProcessorNames) &#123;<br>		BeanPostProcessor pp = beanFactory.getBean(ppName, BeanPostProcessor.class);<br>		nonOrderedPostProcessors.add(pp);<br>		<span class="hljs-keyword">if</span> (pp <span class="hljs-keyword">instanceof</span> MergedBeanDefinitionPostProcessor) &#123;<br>			internalPostProcessors.add(pp);<br>		&#125;<br>	&#125;<br>	registerBeanPostProcessors(beanFactory, nonOrderedPostProcessors);<br><br>	<span class="hljs-comment">// Finally, re-register all internal BeanPostProcessors.</span><br>	sortPostProcessors(internalPostProcessors, beanFactory);<br>	registerBeanPostProcessors(beanFactory, internalPostProcessors);<br><br>	<span class="hljs-comment">// Re-register post-processor for detecting inner beans as ApplicationListeners,</span><br>	<span class="hljs-comment">// moving it to the end of the processor chain (for picking up proxies etc).</span><br>	beanFactory.addBeanPostProcessor(<span class="hljs-keyword">new</span> ApplicationListenerDetector(applicationContext));<br>&#125;<br><br><br><span class="hljs-comment">//上面的方法内部有调用该重载方法</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanPostProcessors</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">		ConfigurableListableBeanFactory beanFactory, List&lt;BeanPostProcessor&gt; postProcessors)</span> </span>&#123;<br><br>	<span class="hljs-keyword">for</span> (BeanPostProcessor postProcessor : postProcessors) &#123;<br>		beanFactory.addBeanPostProcessor(postProcessor);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="10-initMessageSource-方法"><a href="#10-initMessageSource-方法" class="headerlink" title="10. initMessageSource();方法"></a>10. initMessageSource();方法</h1><ul>
<li>org.springframework.context.support.AbstractApplicationContext中的initMessageSource()方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initMessageSource</span><span class="hljs-params">()</span> </span>&#123;<br>	ConfigurableListableBeanFactory beanFactory = getBeanFactory();<br>	<span class="hljs-keyword">if</span> (beanFactory.containsLocalBean(MESSAGE_SOURCE_BEAN_NAME)) &#123;<br>		<span class="hljs-keyword">this</span>.messageSource = beanFactory.getBean(MESSAGE_SOURCE_BEAN_NAME, MessageSource.class);<br>		<span class="hljs-comment">// Make MessageSource aware of parent MessageSource.</span><br>		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.parent != <span class="hljs-keyword">null</span> &amp;&amp; <span class="hljs-keyword">this</span>.messageSource <span class="hljs-keyword">instanceof</span> HierarchicalMessageSource) &#123;<br>			HierarchicalMessageSource hms = (HierarchicalMessageSource) <span class="hljs-keyword">this</span>.messageSource;<br>			<span class="hljs-keyword">if</span> (hms.getParentMessageSource() == <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-comment">// Only set parent context as parent MessageSource if no parent MessageSource</span><br>				<span class="hljs-comment">// registered already.</span><br>				hms.setParentMessageSource(getInternalParentMessageSource());<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>			logger.trace(<span class="hljs-string">&quot;Using MessageSource [&quot;</span> + <span class="hljs-keyword">this</span>.messageSource + <span class="hljs-string">&quot;]&quot;</span>);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-comment">// Use empty MessageSource to be able to accept getMessage calls.</span><br>		DelegatingMessageSource dms = <span class="hljs-keyword">new</span> DelegatingMessageSource();<br>		dms.setParentMessageSource(getInternalParentMessageSource());<br>		<span class="hljs-keyword">this</span>.messageSource = dms;<br>		beanFactory.registerSingleton(MESSAGE_SOURCE_BEAN_NAME, <span class="hljs-keyword">this</span>.messageSource);<br>		<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>			logger.trace(<span class="hljs-string">&quot;No &#x27;&quot;</span> + MESSAGE_SOURCE_BEAN_NAME + <span class="hljs-string">&quot;&#x27; bean, using [&quot;</span> + <span class="hljs-keyword">this</span>.messageSource + <span class="hljs-string">&quot;]&quot;</span>);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="11-initApplicationEventMulticaster-方法"><a href="#11-initApplicationEventMulticaster-方法" class="headerlink" title="11. initApplicationEventMulticaster();方法"></a>11. initApplicationEventMulticaster();方法</h1><ul>
<li>org.springframework.context.support.AbstractApplicationContext中的initApplicationEventMulticaster()方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initApplicationEventMulticaster</span><span class="hljs-params">()</span> </span>&#123;<br>	ConfigurableListableBeanFactory beanFactory = getBeanFactory();<br>	<span class="hljs-keyword">if</span> (beanFactory.containsLocalBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME)) &#123;<br>		<span class="hljs-keyword">this</span>.applicationEventMulticaster =<br>				beanFactory.getBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, ApplicationEventMulticaster.class);<br>		<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>			logger.trace(<span class="hljs-string">&quot;Using ApplicationEventMulticaster [&quot;</span> + <span class="hljs-keyword">this</span>.applicationEventMulticaster + <span class="hljs-string">&quot;]&quot;</span>);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-keyword">this</span>.applicationEventMulticaster = <span class="hljs-keyword">new</span> SimpleApplicationEventMulticaster(beanFactory);<br>		beanFactory.registerSingleton(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, <span class="hljs-keyword">this</span>.applicationEventMulticaster);<br>		<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>			logger.trace(<span class="hljs-string">&quot;No &#x27;&quot;</span> + APPLICATION_EVENT_MULTICASTER_BEAN_NAME + <span class="hljs-string">&quot;&#x27; bean, using &quot;</span> +<br>					<span class="hljs-string">&quot;[&quot;</span> + <span class="hljs-keyword">this</span>.applicationEventMulticaster.getClass().getSimpleName() + <span class="hljs-string">&quot;]&quot;</span>);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="12-onRefresh-方法"><a href="#12-onRefresh-方法" class="headerlink" title="12. onRefresh();方法"></a>12. onRefresh();方法</h1><ul>
<li>org.springframework.context.support.AbstractApplicationContext中的onRefresh()方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onRefresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>	<span class="hljs-comment">// 该方法是一个空方法，具体的实现依据具体的情况在其子类中继承或进行重写</span><br>	<span class="hljs-comment">// For subclasses: do nothing by default.</span><br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="13-registerListeners-方法"><a href="#13-registerListeners-方法" class="headerlink" title="13. registerListeners();方法"></a>13. registerListeners();方法</h1><ul>
<li>org.springframework.context.support.AbstractApplicationContext中的registerListeners()方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerListeners</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// Register statically specified listeners first.</span><br>	<span class="hljs-keyword">for</span> (ApplicationListener&lt;?&gt; listener : getApplicationListeners()) &#123;<br>		getApplicationEventMulticaster().addApplicationListener(listener);<br>	&#125;<br><br>	<span class="hljs-comment">// Do not initialize FactoryBeans here: We need to leave all regular beans</span><br>	<span class="hljs-comment">// uninitialized to let post-processors apply to them!</span><br>	String[] listenerBeanNames = getBeanNamesForType(ApplicationListener.class, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>);<br>	<span class="hljs-keyword">for</span> (String listenerBeanName : listenerBeanNames) &#123;<br>		getApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName);<br>	&#125;<br><br>	<span class="hljs-comment">// Publish early application events now that we finally have a multicaster...</span><br>	Set&lt;ApplicationEvent&gt; earlyEventsToProcess = <span class="hljs-keyword">this</span>.earlyApplicationEvents;<br>	<span class="hljs-keyword">this</span>.earlyApplicationEvents = <span class="hljs-keyword">null</span>;<br>	<span class="hljs-keyword">if</span> (earlyEventsToProcess != <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-keyword">for</span> (ApplicationEvent earlyEvent : earlyEventsToProcess) &#123;<br>			getApplicationEventMulticaster().multicastEvent(earlyEvent);<br>		&#125;<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="14-finishBeanFactoryInitialization-beanFactory-方法"><a href="#14-finishBeanFactoryInitialization-beanFactory-方法" class="headerlink" title="14. finishBeanFactoryInitialization(beanFactory);方法"></a>14. finishBeanFactoryInitialization(beanFactory);方法</h1><ul>
<li>org.springframework.context.support.AbstractApplicationContext中的finishBeanFactoryInitialization(beanFactory)方法</li>
<li>实例化Bean的核心方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">finishBeanFactoryInitialization</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;<br>	<span class="hljs-comment">// Initialize conversion service for this context.</span><br>	<span class="hljs-keyword">if</span> (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp;<br>			beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123;<br>		beanFactory.setConversionService(<br>				beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));<br>	&#125;<br><br>	<span class="hljs-comment">// Register a default embedded value resolver if no bean post-processor</span><br>	<span class="hljs-comment">// (such as a PropertyPlaceholderConfigurer bean) registered any before:</span><br>	<span class="hljs-comment">// at this point, primarily for resolution in annotation attribute values.</span><br>	<span class="hljs-keyword">if</span> (!beanFactory.hasEmbeddedValueResolver()) &#123;<br>		beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal));<br>	&#125;<br><br>	<span class="hljs-comment">// Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early.</span><br>	String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>);<br>	<span class="hljs-keyword">for</span> (String weaverAwareName : weaverAwareNames) &#123;<br>		getBean(weaverAwareName);<br>	&#125;<br><br>	<span class="hljs-comment">// Stop using the temporary ClassLoader for type matching.</span><br>	beanFactory.setTempClassLoader(<span class="hljs-keyword">null</span>);<br><br>	<span class="hljs-comment">// Allow for caching all bean definition metadata, not expecting further changes.</span><br>	beanFactory.freezeConfiguration();<br><br>	<span class="hljs-comment">// Instantiate all remaining (non-lazy-init) singletons.</span><br>	<span class="hljs-comment">// 实例化bean的核心代码</span><br>	beanFactory.preInstantiateSingletons(); <br>	<span class="hljs-comment">// 上一行的preInstantiateSingletons()方法定义在ConfigurableListableBeanFactory接口中，</span><br>	<span class="hljs-comment">// 具体实现是在DefaultListableBeanFactory中preInstantiateSingletons()方法</span><br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="DefaultListableBeanFactory中preInstantiateSingletons-方法"><a href="#DefaultListableBeanFactory中preInstantiateSingletons-方法" class="headerlink" title="DefaultListableBeanFactory中preInstantiateSingletons()方法"></a>DefaultListableBeanFactory中preInstantiateSingletons()方法</h4><figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">preInstantiateSingletons</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>	<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>		logger.trace(<span class="hljs-string">&quot;Pre-instantiating singletons in &quot;</span> + <span class="hljs-keyword">this</span>);<br>	&#125;<br><br>	<span class="hljs-comment">// Iterate over a copy to allow for init methods which in turn register new bean definitions.</span><br>	<span class="hljs-comment">// While this may not be part of the regular factory bootstrap, it does otherwise work fine.</span><br>	List&lt;String&gt; beanNames = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(<span class="hljs-keyword">this</span>.beanDefinitionNames);<br><br>	<span class="hljs-comment">// Trigger initialization of all non-lazy singleton beans...</span><br>	<span class="hljs-comment">// 遍历beanDefinitionNames这个ArrayList对象中的beanName，</span><br>	<span class="hljs-keyword">for</span> (String beanName : beanNames) &#123;<br>		RootBeanDefinition bd = getMergedLocalBeanDefinition(beanName);<br>		<span class="hljs-keyword">if</span> (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123;<br>			<span class="hljs-keyword">if</span> (isFactoryBean(beanName)) &#123;<br>				Object bean = getBean(FACTORY_BEAN_PREFIX + beanName);<br>				<span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> FactoryBean) &#123;<br>					<span class="hljs-keyword">final</span> FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean;<br>					<span class="hljs-keyword">boolean</span> isEagerInit;<br>					<span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-keyword">null</span> &amp;&amp; factory <span class="hljs-keyword">instanceof</span> SmartFactoryBean) &#123;<br>						isEagerInit = AccessController.doPrivileged((PrivilegedAction&lt;Boolean&gt;)<br>										((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit,<br>								getAccessControlContext());<br>					&#125;<br>					<span class="hljs-keyword">else</span> &#123;<br>						isEagerInit = (factory <span class="hljs-keyword">instanceof</span> SmartFactoryBean &amp;&amp;<br>								((SmartFactoryBean&lt;?&gt;) factory).isEagerInit());<br>					&#125;<br>					<span class="hljs-keyword">if</span> (isEagerInit) &#123;<br>						<span class="hljs-comment">// 创建bean并递归构建Bean之间的依赖关系</span><br>						getBean(beanName);<br>					&#125;<br>				&#125;<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				<span class="hljs-comment">// 创建bean并递归构建Bean之间的依赖关系</span><br>				getBean(beanName);<br>			&#125;<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// Trigger post-initialization callback for all applicable beans...</span><br>	<span class="hljs-keyword">for</span> (String beanName : beanNames) &#123;<br>		Object singletonInstance = getSingleton(beanName);<br>		<span class="hljs-keyword">if</span> (singletonInstance <span class="hljs-keyword">instanceof</span> SmartInitializingSingleton) &#123;<br>			<span class="hljs-keyword">final</span> SmartInitializingSingleton smartSingleton = (SmartInitializingSingleton) singletonInstance;<br>			<span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-keyword">null</span>) &#123;<br>				AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123;<br>					smartSingleton.afterSingletonsInstantiated();<br>					<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>				&#125;, getAccessControlContext());<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				smartSingleton.afterSingletonsInstantiated();<br>			&#125;<br>		&#125;<br>	&#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h3 id="preInstantiateSingletons-方法中调用的getBean方法"><a href="#preInstantiateSingletons-方法中调用的getBean方法" class="headerlink" title="preInstantiateSingletons()方法中调用的getBean方法"></a>preInstantiateSingletons()方法中调用的getBean方法</h3><ul>
<li>getBean方法定义在BeanFactory接口中</li>
<li>getBean方法org.springframework.beans.factory.support.AbstractBeanFactory中实现<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getBean</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>	<span class="hljs-keyword">return</span> doGetBean(name, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>);<br>&#125;<br><br><br><br><span class="hljs-comment">//下面是上面方法调用doGetBean(name, null, null, false)方法</span><br><span class="hljs-comment">// 这个方法特别长，以下是完整代码：</span><br><span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">doGetBean</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String name, <span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">final</span> Class&lt;T&gt; requiredType,</span></span><br><span class="hljs-function"><span class="hljs-params">		<span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">final</span> Object[] args, <span class="hljs-keyword">boolean</span> typeCheckOnly)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br><br>	<span class="hljs-keyword">final</span> String beanName = transformedBeanName(name);<br>	Object bean;<br><br>	<span class="hljs-comment">// Eagerly check singleton cache for manually registered singletons.</span><br>	Object sharedInstance = getSingleton(beanName);<br>	<span class="hljs-keyword">if</span> (sharedInstance != <span class="hljs-keyword">null</span> &amp;&amp; args == <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>			<span class="hljs-keyword">if</span> (isSingletonCurrentlyInCreation(beanName)) &#123;<br>				logger.trace(<span class="hljs-string">&quot;Returning eagerly cached instance of singleton bean &#x27;&quot;</span> + beanName +<br>						<span class="hljs-string">&quot;&#x27; that is not fully initialized yet - a consequence of a circular reference&quot;</span>);<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				logger.trace(<span class="hljs-string">&quot;Returning cached instance of singleton bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>			&#125;<br>		&#125;<br>		bean = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="hljs-keyword">null</span>);<br>	&#125;<br><br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-comment">// Fail if we&#x27;re already creating this bean instance:</span><br>		<span class="hljs-comment">// We&#x27;re assumably within a circular reference.</span><br>		<span class="hljs-keyword">if</span> (isPrototypeCurrentlyInCreation(beanName)) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCurrentlyInCreationException(beanName);<br>		&#125;<br><br>		<span class="hljs-comment">// Check if bean definition exists in this factory.</span><br>		BeanFactory parentBeanFactory = getParentBeanFactory();<br>		<span class="hljs-keyword">if</span> (parentBeanFactory != <span class="hljs-keyword">null</span> &amp;&amp; !containsBeanDefinition(beanName)) &#123;<br>			<span class="hljs-comment">// Not found -&gt; check parent.</span><br>			String nameToLookup = originalBeanName(name);<br>			<span class="hljs-keyword">if</span> (parentBeanFactory <span class="hljs-keyword">instanceof</span> AbstractBeanFactory) &#123;<br>				<span class="hljs-keyword">return</span> ((AbstractBeanFactory) parentBeanFactory).doGetBean(<br>						nameToLookup, requiredType, args, typeCheckOnly);<br>			&#125;<br>			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (args != <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-comment">// Delegation to parent with explicit args.</span><br>				<span class="hljs-keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup, args);<br>			&#125;<br>			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (requiredType != <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-comment">// No args -&gt; delegate to standard getBean method.</span><br>				<span class="hljs-keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				<span class="hljs-keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup);<br>			&#125;<br>		&#125;<br><br>		<span class="hljs-keyword">if</span> (!typeCheckOnly) &#123;<br>			markBeanAsCreated(beanName);<br>		&#125;<br><br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-keyword">final</span> RootBeanDefinition mbd = getMergedLocalBeanDefinition(beanName);<br>			checkMergedBeanDefinition(mbd, beanName, args);<br><br>			<span class="hljs-comment">// Guarantee initialization of beans that the current bean depends on.</span><br>			<span class="hljs-comment">// 获取当前bean的依赖关系</span><br>			String[] dependsOn = mbd.getDependsOn();<br>			<span class="hljs-comment">// 根据依赖的beanName递归调用getBean()方法，不断探寻其依赖的bean，直到getSingleton方法返回依赖的Bean，即当前正在创建的Bean</span><br>			<span class="hljs-comment">// 直到依赖关系最底层的bean没有依赖对象了，至此整个递归过程结束  </span><br>			<span class="hljs-keyword">if</span> (dependsOn != <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-keyword">for</span> (String dep : dependsOn) &#123;<br>					<span class="hljs-keyword">if</span> (isDependent(beanName, dep)) &#123;<br>						<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,<br>								<span class="hljs-string">&quot;Circular depends-on relationship between &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27; and &#x27;&quot;</span> + dep + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>					&#125;<br>					<span class="hljs-comment">// </span><br>					registerDependentBean(dep, beanName);<br>					<span class="hljs-keyword">try</span> &#123;<br>						getBean(dep);<br>					&#125;<br>					<span class="hljs-keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;<br>						<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,<br>								<span class="hljs-string">&quot;&#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27; depends on missing bean &#x27;&quot;</span> + dep + <span class="hljs-string">&quot;&#x27;&quot;</span>, ex);<br>					&#125;<br>				&#125;<br>			&#125;<br>			<span class="hljs-comment">// Create bean instance.</span><br>			<span class="hljs-keyword">if</span> (mbd.isSingleton()) &#123;<br>				<span class="hljs-comment">// getSingleton方法的参数是createBean(beanName, mbd, args)方法的返回值</span><br>				sharedInstance = getSingleton(beanName, () -&gt; &#123;<br>					<span class="hljs-keyword">try</span> &#123;<br>						<span class="hljs-comment">// createBean方法在AbstractBeanFactory抽象类中定义，具体实现是在AbstractAutowireCapableBeanFactory抽象类中</span><br>						<span class="hljs-keyword">return</span> createBean(beanName, mbd, args);<br>					&#125;<br>					<span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>						<span class="hljs-comment">// Explicitly remove instance from singleton cache: It might have been put there</span><br>						<span class="hljs-comment">// eagerly by the creation process, to allow for circular reference resolution.</span><br>						<span class="hljs-comment">// Also remove any beans that received a temporary reference to the bean.</span><br>						destroySingleton(beanName);<br>						<span class="hljs-keyword">throw</span> ex;<br>					&#125;<br>				&#125;);<br>				bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);<br>			&#125;<br><br>			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mbd.isPrototype()) &#123;<br>				<span class="hljs-comment">// It&#x27;s a prototype -&gt; create a new instance.</span><br>				Object prototypeInstance = <span class="hljs-keyword">null</span>;<br>				<span class="hljs-keyword">try</span> &#123;<br>					beforePrototypeCreation(beanName);<br>					prototypeInstance = createBean(beanName, mbd, args);<br>				&#125;<br>				<span class="hljs-keyword">finally</span> &#123;<br>					afterPrototypeCreation(beanName);<br>				&#125;<br>				bean = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);<br>			&#125;<br><br>			<span class="hljs-keyword">else</span> &#123;<br>				String scopeName = mbd.getScope();<br>				<span class="hljs-keyword">final</span> Scope scope = <span class="hljs-keyword">this</span>.scopes.get(scopeName);<br>				<span class="hljs-keyword">if</span> (scope == <span class="hljs-keyword">null</span>) &#123;<br>					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">&quot;No Scope registered for scope name &#x27;&quot;</span> + scopeName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>				&#125;<br>				<span class="hljs-keyword">try</span> &#123;<br>					Object scopedInstance = scope.get(beanName, () -&gt; &#123;<br>						beforePrototypeCreation(beanName);<br>						<span class="hljs-keyword">try</span> &#123;<br>							<span class="hljs-keyword">return</span> createBean(beanName, mbd, args);<br>						&#125;<br>						<span class="hljs-keyword">finally</span> &#123;<br>							afterPrototypeCreation(beanName);<br>						&#125;<br>					&#125;);<br>					bean = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);<br>				&#125;<br>				<span class="hljs-keyword">catch</span> (IllegalStateException ex) &#123;<br>					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(beanName,<br>							<span class="hljs-string">&quot;Scope &#x27;&quot;</span> + scopeName + <span class="hljs-string">&quot;&#x27; is not active for the current thread; consider &quot;</span> +<br>							<span class="hljs-string">&quot;defining a scoped proxy for this bean if you intend to refer to it from a singleton&quot;</span>,<br>							ex);<br>				&#125;<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>			cleanupAfterBeanCreationFailure(beanName);<br>			<span class="hljs-keyword">throw</span> ex;<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// Check if required type matches the type of the actual bean instance.</span><br>	<span class="hljs-keyword">if</span> (requiredType != <span class="hljs-keyword">null</span> &amp;&amp; !requiredType.isInstance(bean)) &#123;<br>		<span class="hljs-keyword">try</span> &#123;<br>			T convertedBean = getTypeConverter().convertIfNecessary(bean, requiredType);<br>			<span class="hljs-keyword">if</span> (convertedBean == <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanNotOfRequiredTypeException(name, requiredType, bean.getClass());<br>			&#125;<br>			<span class="hljs-keyword">return</span> convertedBean;<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (TypeMismatchException ex) &#123;<br>			<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>				logger.trace(<span class="hljs-string">&quot;Failed to convert bean &#x27;&quot;</span> + name + <span class="hljs-string">&quot;&#x27; to required type &#x27;&quot;</span> +<br>						ClassUtils.getQualifiedName(requiredType) + <span class="hljs-string">&quot;&#x27;&quot;</span>, ex);<br>			&#125;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanNotOfRequiredTypeException(name, requiredType, bean.getClass());<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> (T) bean;<br>&#125;<br><br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="AbstractAutowireCapableBeanFactory类中的createBean-String-beanName-RootBeanDefinition-mbd-Nullable-Object-args-方法"><a href="#AbstractAutowireCapableBeanFactory类中的createBean-String-beanName-RootBeanDefinition-mbd-Nullable-Object-args-方法" class="headerlink" title="AbstractAutowireCapableBeanFactory类中的createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)方法"></a>AbstractAutowireCapableBeanFactory类中的createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)方法</h4><ul>
<li>代码位置：org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> Object <span class="hljs-title">createBean</span><span class="hljs-params">(String beanName, RootBeanDefinition mbd, <span class="hljs-meta">@Nullable</span> Object[] args)</span></span><br><span class="hljs-function">		<span class="hljs-keyword">throws</span> BeanCreationException </span>&#123;<br><br>	<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>		logger.trace(<span class="hljs-string">&quot;Creating instance of bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>	&#125;<br>	RootBeanDefinition mbdToUse = mbd;<br><br>	<span class="hljs-comment">// Make sure bean class is actually resolved at this point, and</span><br>	<span class="hljs-comment">// clone the bean definition in case of a dynamically resolved Class</span><br>	<span class="hljs-comment">// which cannot be stored in the shared merged bean definition.</span><br>	Class&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName);<br>	<span class="hljs-keyword">if</span> (resolvedClass != <span class="hljs-keyword">null</span> &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != <span class="hljs-keyword">null</span>) &#123;<br>		mbdToUse = <span class="hljs-keyword">new</span> RootBeanDefinition(mbd);<br>		mbdToUse.setBeanClass(resolvedClass);<br>	&#125;<br><br>	<span class="hljs-comment">// Prepare method overrides.</span><br>	<span class="hljs-keyword">try</span> &#123;<br>		mbdToUse.prepareMethodOverrides();<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (BeanDefinitionValidationException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(mbdToUse.getResourceDescription(),<br>				beanName, <span class="hljs-string">&quot;Validation of method overrides failed&quot;</span>, ex);<br>	&#125;<br><br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-comment">// Give BeanPostProcessors a chance to return a proxy instead of the target bean instance.</span><br>		Object bean = resolveBeforeInstantiation(beanName, mbdToUse);<br>		<span class="hljs-keyword">if</span> (bean != <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-keyword">return</span> bean;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(mbdToUse.getResourceDescription(), beanName,<br>				<span class="hljs-string">&quot;BeanPostProcessor before instantiation of bean failed&quot;</span>, ex);<br>	&#125;<br><br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-comment">// createBean方法的核心  该方法会返回Bean对象的实例，具体代码在下面贴出</span><br>		Object beanInstance = doCreateBean(beanName, mbdToUse, args);<br>		<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>			logger.trace(<span class="hljs-string">&quot;Finished creating instance of bean &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27;&quot;</span>);<br>		&#125;<br>		<span class="hljs-keyword">return</span> beanInstance;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (BeanCreationException | ImplicitlyAppearedSingletonException ex) &#123;<br>		<span class="hljs-comment">// A previously detected exception with proper bean creation context already,</span><br>		<span class="hljs-comment">// or illegal singleton state to be communicated up to DefaultSingletonBeanRegistry.</span><br>		<span class="hljs-keyword">throw</span> ex;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>				mbdToUse.getResourceDescription(), beanName, <span class="hljs-string">&quot;Unexpected exception during bean creation&quot;</span>, ex);<br>	&#125;<br>&#125;<br><br><br><br><span class="hljs-comment">// 在AbstractAutowireCapableBeanFactory抽象类的createBean方法中调用的doCreateBean(beanName, mbdToUse, args)方法</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> Object <span class="hljs-title">doCreateBean</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String beanName, <span class="hljs-keyword">final</span> RootBeanDefinition mbd, <span class="hljs-keyword">final</span> <span class="hljs-meta">@Nullable</span> Object[] args)</span></span><br><span class="hljs-function">		<span class="hljs-keyword">throws</span> BeanCreationException </span>&#123;<br><br>	<span class="hljs-comment">// Instantiate the bean.</span><br>	BeanWrapper instanceWrapper = <span class="hljs-keyword">null</span>;<br>	<span class="hljs-keyword">if</span> (mbd.isSingleton()) &#123;<br>		instanceWrapper = <span class="hljs-keyword">this</span>.factoryBeanInstanceCache.remove(beanName);<br>	&#125;<br>	<span class="hljs-keyword">if</span> (instanceWrapper == <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-comment">// 创建Bean实例</span><br>		instanceWrapper = createBeanInstance(beanName, mbd, args);<br>	&#125;<br>	<span class="hljs-keyword">final</span> Object bean = instanceWrapper.getWrappedInstance();<br>	Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();<br>	<span class="hljs-keyword">if</span> (beanType != NullBean.class) &#123;<br>		mbd.resolvedTargetType = beanType;<br>	&#125;<br><br>	<span class="hljs-comment">// Allow post-processors to modify the merged bean definition.</span><br>	<span class="hljs-keyword">synchronized</span> (mbd.postProcessingLock) &#123;<br>		<span class="hljs-keyword">if</span> (!mbd.postProcessed) &#123;<br>			<span class="hljs-keyword">try</span> &#123;<br>				applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);<br>			&#125;<br>			<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,<br>						<span class="hljs-string">&quot;Post-processing of merged bean definition failed&quot;</span>, ex);<br>			&#125;<br>			mbd.postProcessed = <span class="hljs-keyword">true</span>;<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// Eagerly cache singletons to be able to resolve circular references</span><br>	<span class="hljs-comment">// even when triggered by lifecycle interfaces like BeanFactoryAware.</span><br>	<span class="hljs-keyword">boolean</span> earlySingletonExposure = (mbd.isSingleton() &amp;&amp; <span class="hljs-keyword">this</span>.allowCircularReferences &amp;&amp;<br>			isSingletonCurrentlyInCreation(beanName));<br>	<span class="hljs-keyword">if</span> (earlySingletonExposure) &#123;<br>		<span class="hljs-keyword">if</span> (logger.isTraceEnabled()) &#123;<br>			logger.trace(<span class="hljs-string">&quot;Eagerly caching bean &#x27;&quot;</span> + beanName +<br>					<span class="hljs-string">&quot;&#x27; to allow for resolving potential circular references&quot;</span>);<br>		&#125;<br>		addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));<br>	&#125;<br><br>	<span class="hljs-comment">// Initialize the bean instance.</span><br>	Object exposedObject = bean;<br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-comment">// 填充bean，实际进行依赖注入的地方</span><br>		populateBean(beanName, mbd, instanceWrapper);<br>		exposedObject = initializeBean(beanName, exposedObject, mbd);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>		<span class="hljs-keyword">if</span> (ex <span class="hljs-keyword">instanceof</span> BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException) ex).getBeanName())) &#123;<br>			<span class="hljs-keyword">throw</span> (BeanCreationException) ex;<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>					mbd.getResourceDescription(), beanName, <span class="hljs-string">&quot;Initialization of bean failed&quot;</span>, ex);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-keyword">if</span> (earlySingletonExposure) &#123;<br>		Object earlySingletonReference = getSingleton(beanName, <span class="hljs-keyword">false</span>);<br>		<span class="hljs-keyword">if</span> (earlySingletonReference != <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-keyword">if</span> (exposedObject == bean) &#123;<br>				exposedObject = earlySingletonReference;<br>			&#125;<br>			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) &#123;<br>				String[] dependentBeans = getDependentBeans(beanName);<br>				Set&lt;String&gt; actualDependentBeans = <span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;(dependentBeans.length);<br>				<span class="hljs-keyword">for</span> (String dependentBean : dependentBeans) &#123;<br>					<span class="hljs-keyword">if</span> (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123;<br>						actualDependentBeans.add(dependentBean);<br>					&#125;<br>				&#125;<br>				<span class="hljs-keyword">if</span> (!actualDependentBeans.isEmpty()) &#123;<br>					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCurrentlyInCreationException(beanName,<br>							<span class="hljs-string">&quot;Bean with name &#x27;&quot;</span> + beanName + <span class="hljs-string">&quot;&#x27; has been injected into other beans [&quot;</span> +<br>							StringUtils.collectionToCommaDelimitedString(actualDependentBeans) +<br>							<span class="hljs-string">&quot;] in its raw version as part of a circular reference, but has eventually been &quot;</span> +<br>							<span class="hljs-string">&quot;wrapped. This means that said other beans do not use the final version of the &quot;</span> +<br>							<span class="hljs-string">&quot;bean. This is often the result of over-eager type matching - consider using &quot;</span> +<br>							<span class="hljs-string">&quot;&#x27;getBeanNamesOfType&#x27; with the &#x27;allowEagerInit&#x27; flag turned off, for example.&quot;</span>);<br>				&#125;<br>			&#125;<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// Register bean as disposable.</span><br>	<span class="hljs-keyword">try</span> &#123;<br>		registerDisposableBeanIfNecessary(beanName, bean, mbd);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (BeanDefinitionValidationException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>				mbd.getResourceDescription(), beanName, <span class="hljs-string">&quot;Invalid destruction signature&quot;</span>, ex);<br>	&#125;<br><br>	<span class="hljs-keyword">return</span> exposedObject;<br>&#125;<br><br><br><span class="hljs-comment">// 在AbstractAutowireCapableBeanFactory抽象类的doCreateBean方法中调用的 createBeanInstance(beanName, mbd, args)方法</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> BeanWrapper <span class="hljs-title">createBeanInstance</span><span class="hljs-params">(String beanName, RootBeanDefinition mbd, <span class="hljs-meta">@Nullable</span> Object[] args)</span> </span>&#123;<br>	<span class="hljs-comment">// Make sure bean class is actually resolved at this point.</span><br>	Class&lt;?&gt; beanClass = resolveBeanClass(mbd, beanName);<br><br>	<span class="hljs-keyword">if</span> (beanClass != <span class="hljs-keyword">null</span> &amp;&amp; !Modifier.isPublic(beanClass.getModifiers()) &amp;&amp; !mbd.isNonPublicAccessAllowed()) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,<br>				<span class="hljs-string">&quot;Bean class isn&#x27;t public, and non-public access not allowed: &quot;</span> + beanClass.getName());<br>	&#125;<br><br>	Supplier&lt;?&gt; instanceSupplier = mbd.getInstanceSupplier();<br>	<span class="hljs-keyword">if</span> (instanceSupplier != <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-keyword">return</span> obtainFromSupplier(instanceSupplier, beanName);<br>	&#125;<br><br>	<span class="hljs-keyword">if</span> (mbd.getFactoryMethodName() != <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-keyword">return</span> instantiateUsingFactoryMethod(beanName, mbd, args);<br>	&#125;<br><br>	<span class="hljs-comment">// Shortcut when re-creating the same bean...</span><br>	<span class="hljs-keyword">boolean</span> resolved = <span class="hljs-keyword">false</span>;<br>	<span class="hljs-keyword">boolean</span> autowireNecessary = <span class="hljs-keyword">false</span>;<br>	<span class="hljs-keyword">if</span> (args == <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-keyword">synchronized</span> (mbd.constructorArgumentLock) &#123;<br>			<span class="hljs-keyword">if</span> (mbd.resolvedConstructorOrFactoryMethod != <span class="hljs-keyword">null</span>) &#123;<br>				resolved = <span class="hljs-keyword">true</span>;<br>				autowireNecessary = mbd.constructorArgumentsResolved;<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">if</span> (resolved) &#123;<br>		<span class="hljs-keyword">if</span> (autowireNecessary) &#123;<br>			<span class="hljs-keyword">return</span> autowireConstructor(beanName, mbd, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-comment">// 调用instantiateBean方法</span><br>			<span class="hljs-keyword">return</span> instantiateBean(beanName, mbd);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// Candidate constructors for autowiring?</span><br>	Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);<br>	<span class="hljs-keyword">if</span> (ctors != <span class="hljs-keyword">null</span> || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||<br>			mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) &#123;<br>		<span class="hljs-keyword">return</span> autowireConstructor(beanName, mbd, ctors, args);<br>	&#125;<br><br>	<span class="hljs-comment">// Preferred constructors for default construction?</span><br>	ctors = mbd.getPreferredConstructors();<br>	<span class="hljs-keyword">if</span> (ctors != <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-keyword">return</span> autowireConstructor(beanName, mbd, ctors, <span class="hljs-keyword">null</span>);<br>	&#125;<br><br>	<span class="hljs-comment">// No special handling: simply use no-arg constructor.</span><br>	<span class="hljs-keyword">return</span> instantiateBean(beanName, mbd);<br>&#125;<br><br><span class="hljs-comment">// 在AbstractAutowireCapableBeanFactory抽象类的createBeanInstance方法中调用的instantiateBean(beanName, mbd)方法</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> BeanWrapper <span class="hljs-title">instantiateBean</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String beanName, <span class="hljs-keyword">final</span> RootBeanDefinition mbd)</span> </span>&#123;<br>	<span class="hljs-keyword">try</span> &#123;<br>		Object beanInstance;<br>		<span class="hljs-keyword">final</span> BeanFactory parent = <span class="hljs-keyword">this</span>;<br>		<span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-comment">// 核心逻辑</span><br>			beanInstance = AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt;<br>					getInstantiationStrategy().instantiate(mbd, beanName, parent),<br>					getAccessControlContext());<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-comment">// 核心逻辑</span><br>			beanInstance = getInstantiationStrategy().instantiate(mbd, beanName, parent);<br>		&#125;<br>		BeanWrapper bw = <span class="hljs-keyword">new</span> BeanWrapperImpl(beanInstance);<br>		initBeanWrapper(bw);<br>		<span class="hljs-keyword">return</span> bw;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>				mbd.getResourceDescription(), beanName, <span class="hljs-string">&quot;Instantiation of bean failed&quot;</span>, ex);<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// 上面的getInstantiationStrategy()方法代码</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> InstantiationStrategy <span class="hljs-title">getInstantiationStrategy</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.instantiationStrategy;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="getInstantiationStrategy-方法的返回接口对象的策略对象的一个实现SimpleInstantiationStrategy"><a href="#getInstantiationStrategy-方法的返回接口对象的策略对象的一个实现SimpleInstantiationStrategy" class="headerlink" title="getInstantiationStrategy()方法的返回接口对象的策略对象的一个实现SimpleInstantiationStrategy"></a>getInstantiationStrategy()方法的返回接口对象的策略对象的一个实现SimpleInstantiationStrategy</h3><ul>
<li>org.springframework.beans.factory.support.SimpleInstantiationStrategy</li>
<li>SimpleInstantiationStrategy.instantiate(RootBeanDefinition bd, @Nullable String beanName, BeanFactory owner)方法的具体实现：<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">instantiate</span><span class="hljs-params">(RootBeanDefinition bd, <span class="hljs-meta">@Nullable</span> String beanName, BeanFactory owner)</span> </span>&#123;<br>	<span class="hljs-comment">// Don&#x27;t override the class with CGLIB if no overrides.</span><br>	<span class="hljs-keyword">if</span> (!bd.hasMethodOverrides()) &#123;<br>		Constructor&lt;?&gt; constructorToUse;<br>		<span class="hljs-keyword">synchronized</span> (bd.constructorArgumentLock) &#123;<br>			constructorToUse = (Constructor&lt;?&gt;) bd.resolvedConstructorOrFactoryMethod;<br>			<span class="hljs-keyword">if</span> (constructorToUse == <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-keyword">final</span> Class&lt;?&gt; clazz = bd.getBeanClass();<br>				<span class="hljs-keyword">if</span> (clazz.isInterface()) &#123;<br>					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanInstantiationException(clazz, <span class="hljs-string">&quot;Specified class is an interface&quot;</span>);<br>				&#125;<br>				<span class="hljs-keyword">try</span> &#123;<br>					<span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-keyword">null</span>) &#123;<br>						constructorToUse = AccessController.doPrivileged(<br>								(PrivilegedExceptionAction&lt;Constructor&lt;?&gt;&gt;) clazz::getDeclaredConstructor);<br>					&#125;<br>					<span class="hljs-keyword">else</span> &#123;<br>						constructorToUse = clazz.getDeclaredConstructor();<br>					&#125;<br>					bd.resolvedConstructorOrFactoryMethod = constructorToUse;<br>				&#125;<br>				<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanInstantiationException(clazz, <span class="hljs-string">&quot;No default constructor found&quot;</span>, ex);<br>				&#125;<br>			&#125;<br>		&#125;<br>		<span class="hljs-comment">// 调用静态方法BeanUtils.instantiateClass(constructorToUse);</span><br>		<span class="hljs-keyword">return</span> BeanUtils.instantiateClass(constructorToUse);<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-comment">// Must generate CGLIB subclass.</span><br>		<span class="hljs-keyword">return</span> instantiateWithMethodInjection(bd, beanName, owner);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="静态方法BeanUtils-instantiateClass-constructorToUse-的实现细节"><a href="#静态方法BeanUtils-instantiateClass-constructorToUse-的实现细节" class="headerlink" title="静态方法BeanUtils.instantiateClass(constructorToUse)的实现细节"></a>静态方法BeanUtils.instantiateClass(constructorToUse)的实现细节</h4></li>
<li>代码位置：org.springframework.beans.BeanUtils<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">instantiateClass</span><span class="hljs-params">(Constructor&lt;T&gt; ctor, Object... args)</span> <span class="hljs-keyword">throws</span> BeanInstantiationException </span>&#123;<br>	Assert.notNull(ctor, <span class="hljs-string">&quot;Constructor must not be null&quot;</span>);<br>	<span class="hljs-keyword">try</span> &#123;<br>		ReflectionUtils.makeAccessible(ctor);<br>		<span class="hljs-comment">// 判断是否是Kotlin类型</span><br>		<span class="hljs-keyword">if</span> (KotlinDetector.isKotlinReflectPresent() &amp;&amp; KotlinDetector.isKotlinType(ctor.getDeclaringClass())) &#123;<br>			<span class="hljs-comment">// 是Kotlin类型</span><br>			<span class="hljs-keyword">return</span> KotlinDelegate.instantiateClass(ctor, args);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-comment">// 不是Kotlin类型</span><br>			Class&lt;?&gt;[] parameterTypes = ctor.getParameterTypes();<br>			Assert.isTrue(args.length &lt;= parameterTypes.length, <span class="hljs-string">&quot;Can&#x27;t specify more arguments than constructor parameters&quot;</span>);<br>			Object[] argsWithDefaultValues = <span class="hljs-keyword">new</span> Object[args.length];<br>			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ; i &lt; args.length; i++) &#123;<br>				<span class="hljs-keyword">if</span> (args[i] == <span class="hljs-keyword">null</span>) &#123;<br>					Class&lt;?&gt; parameterType = parameterTypes[i];<br>					argsWithDefaultValues[i] = (parameterType.isPrimitive() ? DEFAULT_TYPE_VALUES.get(parameterType) : <span class="hljs-keyword">null</span>);<br>				&#125;<br>				<span class="hljs-keyword">else</span> &#123;<br>					argsWithDefaultValues[i] = args[i];<br>				&#125;<br>			&#125;<br>			<span class="hljs-comment">// 调用Constructor的newInstance方法，使用反射创建实例</span><br>			<span class="hljs-comment">// 到此之后bean实例创建完成</span><br>			<span class="hljs-keyword">return</span> ctor.newInstance(argsWithDefaultValues);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (InstantiationException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanInstantiationException(ctor, <span class="hljs-string">&quot;Is it an abstract class?&quot;</span>, ex);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (IllegalAccessException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanInstantiationException(ctor, <span class="hljs-string">&quot;Is the constructor accessible?&quot;</span>, ex);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (IllegalArgumentException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanInstantiationException(ctor, <span class="hljs-string">&quot;Illegal arguments for constructor&quot;</span>, ex);<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (InvocationTargetException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanInstantiationException(ctor, <span class="hljs-string">&quot;Constructor threw exception&quot;</span>, ex.getTargetException());<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="AbstractAutowireCapableBeanFactory抽象类的中doCreateBean方法中调用的populateBean-beanName-mbd-instanceWrapper-方法"><a href="#AbstractAutowireCapableBeanFactory抽象类的中doCreateBean方法中调用的populateBean-beanName-mbd-instanceWrapper-方法" class="headerlink" title="AbstractAutowireCapableBeanFactory抽象类的中doCreateBean方法中调用的populateBean(beanName, mbd, instanceWrapper)方法"></a>AbstractAutowireCapableBeanFactory抽象类的中doCreateBean方法中调用的populateBean(beanName, mbd, instanceWrapper)方法</h4><ul>
<li>在AbstractAutowireCapableBeanFactory抽象类中的方法populateBean方法</li>
<li>该方法用于填充bean 具体发生依赖注入的地方<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SuppressWarnings(&quot;deprecation&quot;)</span>  <span class="hljs-comment">// for postProcessPropertyValues</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">populateBean</span><span class="hljs-params">(String beanName, RootBeanDefinition mbd, <span class="hljs-meta">@Nullable</span> BeanWrapper bw)</span> </span>&#123;<br>	<span class="hljs-keyword">if</span> (bw == <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-keyword">if</span> (mbd.hasPropertyValues()) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>					mbd.getResourceDescription(), beanName, <span class="hljs-string">&quot;Cannot apply property values to null instance&quot;</span>);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-comment">// Skip property population phase for null instance.</span><br>			<span class="hljs-keyword">return</span>;<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// Give any InstantiationAwareBeanPostProcessors the opportunity to modify the</span><br>	<span class="hljs-comment">// state of the bean before properties are set. This can be used, for example,</span><br>	<span class="hljs-comment">// to support styles of field injection.</span><br>	<span class="hljs-keyword">boolean</span> continueWithPropertyPopulation = <span class="hljs-keyword">true</span>;<br><br>	<span class="hljs-keyword">if</span> (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) &#123;<br>		<span class="hljs-keyword">for</span> (BeanPostProcessor bp : getBeanPostProcessors()) &#123;<br>			<span class="hljs-keyword">if</span> (bp <span class="hljs-keyword">instanceof</span> InstantiationAwareBeanPostProcessor) &#123;<br>				InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;<br>				<span class="hljs-keyword">if</span> (!ibp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) &#123;<br>					continueWithPropertyPopulation = <span class="hljs-keyword">false</span>;<br>					<span class="hljs-keyword">break</span>;<br>				&#125;<br>			&#125;<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-keyword">if</span> (!continueWithPropertyPopulation) &#123;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br>    <span class="hljs-comment">// 获取bean的所有属性 用于后面配置Property元素 即依赖关系</span><br>	PropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : <span class="hljs-keyword">null</span>);<br><br>	<span class="hljs-keyword">int</span> resolvedAutowireMode = mbd.getResolvedAutowireMode();<br>	<span class="hljs-keyword">if</span> (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) &#123;<br>		MutablePropertyValues newPvs = <span class="hljs-keyword">new</span> MutablePropertyValues(pvs);<br>		<span class="hljs-comment">// Add property values based on autowire by name if applicable.</span><br>		<span class="hljs-keyword">if</span> (resolvedAutowireMode == AUTOWIRE_BY_NAME) &#123;<br>			autowireByName(beanName, mbd, bw, newPvs);<br>		&#125;<br>		<span class="hljs-comment">// Add property values based on autowire by type if applicable.</span><br>		<span class="hljs-keyword">if</span> (resolvedAutowireMode == AUTOWIRE_BY_TYPE) &#123;<br>			autowireByType(beanName, mbd, bw, newPvs);<br>		&#125;<br>		pvs = newPvs;<br>	&#125;<br><br>	<span class="hljs-keyword">boolean</span> hasInstAwareBpps = hasInstantiationAwareBeanPostProcessors();<br>	<span class="hljs-keyword">boolean</span> needsDepCheck = (mbd.getDependencyCheck() != AbstractBeanDefinition.DEPENDENCY_CHECK_NONE);<br><br>	PropertyDescriptor[] filteredPds = <span class="hljs-keyword">null</span>;<br>	<span class="hljs-keyword">if</span> (hasInstAwareBpps) &#123;<br>		<span class="hljs-keyword">if</span> (pvs == <span class="hljs-keyword">null</span>) &#123;<br>			pvs = mbd.getPropertyValues();<br>		&#125;<br>		<span class="hljs-keyword">for</span> (BeanPostProcessor bp : getBeanPostProcessors()) &#123;<br>			<span class="hljs-keyword">if</span> (bp <span class="hljs-keyword">instanceof</span> InstantiationAwareBeanPostProcessor) &#123;<br>				InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;<br>				PropertyValues pvsToUse = ibp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName);<br>				<span class="hljs-keyword">if</span> (pvsToUse == <span class="hljs-keyword">null</span>) &#123;<br>					<span class="hljs-keyword">if</span> (filteredPds == <span class="hljs-keyword">null</span>) &#123;<br>						filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);<br>					&#125;<br>					pvsToUse = ibp.postProcessPropertyValues(pvs, filteredPds, bw.getWrappedInstance(), beanName);<br>					<span class="hljs-keyword">if</span> (pvsToUse == <span class="hljs-keyword">null</span>) &#123;<br>						<span class="hljs-keyword">return</span>;<br>					&#125;<br>				&#125;<br>				pvs = pvsToUse;<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">if</span> (needsDepCheck) &#123;<br>		<span class="hljs-keyword">if</span> (filteredPds == <span class="hljs-keyword">null</span>) &#123;<br>			filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);<br>		&#125;<br>		checkDependencies(beanName, mbd, filteredPds, pvs);<br>	&#125;<br><br>	<span class="hljs-keyword">if</span> (pvs != <span class="hljs-keyword">null</span>) &#123;<br>		<span class="hljs-comment">// 核心逻辑 applyPropertyValues方法的具体代码在下面</span><br>		applyPropertyValues(beanName, mbd, bw, pvs);<br>	&#125;<br>&#125;<br><br><span class="hljs-comment">// 上面方法中调用的applyPropertyValues方法具体代码</span><br><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">applyPropertyValues</span><span class="hljs-params">(String beanName, BeanDefinition mbd, BeanWrapper bw, PropertyValues pvs)</span> </span>&#123;<br>	<span class="hljs-keyword">if</span> (pvs.isEmpty()) &#123;<br>		<span class="hljs-keyword">return</span>;<br>	&#125;<br><br>	<span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-keyword">null</span> &amp;&amp; bw <span class="hljs-keyword">instanceof</span> BeanWrapperImpl) &#123;<br>		((BeanWrapperImpl) bw).setSecurityContext(getAccessControlContext());<br>	&#125;<br><br>	MutablePropertyValues mpvs = <span class="hljs-keyword">null</span>;<br>	List&lt;PropertyValue&gt; original;<br><br>	<span class="hljs-keyword">if</span> (pvs <span class="hljs-keyword">instanceof</span> MutablePropertyValues) &#123;<br>		mpvs = (MutablePropertyValues) pvs;<br>		<span class="hljs-keyword">if</span> (mpvs.isConverted()) &#123;<br>			<span class="hljs-comment">// Shortcut: use the pre-converted values as-is.</span><br>			<span class="hljs-keyword">try</span> &#123;<br>				bw.setPropertyValues(mpvs);<br>				<span class="hljs-keyword">return</span>;<br>			&#125;<br>			<span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>						mbd.getResourceDescription(), beanName, <span class="hljs-string">&quot;Error setting property values&quot;</span>, ex);<br>			&#125;<br>		&#125;<br>		original = mpvs.getPropertyValueList();<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		original = Arrays.asList(pvs.getPropertyValues());<br>	&#125;<br><br>	TypeConverter converter = getCustomTypeConverter();<br>	<span class="hljs-keyword">if</span> (converter == <span class="hljs-keyword">null</span>) &#123;<br>		converter = bw;<br>	&#125;<br>	BeanDefinitionValueResolver valueResolver = <span class="hljs-keyword">new</span> BeanDefinitionValueResolver(<span class="hljs-keyword">this</span>, beanName, mbd, converter);<br><br>	<span class="hljs-comment">// Create a deep copy, resolving any references for values.</span><br>	List&lt;PropertyValue&gt; deepCopy = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(original.size());<br>	<span class="hljs-keyword">boolean</span> resolveNecessary = <span class="hljs-keyword">false</span>;<br>	<span class="hljs-keyword">for</span> (PropertyValue pv : original) &#123;<br>		<span class="hljs-keyword">if</span> (pv.isConverted()) &#123;<br>			deepCopy.add(pv);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			String propertyName = pv.getName();<br>			Object originalValue = pv.getValue();<br>			<span class="hljs-keyword">if</span> (originalValue == AutowiredPropertyMarker.INSTANCE) &#123;<br>				Method writeMethod = bw.getPropertyDescriptor(propertyName).getWriteMethod();<br>				<span class="hljs-keyword">if</span> (writeMethod == <span class="hljs-keyword">null</span>) &#123;<br>					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Autowire marker for property without write method: &quot;</span> + pv);<br>				&#125;<br>				originalValue = <span class="hljs-keyword">new</span> DependencyDescriptor(<span class="hljs-keyword">new</span> MethodParameter(writeMethod, <span class="hljs-number">0</span>), <span class="hljs-keyword">true</span>);<br>			&#125;<br>			<span class="hljs-comment">// 获取property对应的值   resolveValueIfNecessary方法的代码在下面给出</span><br>			Object resolvedValue = valueResolver.resolveValueIfNecessary(pv, originalValue);<br>			Object convertedValue = resolvedValue;<br>			<span class="hljs-keyword">boolean</span> convertible = bw.isWritableProperty(propertyName) &amp;&amp;<br>					!PropertyAccessorUtils.isNestedOrIndexedProperty(propertyName);<br>			<span class="hljs-keyword">if</span> (convertible) &#123;<br>				convertedValue = convertForProperty(resolvedValue, propertyName, bw, converter);<br>			&#125;<br>			<span class="hljs-comment">// Possibly store converted value in merged bean definition,</span><br>			<span class="hljs-comment">// in order to avoid re-conversion for every created bean instance.</span><br>			<span class="hljs-keyword">if</span> (resolvedValue == originalValue) &#123;<br>				<span class="hljs-keyword">if</span> (convertible) &#123;<br>					pv.setConvertedValue(convertedValue);<br>				&#125;<br>				deepCopy.add(pv);<br>			&#125;<br>			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (convertible &amp;&amp; originalValue <span class="hljs-keyword">instanceof</span> TypedStringValue &amp;&amp;<br>					!((TypedStringValue) originalValue).isDynamic() &amp;&amp;<br>					!(convertedValue <span class="hljs-keyword">instanceof</span> Collection || ObjectUtils.isArray(convertedValue))) &#123;<br>				pv.setConvertedValue(convertedValue);<br>				deepCopy.add(pv);<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				resolveNecessary = <span class="hljs-keyword">true</span>;<br>				deepCopy.add(<span class="hljs-keyword">new</span> PropertyValue(pv, convertedValue));<br>			&#125;<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">if</span> (mpvs != <span class="hljs-keyword">null</span> &amp;&amp; !resolveNecessary) &#123;<br>		mpvs.setConverted();<br>	&#125;<br><br>	<span class="hljs-comment">// Set our (possibly massaged) deep copy.</span><br>	<span class="hljs-keyword">try</span> &#123;<br>		<span class="hljs-comment">// 获取到依赖的对象值后 将依赖值注入</span><br>		bw.setPropertyValues(<span class="hljs-keyword">new</span> MutablePropertyValues(deepCopy));<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>				mbd.getResourceDescription(), beanName, <span class="hljs-string">&quot;Error setting property values&quot;</span>, ex);<br>	&#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>
####################################################################################################################################################33</li>
</ul>
<h4 id="valueResolver-resolveValueIfNecessary-pv-originalValue-对应的方法"><a href="#valueResolver-resolveValueIfNecessary-pv-originalValue-对应的方法" class="headerlink" title="valueResolver.resolveValueIfNecessary(pv, originalValue);对应的方法"></a>valueResolver.resolveValueIfNecessary(pv, originalValue);对应的方法</h4><ul>
<li>代码位置：org.springframework.beans.factory.support.BeanDefinitionValueResolver<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nullable</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">resolveValueIfNecessary</span><span class="hljs-params">(Object argName, <span class="hljs-meta">@Nullable</span> Object value)</span> </span>&#123;<br>	<span class="hljs-comment">// We must check each value to see whether it requires a runtime reference</span><br>	<span class="hljs-comment">// to another bean to be resolved.</span><br>	<span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> RuntimeBeanReference) &#123;<br>		RuntimeBeanReference ref = (RuntimeBeanReference) value;<br>		<span class="hljs-comment">// 核心逻辑 解决Bean依赖关系 具体代码在下方贴出</span><br>		<span class="hljs-keyword">return</span> resolveReference(argName, ref);<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> RuntimeBeanNameReference) &#123;<br>		String refName = ((RuntimeBeanNameReference) value).getBeanName();<br>		refName = String.valueOf(doEvaluate(refName));<br>		<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.beanFactory.containsBean(refName)) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanDefinitionStoreException(<br>					<span class="hljs-string">&quot;Invalid bean name &#x27;&quot;</span> + refName + <span class="hljs-string">&quot;&#x27; in bean reference for &quot;</span> + argName);<br>		&#125;<br>		<span class="hljs-keyword">return</span> refName;<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> BeanDefinitionHolder) &#123;<br>		<span class="hljs-comment">// Resolve BeanDefinitionHolder: contains BeanDefinition with name and aliases.</span><br>		BeanDefinitionHolder bdHolder = (BeanDefinitionHolder) value;<br>		<span class="hljs-keyword">return</span> resolveInnerBean(argName, bdHolder.getBeanName(), bdHolder.getBeanDefinition());<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> BeanDefinition) &#123;<br>		<span class="hljs-comment">// Resolve plain BeanDefinition, without contained name: use dummy name.</span><br>		BeanDefinition bd = (BeanDefinition) value;<br>		String innerBeanName = <span class="hljs-string">&quot;(inner bean)&quot;</span> + BeanFactoryUtils.GENERATED_BEAN_NAME_SEPARATOR +<br>				ObjectUtils.getIdentityHexString(bd);<br>		<span class="hljs-keyword">return</span> resolveInnerBean(argName, innerBeanName, bd);<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> DependencyDescriptor) &#123;<br>		Set&lt;String&gt; autowiredBeanNames = <span class="hljs-keyword">new</span> LinkedHashSet&lt;&gt;(<span class="hljs-number">4</span>);<br>		Object result = <span class="hljs-keyword">this</span>.beanFactory.resolveDependency(<br>				(DependencyDescriptor) value, <span class="hljs-keyword">this</span>.beanName, autowiredBeanNames, <span class="hljs-keyword">this</span>.typeConverter);<br>		<span class="hljs-keyword">for</span> (String autowiredBeanName : autowiredBeanNames) &#123;<br>			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.beanFactory.containsBean(autowiredBeanName)) &#123;<br>				<span class="hljs-keyword">this</span>.beanFactory.registerDependentBean(autowiredBeanName, <span class="hljs-keyword">this</span>.beanName);<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">return</span> result;<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> ManagedArray) &#123;<br>		<span class="hljs-comment">// May need to resolve contained runtime references.</span><br>		ManagedArray array = (ManagedArray) value;<br>		Class&lt;?&gt; elementType = array.resolvedElementType;<br>		<span class="hljs-keyword">if</span> (elementType == <span class="hljs-keyword">null</span>) &#123;<br>			String elementTypeName = array.getElementTypeName();<br>			<span class="hljs-keyword">if</span> (StringUtils.hasText(elementTypeName)) &#123;<br>				<span class="hljs-keyword">try</span> &#123;<br>					elementType = ClassUtils.forName(elementTypeName, <span class="hljs-keyword">this</span>.beanFactory.getBeanClassLoader());<br>					array.resolvedElementType = elementType;<br>				&#125;<br>				<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>					<span class="hljs-comment">// Improve the message by showing the context.</span><br>					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>							<span class="hljs-keyword">this</span>.beanDefinition.getResourceDescription(), <span class="hljs-keyword">this</span>.beanName,<br>							<span class="hljs-string">&quot;Error resolving array type for &quot;</span> + argName, ex);<br>				&#125;<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				elementType = Object.class;<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">return</span> resolveManagedArray(argName, (List&lt;?&gt;) value, elementType);<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> ManagedList) &#123;<br>		<span class="hljs-comment">// May need to resolve contained runtime references.</span><br>		<span class="hljs-keyword">return</span> resolveManagedList(argName, (List&lt;?&gt;) value);<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> ManagedSet) &#123;<br>		<span class="hljs-comment">// May need to resolve contained runtime references.</span><br>		<span class="hljs-keyword">return</span> resolveManagedSet(argName, (Set&lt;?&gt;) value);<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> ManagedMap) &#123;<br>		<span class="hljs-comment">// May need to resolve contained runtime references.</span><br>		<span class="hljs-keyword">return</span> resolveManagedMap(argName, (Map&lt;?, ?&gt;) value);<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> ManagedProperties) &#123;<br>		Properties original = (Properties) value;<br>		Properties copy = <span class="hljs-keyword">new</span> Properties();<br>		original.forEach((propKey, propValue) -&gt; &#123;<br>			<span class="hljs-keyword">if</span> (propKey <span class="hljs-keyword">instanceof</span> TypedStringValue) &#123;<br>				propKey = evaluate((TypedStringValue) propKey);<br>			&#125;<br>			<span class="hljs-keyword">if</span> (propValue <span class="hljs-keyword">instanceof</span> TypedStringValue) &#123;<br>				propValue = evaluate((TypedStringValue) propValue);<br>			&#125;<br>			<span class="hljs-keyword">if</span> (propKey == <span class="hljs-keyword">null</span> || propValue == <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>						<span class="hljs-keyword">this</span>.beanDefinition.getResourceDescription(), <span class="hljs-keyword">this</span>.beanName,<br>						<span class="hljs-string">&quot;Error converting Properties key/value pair for &quot;</span> + argName + <span class="hljs-string">&quot;: resolved to null&quot;</span>);<br>			&#125;<br>			copy.put(propKey, propValue);<br>		&#125;);<br>		<span class="hljs-keyword">return</span> copy;<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> TypedStringValue) &#123;<br>		<span class="hljs-comment">// Convert value to target type here.</span><br>		TypedStringValue typedStringValue = (TypedStringValue) value;<br>		Object valueObject = evaluate(typedStringValue);<br>		<span class="hljs-keyword">try</span> &#123;<br>			Class&lt;?&gt; resolvedTargetType = resolveTargetType(typedStringValue);<br>			<span class="hljs-keyword">if</span> (resolvedTargetType != <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.typeConverter.convertIfNecessary(valueObject, resolvedTargetType);<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				<span class="hljs-keyword">return</span> valueObject;<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (Throwable ex) &#123;<br>			<span class="hljs-comment">// Improve the message by showing the context.</span><br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>					<span class="hljs-keyword">this</span>.beanDefinition.getResourceDescription(), <span class="hljs-keyword">this</span>.beanName,<br>					<span class="hljs-string">&quot;Error converting typed String value for &quot;</span> + argName, ex);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> NullBean) &#123;<br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		<span class="hljs-keyword">return</span> evaluate(value);<br>	&#125;<br>&#125;<br><br><br><span class="hljs-comment">// 上面resolveValueIfNecessary方法中调用的resolveReference方法</span><br><span class="hljs-comment">// 最后获取到依赖的bean</span><br><span class="hljs-meta">@Nullable</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> Object <span class="hljs-title">resolveReference</span><span class="hljs-params">(Object argName, RuntimeBeanReference ref)</span> </span>&#123;<br>	<span class="hljs-keyword">try</span> &#123;<br>		Object bean;<br>		Class&lt;?&gt; beanType = ref.getBeanType();<br>		<span class="hljs-keyword">if</span> (ref.isToParent()) &#123;<br>			BeanFactory parent = <span class="hljs-keyword">this</span>.beanFactory.getParentBeanFactory();<br>			<span class="hljs-keyword">if</span> (parent == <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>						<span class="hljs-keyword">this</span>.beanDefinition.getResourceDescription(), <span class="hljs-keyword">this</span>.beanName,<br>						<span class="hljs-string">&quot;Cannot resolve reference to bean &quot;</span> + ref +<br>								<span class="hljs-string">&quot; in parent factory: no parent factory available&quot;</span>);<br>			&#125;<br>			<span class="hljs-keyword">if</span> (beanType != <span class="hljs-keyword">null</span>) &#123;<br>				<span class="hljs-comment">// 发生递归调用</span><br>				bean = parent.getBean(beanType);<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				<span class="hljs-comment">// 发生递归调用 根据依赖的名称从BeanFactory中递归得到依赖 最后获取到依赖的bean</span><br>				bean = parent.getBean(String.valueOf(doEvaluate(ref.getBeanName())));<br>			&#125;<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			String resolvedName;<br>			<span class="hljs-keyword">if</span> (beanType != <span class="hljs-keyword">null</span>) &#123;<br>				NamedBeanHolder&lt;?&gt; namedBean = <span class="hljs-keyword">this</span>.beanFactory.resolveNamedBean(beanType);<br>				bean = namedBean.getBeanInstance();<br>				resolvedName = namedBean.getBeanName();<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				resolvedName = String.valueOf(doEvaluate(ref.getBeanName()));<br>				bean = <span class="hljs-keyword">this</span>.beanFactory.getBean(resolvedName);<br>			&#125;<br>			<span class="hljs-keyword">this</span>.beanFactory.registerDependentBean(resolvedName, <span class="hljs-keyword">this</span>.beanName);<br>		&#125;<br>		<span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> NullBean) &#123;<br>			bean = <span class="hljs-keyword">null</span>;<br>		&#125;<br>		<span class="hljs-keyword">return</span> bean;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (BeansException ex) &#123;<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BeanCreationException(<br>				<span class="hljs-keyword">this</span>.beanDefinition.getResourceDescription(), <span class="hljs-keyword">this</span>.beanName,<br>				<span class="hljs-string">&quot;Cannot resolve reference to bean &#x27;&quot;</span> + ref.getBeanName() + <span class="hljs-string">&quot;&#x27; while setting &quot;</span> + argName, ex);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="AbstractPropertyAccessor的setPropertyValues-PropertyValues-pvs-方法"><a href="#AbstractPropertyAccessor的setPropertyValues-PropertyValues-pvs-方法" class="headerlink" title="AbstractPropertyAccessor的setPropertyValues(PropertyValues pvs)方法"></a>AbstractPropertyAccessor的setPropertyValues(PropertyValues pvs)方法</h4><ul>
<li>代码位置：org.springframework.beans.AbstractPropertyAccessor</li>
<li>循环属性列表 <figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPropertyValues</span><span class="hljs-params">(PropertyValues pvs)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>	setPropertyValues(pvs, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>);<br>&#125;<br><br><span class="hljs-comment">//  循环属性列表 </span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPropertyValues</span><span class="hljs-params">(PropertyValues pvs, <span class="hljs-keyword">boolean</span> ignoreUnknown, <span class="hljs-keyword">boolean</span> ignoreInvalid)</span></span><br><span class="hljs-function">		<span class="hljs-keyword">throws</span> BeansException </span>&#123;<br><br>	List&lt;PropertyAccessException&gt; propertyAccessExceptions = <span class="hljs-keyword">null</span>;<br>	List&lt;PropertyValue&gt; propertyValues = (pvs <span class="hljs-keyword">instanceof</span> MutablePropertyValues ?<br>			((MutablePropertyValues) pvs).getPropertyValueList() : Arrays.asList(pvs.getPropertyValues()));<br>    <span class="hljs-comment">// 循环属性列表 </span><br>	<span class="hljs-keyword">for</span> (PropertyValue pv : propertyValues) &#123;<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-comment">// This method may throw any BeansException, which won&#x27;t be caught</span><br>			<span class="hljs-comment">// here, if there is a critical failure such as no matching field.</span><br>			<span class="hljs-comment">// We can attempt to deal only with less serious exceptions.</span><br>			<span class="hljs-comment">// 该方法通过AbstractNestablePropertyAccessor的setPropertyValue(PropertyValue pv)方法实现</span><br>			setPropertyValue(pv);<br>		&#125;<br>		<span class="hljs-keyword">catch</span> (NotWritablePropertyException ex) &#123;<br>			<span class="hljs-keyword">if</span> (!ignoreUnknown) &#123;<br>				<span class="hljs-keyword">throw</span> ex;<br>			&#125;<br>			<span class="hljs-comment">// Otherwise, just ignore it and continue...</span><br>		&#125;<br>		<span class="hljs-keyword">catch</span> (NullValueInNestedPathException ex) &#123;<br>			<span class="hljs-keyword">if</span> (!ignoreInvalid) &#123;<br>				<span class="hljs-keyword">throw</span> ex;<br>			&#125;<br>			<span class="hljs-comment">// Otherwise, just ignore it and continue...</span><br>		&#125;<br>		<span class="hljs-keyword">catch</span> (PropertyAccessException ex) &#123;<br>			<span class="hljs-keyword">if</span> (propertyAccessExceptions == <span class="hljs-keyword">null</span>) &#123;<br>				propertyAccessExceptions = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>			&#125;<br>			propertyAccessExceptions.add(ex);<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-comment">// If we encountered individual exceptions, throw the composite exception.</span><br>	<span class="hljs-keyword">if</span> (propertyAccessExceptions != <span class="hljs-keyword">null</span>) &#123;<br>		PropertyAccessException[] paeArray = propertyAccessExceptions.toArray(<span class="hljs-keyword">new</span> PropertyAccessException[<span class="hljs-number">0</span>]);<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> PropertyBatchUpdateException(paeArray);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="AbstractNestablePropertyAccessor的-setPropertyValue-PropertyValue-pv-方法"><a href="#AbstractNestablePropertyAccessor的-setPropertyValue-PropertyValue-pv-方法" class="headerlink" title="AbstractNestablePropertyAccessor的 setPropertyValue(PropertyValue pv)方法"></a>AbstractNestablePropertyAccessor的 setPropertyValue(PropertyValue pv)方法</h4><ul>
<li>代码位置：org.springframework.beans.AbstractNestablePropertyAccessor<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPropertyValue</span><span class="hljs-params">(PropertyValue pv)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>		PropertyTokenHolder tokens = (PropertyTokenHolder) pv.resolvedTokens;<br>		<span class="hljs-keyword">if</span> (tokens == <span class="hljs-keyword">null</span>) &#123;<br>			String propertyName = pv.getName();<br>			AbstractNestablePropertyAccessor nestedPa;<br>			<span class="hljs-keyword">try</span> &#123;<br>				nestedPa = getPropertyAccessorForPropertyPath(propertyName);<br>			&#125;<br>			<span class="hljs-keyword">catch</span> (NotReadablePropertyException ex) &#123;<br>				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotWritablePropertyException(getRootClass(), <span class="hljs-keyword">this</span>.nestedPath + propertyName,<br>						<span class="hljs-string">&quot;Nested property in path &#x27;&quot;</span> + propertyName + <span class="hljs-string">&quot;&#x27; does not exist&quot;</span>, ex);<br>			&#125;<br>			tokens = getPropertyNameTokens(getFinalPath(nestedPa, propertyName));<br>			<span class="hljs-keyword">if</span> (nestedPa == <span class="hljs-keyword">this</span>) &#123;<br>				pv.getOriginalPropertyValue().resolvedTokens = tokens;<br>			&#125;<br>			nestedPa.setPropertyValue(tokens, pv);<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			setPropertyValue(tokens, pv);<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>
########################################################################################################################################</li>
<li>上面setPropertyValue(PropertyValue pv)方法的重载方法setPropertyValue(PropertyTokenHolder tokens, PropertyValue pv)<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPropertyValue</span><span class="hljs-params">(PropertyTokenHolder tokens, PropertyValue pv)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>	<span class="hljs-keyword">if</span> (tokens.keys != <span class="hljs-keyword">null</span>) &#123;<br>		processKeyedProperty(tokens, pv);<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		processLocalProperty(tokens, pv);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>processLocalProperty(PropertyTokenHolder tokens, PropertyValue pv)方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">processLocalProperty</span><span class="hljs-params">(PropertyTokenHolder tokens, PropertyValue pv)</span> </span>&#123;<br>	PropertyHandler ph = getLocalPropertyHandler(tokens.actualName);<br>	<span class="hljs-keyword">if</span> (ph == <span class="hljs-keyword">null</span> || !ph.isWritable()) &#123;<br>		<span class="hljs-keyword">if</span> (pv.isOptional()) &#123;<br>			<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>				logger.debug(<span class="hljs-string">&quot;Ignoring optional value for property &#x27;&quot;</span> + tokens.actualName +<br>						<span class="hljs-string">&quot;&#x27; - property not found on bean class [&quot;</span> + getRootClass().getName() + <span class="hljs-string">&quot;]&quot;</span>);<br>			&#125;<br>			<span class="hljs-keyword">return</span>;<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			<span class="hljs-keyword">throw</span> createNotWritablePropertyException(tokens.canonicalName);<br>		&#125;<br>	&#125;<br><br>	Object oldValue = <span class="hljs-keyword">null</span>;<br>	<span class="hljs-keyword">try</span> &#123;<br>		Object originalValue = pv.getValue();<span class="hljs-comment">//</span><br>		Object valueToApply = originalValue;<span class="hljs-comment">//</span><br>		<span class="hljs-keyword">if</span> (!Boolean.FALSE.equals(pv.conversionNecessary)) &#123;<br>			<span class="hljs-keyword">if</span> (pv.isConverted()) &#123;<br>				valueToApply = pv.getConvertedValue();<br>			&#125;<br>			<span class="hljs-keyword">else</span> &#123;<br>				<span class="hljs-keyword">if</span> (isExtractOldValueForEditor() &amp;&amp; ph.isReadable()) &#123;<br>					<span class="hljs-keyword">try</span> &#123;<br>						oldValue = ph.getValue();<br>					&#125;<br>					<span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>						<span class="hljs-keyword">if</span> (ex <span class="hljs-keyword">instanceof</span> PrivilegedActionException) &#123;<br>							ex = ((PrivilegedActionException) ex).getException();<br>						&#125;<br>						<span class="hljs-keyword">if</span> (logger.isDebugEnabled()) &#123;<br>							logger.debug(<span class="hljs-string">&quot;Could not read previous value of property &#x27;&quot;</span> +<br>									<span class="hljs-keyword">this</span>.nestedPath + tokens.canonicalName + <span class="hljs-string">&quot;&#x27;&quot;</span>, ex);<br>						&#125;<br>					&#125;<br>				&#125;<br>				valueToApply = convertForProperty(<br>						tokens.canonicalName, oldValue, originalValue, ph.toTypeDescriptor());<br>			&#125;<br>			pv.getOriginalPropertyValue().conversionNecessary = (valueToApply != originalValue);<br>		&#125;<br>		ph.setValue(valueToApply);<span class="hljs-comment">// 具体代码在下方列出</span><br>	&#125;<br>	<span class="hljs-keyword">catch</span> (TypeMismatchException ex) &#123;<br>		<span class="hljs-keyword">throw</span> ex;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (InvocationTargetException ex) &#123;<br>		PropertyChangeEvent propertyChangeEvent = <span class="hljs-keyword">new</span> PropertyChangeEvent(<br>				getRootInstance(), <span class="hljs-keyword">this</span>.nestedPath + tokens.canonicalName, oldValue, pv.getValue());<br>		<span class="hljs-keyword">if</span> (ex.getTargetException() <span class="hljs-keyword">instanceof</span> ClassCastException) &#123;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> TypeMismatchException(propertyChangeEvent, ph.getPropertyType(), ex.getTargetException());<br>		&#125;<br>		<span class="hljs-keyword">else</span> &#123;<br>			Throwable cause = ex.getTargetException();<br>			<span class="hljs-keyword">if</span> (cause <span class="hljs-keyword">instanceof</span> UndeclaredThrowableException) &#123;<br>				<span class="hljs-comment">// May happen e.g. with Groovy-generated methods</span><br>				cause = cause.getCause();<br>			&#125;<br>			<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> MethodInvocationException(propertyChangeEvent, cause);<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>		PropertyChangeEvent pce = <span class="hljs-keyword">new</span> PropertyChangeEvent(<br>				getRootInstance(), <span class="hljs-keyword">this</span>.nestedPath + tokens.canonicalName, oldValue, pv.getValue());<br>		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> MethodInvocationException(pce, ex);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><ul>
<li>上述ph.setValue方法在org.springframework.beans.AbstractNestablePropertyAccessor抽象类中定义</li>
<li>public abstract void setValue(@Nullable Object value) throws Exception; </li>
<li>一个具体实现在org.springframework.beans.BeanWrapperImp的内部类BeanPropertyHandler中，完整代码如下：<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PropertyDescriptor pd;  <span class="hljs-comment">//BeanPropertyHandler中的字段</span><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setValue</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-meta">@Nullable</span> Object value)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>	<span class="hljs-keyword">final</span> Method writeMethod = (<span class="hljs-keyword">this</span>.pd <span class="hljs-keyword">instanceof</span> GenericTypeAwarePropertyDescriptor ?<br>			((GenericTypeAwarePropertyDescriptor) <span class="hljs-keyword">this</span>.pd).getWriteMethodForActualAccess() :<br>			<span class="hljs-keyword">this</span>.pd.getWriteMethod());<span class="hljs-comment">// 找到属性的set方法</span><br>	<span class="hljs-keyword">if</span> (System.getSecurityManager() != <span class="hljs-keyword">null</span>) &#123;<br>		AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123;<br>			ReflectionUtils.makeAccessible(writeMethod);<br>			<span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>		&#125;);<br>		<span class="hljs-keyword">try</span> &#123;<br>			AccessController.doPrivileged((PrivilegedExceptionAction&lt;Object&gt;) () -&gt;<br>					writeMethod.invoke(getWrappedInstance(), value), acc);<br>					<span class="hljs-comment">// 调用Method的invoke方法，完成属性注入</span><br>		&#125;<br>		<span class="hljs-keyword">catch</span> (PrivilegedActionException ex) &#123;<br>			<span class="hljs-keyword">throw</span> ex.getException();<br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">else</span> &#123;<br>		ReflectionUtils.makeAccessible(writeMethod);<br>		writeMethod.invoke(getWrappedInstance(), value);<span class="hljs-comment">//调用Method的invoke方法，完成属性注入</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>至此Ioc容器的启动过程基本结束</li>
</ul>
<h1 id="15-finishRefresh-方法"><a href="#15-finishRefresh-方法" class="headerlink" title="15. finishRefresh();方法"></a>15. finishRefresh();方法</h1><ul>
<li>org.springframework.context.support.AbstractApplicationContext中的finishRefresh()方法</li>
</ul>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">finishRefresh</span><span class="hljs-params">()</span> </span>&#123;<br>	<span class="hljs-comment">// Clear context-level resource caches (such as ASM metadata from scanning).</span><br>	clearResourceCaches();<br><br>	<span class="hljs-comment">// Initialize lifecycle processor for this context.</span><br>	initLifecycleProcessor();<br><br>	<span class="hljs-comment">// Propagate refresh to lifecycle processor first.</span><br>	getLifecycleProcessor().onRefresh();<br><br>	<span class="hljs-comment">// Publish the final event.</span><br>	publishEvent(<span class="hljs-keyword">new</span> ContextRefreshedEvent(<span class="hljs-keyword">this</span>));<br><br>	<span class="hljs-comment">// Participate in LiveBeansView MBean, if active.</span><br>	LiveBeansView.registerApplicationContext(<span class="hljs-keyword">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure>


<h1 id="16refresh-过程抛出异常时"><a href="#16refresh-过程抛出异常时" class="headerlink" title="16refresh()过程抛出异常时"></a>16refresh()过程抛出异常时</h1><ul>
<li>之中有两个处理方法destroyBeans()和cancelRefresh(ex)</li>
</ul>
<h2 id="16-1-destroyBeans-方法"><a href="#16-1-destroyBeans-方法" class="headerlink" title="16.1 destroyBeans();方法"></a>16.1 destroyBeans();方法</h2><ul>
<li>org.springframework.context.support.AbstractApplicationContext中的destroyBeans()方法</li>
</ul>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroyBeans</span><span class="hljs-params">()</span> </span>&#123;<br>	getBeanFactory().destroySingletons();<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="16-2-cancelRefresh-ex-方法"><a href="#16-2-cancelRefresh-ex-方法" class="headerlink" title="16.2 cancelRefresh(ex);方法"></a>16.2 cancelRefresh(ex);方法</h2><ul>
<li>org.springframework.context.support.AbstractApplicationContext中的cancelRefresh(ex)方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cancelRefresh</span><span class="hljs-params">(BeansException ex)</span> </span>&#123;<br>	<span class="hljs-keyword">this</span>.active.set(<span class="hljs-keyword">false</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="16-3抛出异常BeansException"><a href="#16-3抛出异常BeansException" class="headerlink" title="16.3抛出异常BeansException"></a>16.3抛出异常BeansException</h2></li>
</ul>
<h1 id="17-resetCommonCaches-方法"><a href="#17-resetCommonCaches-方法" class="headerlink" title="17 resetCommonCaches();方法"></a>17 resetCommonCaches();方法</h1><ul>
<li>org.springframework.context.support.AbstractApplicationContext中的resetCommonCaches()方法</li>
<li>try-catch-finally代码块中finally包裹的方法<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">resetCommonCaches</span><span class="hljs-params">()</span> </span>&#123;<br>	ReflectionUtils.clearCache();<br>	AnnotationUtils.clearCache();<br>	ResolvableType.clearCache();<br>	CachedIntrospectionResults.clearClassLoader(getClassLoader());<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li>执行到此Ioc容器启动完成，可以正式投入使用</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li>Ioc的底层原理实现：Spring Ioc启动分为两步：<ul>
<li>1.创建BeanFactory</li>
<li>2.实例化Bean</li>
</ul>
</li>
<li>Spring的Bean在内存中的状态就是BeanDefination</li>
<li>在Bean的创建和依赖注入的过程中，需要根据BeanDefination的信息来递归的完成依赖注入，从代码可以看到，这些递归都是以getBean()为入口的，一个递归是在上下文体系中查找需要的bean和bean的依赖关系；另一个递归是在依赖注入时，通过递归调用容器的getBean方法得到当前依赖的Bean，同时也触发对依赖bean的创建和注入。在对bean的属性进行依赖注入时，解析过程也是一个递归过程，这样根据依赖关系，一层一层的完成Bean的创建和注入，直到当前bean相关的整个依赖链的注入完成。由于整个IoC容器启动过程较为复杂，使用下面的一张图来描述让读者更清楚厘清IoC容器的启动过程。</li>
</ul>
<p><img src="/Blog/static/image/20191125/BeanFactoryInitFlowChart.png" alt="Ioc容器启动过程"></p>
<h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><ul>
<li><p>代码位置:org.springframework.context.support.AbstractApplicationContext.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postProcessBeanFactory</span><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span> </span>&#123;<br>	<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>代码位置:org.springframework.context.support.AbstractApplicationContext.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><br></code></pre></td></tr></table></figure></li>
<li><p>代码位置:.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><br></code></pre></td></tr></table></figure></li>
<li><p>代码位置:.java</p>
<figure class="hljs highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li>Spring源码深度解析（第二版） 郝佳</li>
<li>Spring5企业级开发实战 周冠亚 黄文毅 <a target="_blank" rel="noopener" href="https://github.com/online-demo/spring5projectdemo">配套源码</a></li>
<li>Gitee同步版本：<a target="_blank" rel="noopener" href="https://gitee.com/ACANX/spring5projectdemo">https://gitee.com/ACANX/spring5projectdemo</a></li>
</ul>

    </main>
    <footer class="post-footer">
      
      <div class="post-tags">
        
        <a class="post-tag button" href="/Blog/tags/Spring/" rel="tag"><i class="fas fa-tags"></i>Spring</a>
        
        <a class="post-tag button" href="/Blog/tags/IOC/" rel="tag"><i class="fas fa-tags"></i>IOC</a>
        
        <a class="post-tag button" href="/Blog/tags/BeanFactory/" rel="tag"><i class="fas fa-tags"></i>BeanFactory</a>
        
        <a class="post-tag button" href="/Blog/tags/ApplicationContext/" rel="tag"><i class="fas fa-tags"></i>ApplicationContext</a>
        
      </div>
      
    </footer>
  </article>
  
  
  <nav class="page-nav">
    <div class="page-nav-next page-nav-item">
      
      <a href="/Blog/2018/09/22/MyBatis%E4%B8%ADJavaBean%20%E4%B8%8EMySQL%E7%9A%84table%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84/" rel="next" title="Markdown文章样式HTML"><i class="fas fa-angle-left"></i><span class="nav-title">Markdown文章样式HTML</span></a>
      
    </div>
    <div class="page-nav-prev page-nav-item">
      
      <a href="/Blog/2019/11/25/Java%E5%AD%A6%E4%B9%A0%E4%B9%8B23%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/" rel="prev" title="Java之23种设计模式深入理解"><span class="nav-title">Java之23种设计模式深入理解</span><i class="fas fa-angle-right"></i></a>
      
    </div>
  </nav>
  
  
</div>

          </div>
          
          
          
<aside class="sidebar" id="sidebar" style="background: url(/Blog/images/background.png);">
  
  <div class="search">
    <div class="form-group">
      <i class="fas fa-search"></i><input type="search" id="search-input" name="q" results="0" placeholder="Search" class="form-control"/>
    </div>
  </div>
  <div class="search-result-box" id="search-result"></div>
  
  
<div class="info sidebar-item" id="info">
  
  <img class="author-avatar" src="/Blog/images/avatar.png" alt="ACANX">
  
  <h1 class="author-name">ACANX</h1>
  <h2 class="author-description">面朝大海的静态博客 <a target="_blank" rel="noopener" href="https://blog.acanx.com">另一个博客</a></h2>
  <div class="site-count">
    
    
    
    
    
    
    
    
    
    
    
  </div>
  
  <div class="rss">
    <a class="rss-link button sidebar-item" href="/Blog/atom.xml"><i class="fas fa-rss"></i>RSS</a>
  </div>
  
</div>


  <div class="sidebar-sticky">
    
    
    
    
    
    <hr>
    <div class="post-toc sidebar-item" id="toc-div">
      <div><i class="fas fa-list-ol"></i>Table of Contents</div>
      <div class="post-toc-content"><ol class="list-group toc"><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#1-%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E7%B1%BB-%E6%8E%A5%E5%8F%A3"><span class="toc-text">1.几个重要类&#x2F;接口</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#%E9%98%85%E8%AF%BB%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87"><span class="toc-text">阅读前的准备</span></a></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#1-1-BeanFactory-%E9%A1%B6%E7%BA%A7%E6%8E%A5%E5%8F%A3%EF%BC%88%E4%BD%8E%E9%85%8D%E7%89%88%E7%9A%84IoC%E5%AE%B9%E5%99%A8%EF%BC%89"><span class="toc-text">1.1 BeanFactory 顶级接口（低配版的IoC容器）</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#BeanFactory%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E8%AF%B4%E6%98%8E"><span class="toc-text">BeanFactory接口定义说明</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#%E5%AE%8C%E6%95%B4%E7%89%88%E6%BA%90%E7%A0%81%EF%BC%9A"><span class="toc-text">完整版源码：</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#BeanFactory%E6%96%B9%E6%B3%95%E5%B1%9E%E6%80%A7%E6%91%98%E8%A6%81"><span class="toc-text">BeanFactory方法属性摘要</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#1-2-HierarchicalBeanFactory%E6%8E%A5%E5%8F%A3"><span class="toc-text">1.2 HierarchicalBeanFactory接口</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#%E5%AE%8C%E6%95%B4%E7%89%88%E6%BA%90%E7%A0%81%EF%BC%9A-1"><span class="toc-text">完整版源码：</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#HierarchicalBeanFactory%E6%96%B9%E6%B3%95%E5%B1%9E%E6%80%A7%E6%91%98%E8%A6%81"><span class="toc-text">HierarchicalBeanFactory方法属性摘要</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#1-3-ListableBeanFactory%E6%8E%A5%E5%8F%A3"><span class="toc-text">1.3 ListableBeanFactory接口</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#%E5%AE%8C%E6%95%B4%E7%89%88%E6%BA%90%E7%A0%81%EF%BC%9A-2"><span class="toc-text">完整版源码：</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#ListableBeanFactory%E6%96%B9%E6%B3%95%E5%B1%9E%E6%80%A7%E6%91%98%E8%A6%81"><span class="toc-text">ListableBeanFactory方法属性摘要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#1-4-ApplicationContext%E6%8E%A5%E5%8F%A3"><span class="toc-text">1.4 ApplicationContext接口</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#ApplicationContext%E6%8E%A5%E5%8F%A3%E8%A7%A3%E6%9E%90"><span class="toc-text">ApplicationContext接口解析</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#%E5%AE%8C%E6%95%B4%E7%89%88%E6%BA%90%E7%A0%81%EF%BC%9A-3"><span class="toc-text">完整版源码：</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#ApplicationContext%E6%96%B9%E6%B3%95%E5%B1%9E%E6%80%A7%E6%91%98%E8%A6%81"><span class="toc-text">ApplicationContext方法属性摘要</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#1-5-BeanDefination%E6%8E%A5%E5%8F%A3"><span class="toc-text">1.5 BeanDefination接口</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#BeanDefination%E6%8E%A5%E5%8F%A3%E5%AE%9A%E4%B9%89%E8%A7%A3%E6%9E%90"><span class="toc-text">BeanDefination接口定义解析</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#%E5%AE%8C%E6%95%B4%E7%89%88%E6%BA%90%E7%A0%81%EF%BC%9A-4"><span class="toc-text">完整版源码：</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#BeanDefination%E6%96%B9%E6%B3%95%E5%B1%9E%E6%80%A7%E6%91%98%E8%A6%81"><span class="toc-text">BeanDefination方法属性摘要</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#2-%E4%BB%8E%E4%B8%80%E4%B8%AADemo%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%A7%8B"><span class="toc-text">2.从一个Demo程序开始</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#2-1-Demo%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-text">2.1 Demo项目配置</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#maven%E7%9A%84pom-xml%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">maven的pom.xml配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#2-2-Demo%E7%A8%8B%E5%BA%8F"><span class="toc-text">2.2 Demo程序</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#2-2-1%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-text">2.2.1启动类</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#2-2-2%E4%BD%BF%E7%94%A8%E5%88%B0%E7%9A%84Bena%E5%AF%B9%E8%B1%A1"><span class="toc-text">2.2.2使用到的Bena对象</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#2-2-3-springContext%E7%9A%84xml%E6%96%87%E4%BB%B6ApplicationContextC-xml"><span class="toc-text">2.2.3 springContext的xml文件ApplicationContextC.xml</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#2-2-4-%E9%85%8D%E7%BD%AE%E6%97%A5%E5%BF%97-logback-xml%EF%BC%88resources%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B%EF%BC%89"><span class="toc-text">2.2.4 配置日志 logback.xml（resources文件夹下）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#3-Spring-IOC%E5%AE%B9%E5%99%A8%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-text">3.Spring IOC容器的创建</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#3-1-%E8%BF%9B%E5%85%A5FileSystemXmlApplicationContext%EF%BC%88AbstractXmlApplicationContext%E6%8A%BD%E8%B1%A1%E7%B1%BB%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%89"><span class="toc-text">3.1 进入FileSystemXmlApplicationContext（AbstractXmlApplicationContext抽象类的具体实现类）</span></a></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#3-2-%E5%88%9D%E5%A7%8B%E5%8C%96%E7%88%B6%E5%AE%B9%E5%99%A8AbstractApplicationContext"><span class="toc-text">3.2 初始化父容器AbstractApplicationContext</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#3-2-1-AbstractXmlApplicationContext%E6%8A%BD%E8%B1%A1%E7%B1%BB%EF%BC%88FileSystemXmlApplicationContext%E7%9A%84%E7%88%B6%E7%B1%BB%EF%BC%89"><span class="toc-text">3.2.1 AbstractXmlApplicationContext抽象类（FileSystemXmlApplicationContext的父类）</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#3-2-2-AbstractRefreshableConfigApplicationContext%E6%8A%BD%E8%B1%A1%E7%B1%BB%EF%BC%88-AbstractXmlApplicationContext%E7%9A%84%E7%88%B6%E7%B1%BB%EF%BC%89"><span class="toc-text">3.2.2 AbstractRefreshableConfigApplicationContext抽象类（ AbstractXmlApplicationContext的父类）</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#3-2-3-AbstractRefreshableApplicationContext%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-text">3.2.3 AbstractRefreshableApplicationContext抽象类</span></a></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#3-2-4-AbstractApplicationContext%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-text">3.2.4 AbstractApplicationContext抽象类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#3-5-PathMatchingResourcePatternResolver%E7%B1%BB"><span class="toc-text">3.5 PathMatchingResourcePatternResolver类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#4-setConfigLocations-String%E2%80%A6-locations-%E6%96%B9%E6%B3%95"><span class="toc-text">4.setConfigLocations(String… locations) 方法</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#4-1-AbstractRefreshableConfigApplicationContext-setConfigLocations-Nullable-String%E2%80%A6-locations-%E6%96%B9%E6%B3%95"><span class="toc-text">4.1 AbstractRefreshableConfigApplicationContext.setConfigLocations(@Nullable String… locations) 方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#5-refresh-%E6%96%B9%E6%B3%95"><span class="toc-text">5. refresh()方法</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#5-1-refresh-%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89"><span class="toc-text">5.1 refresh()方法定义</span></a></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#5-2-prepareRefresh-%E6%96%B9%E6%B3%95"><span class="toc-text">5.2 prepareRefresh()方法</span></a></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#5-3-obtainFreshBeanFactory-%E6%96%B9%E6%B3%95"><span class="toc-text">5.3 obtainFreshBeanFactory()方法</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#5-3-1-refreshBeanFactory-%E6%96%B9%E6%B3%95%E7%9A%84%E4%B8%80%E7%A7%8D%E5%AE%9E%E7%8E%B0"><span class="toc-text">5.3.1 refreshBeanFactory()方法的一种实现</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#AbstractApplicationContext%E4%B8%AD%E7%9A%84getInternalParentBeanFactory-%E6%96%B9%E6%B3%95"><span class="toc-text">AbstractApplicationContext中的getInternalParentBeanFactory()方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#DefaultListableBeanFactory%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-text">DefaultListableBeanFactory的构造方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#DefaultListableBeanFactory%E7%88%B6%E7%B1%BBAbstractAutowireCapableBeanFactory-%E6%8A%BD%E8%B1%A1%E7%B1%BB-%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-text">DefaultListableBeanFactory父类AbstractAutowireCapableBeanFactory(抽象类)的构造方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#AbstractRefreshableApplicationContext%E4%B8%AD%E7%9A%84customizeBeanFactory-beanFactory-%E6%96%B9%E6%B3%95"><span class="toc-text">AbstractRefreshableApplicationContext中的customizeBeanFactory(beanFactory)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#AbstractRefreshableApplicationContext%E4%B8%AD%E7%9A%84loadBeanDefinitions-beanFactory-%E6%96%B9%E6%B3%95"><span class="toc-text">AbstractRefreshableApplicationContext中的loadBeanDefinitions(beanFactory)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#org-springframework-context-support-AbstractXmlApplicationContext%E4%B8%AD%E7%9A%84loadBeanDefinitions-DefaultListableBeanFactory-beanFactory-%E6%96%B9%E6%B3%95"><span class="toc-text">org.springframework.context.support.AbstractXmlApplicationContext中的loadBeanDefinitions(DefaultListableBeanFactory beanFactory)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#new-XmlBeanDefinitionReader-beanFactory"><span class="toc-text">new XmlBeanDefinitionReader(beanFactory)</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#AbstractXmlApplicationContext%E6%8A%BD%E8%B1%A1%E7%B1%BB%E4%B8%AD%E7%9A%84initBeanDefinitionReader-beanDefinitionReader-%E6%96%B9%E6%B3%95"><span class="toc-text">AbstractXmlApplicationContext抽象类中的initBeanDefinitionReader(beanDefinitionReader)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#AbstractXmlApplicationContext%E6%8A%BD%E8%B1%A1%E7%B1%BB%E4%B8%AD%E7%9A%84loadBeanDefinitions-XmlBeanDefinitionReader-reader-%E6%96%B9%E6%B3%95"><span class="toc-text">AbstractXmlApplicationContext抽象类中的loadBeanDefinitions(XmlBeanDefinitionReader reader)方法</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-5"><a class="list-group-item toc-link" href="#reader-loadBeanDefinitions-configResources-%E6%96%B9%E6%B3%95%E4%B8%8Ereader-loadBeanDefinitions-configLocations-%E6%96%B9%E6%B3%95"><span class="toc-text">reader.loadBeanDefinitions(configResources)方法与reader.loadBeanDefinitions(configLocations)方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#count-loadBeanDefinitions-resource-%E4%B8%AD%E7%9A%84loadBeanDefinitions-resource-%E6%96%B9%E6%B3%95"><span class="toc-text">count +&#x3D; loadBeanDefinitions(resource)中的loadBeanDefinitions(resource)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#count-loadBeanDefinitions-location-%E4%B8%AD%E7%9A%84loadBeanDefinitions-location-%E6%96%B9%E6%B3%95"><span class="toc-text">count +&#x3D; loadBeanDefinitions(location)中的loadBeanDefinitions(location)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#XmlBeanDefinitionReader%E7%B1%BB%E4%B8%AD%E7%9A%84doLoadBeanDefinitions-InputSource-inputSource-Resource-resource-%E6%96%B9%E6%B3%95"><span class="toc-text">XmlBeanDefinitionReader类中的doLoadBeanDefinitions(InputSource inputSource, Resource resource)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#DefaultBeanDefinitionDocumentReader-registerBeanDefinitions-Document-doc-XmlReaderContext-readerContext"><span class="toc-text">DefaultBeanDefinitionDocumentReader.registerBeanDefinitions(Document doc, XmlReaderContext readerContext)</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#BeanDefinitionReaderUtils%E7%9A%84registerBeanDefinition-bdHolder-getReaderContext-getRegistry-%E6%96%B9%E6%B3%95"><span class="toc-text">BeanDefinitionReaderUtils的registerBeanDefinition(bdHolder, getReaderContext().getRegistry())方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#DefaultListableBeanFactory%E4%B8%ADregisterBeanDefinition-String-beanName-BeanDefinition-beanDefinition"><span class="toc-text">DefaultListableBeanFactory中registerBeanDefinition(String beanName, BeanDefinition beanDefinition)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#getBeanFactory-%E6%96%B9%E6%B3%95%E7%9A%84%E4%B8%80%E7%A7%8D%E5%AE%9E%E7%8E%B0"><span class="toc-text">getBeanFactory()方法的一种实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#6-prepareBeanFactory-beanFactory-%E6%96%B9%E6%B3%95"><span class="toc-text">6 prepareBeanFactory(beanFactory)方法</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#7-postProcessBeanFactory-ConfigurableListableBeanFactory-beanFactory"><span class="toc-text">7    postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory)</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#8-invokeBeanFactoryPostProcessors-beanFactory-%E6%96%B9%E6%B3%95"><span class="toc-text">8. invokeBeanFactoryPostProcessors(beanFactory)方法</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#9-registerBeanPostProcessors-beanFactory-%E6%96%B9%E6%B3%95"><span class="toc-text">9. registerBeanPostProcessors(beanFactory);方法</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#10-initMessageSource-%E6%96%B9%E6%B3%95"><span class="toc-text">10. initMessageSource();方法</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#11-initApplicationEventMulticaster-%E6%96%B9%E6%B3%95"><span class="toc-text">11. initApplicationEventMulticaster();方法</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#12-onRefresh-%E6%96%B9%E6%B3%95"><span class="toc-text">12. onRefresh();方法</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#13-registerListeners-%E6%96%B9%E6%B3%95"><span class="toc-text">13. registerListeners();方法</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#14-finishBeanFactoryInitialization-beanFactory-%E6%96%B9%E6%B3%95"><span class="toc-text">14. finishBeanFactoryInitialization(beanFactory);方法</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#DefaultListableBeanFactory%E4%B8%ADpreInstantiateSingletons-%E6%96%B9%E6%B3%95"><span class="toc-text">DefaultListableBeanFactory中preInstantiateSingletons()方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#preInstantiateSingletons-%E6%96%B9%E6%B3%95%E4%B8%AD%E8%B0%83%E7%94%A8%E7%9A%84getBean%E6%96%B9%E6%B3%95"><span class="toc-text">preInstantiateSingletons()方法中调用的getBean方法</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#AbstractAutowireCapableBeanFactory%E7%B1%BB%E4%B8%AD%E7%9A%84createBean-String-beanName-RootBeanDefinition-mbd-Nullable-Object-args-%E6%96%B9%E6%B3%95"><span class="toc-text">AbstractAutowireCapableBeanFactory类中的createBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#getInstantiationStrategy-%E6%96%B9%E6%B3%95%E7%9A%84%E8%BF%94%E5%9B%9E%E6%8E%A5%E5%8F%A3%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%AD%96%E7%95%A5%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0SimpleInstantiationStrategy"><span class="toc-text">getInstantiationStrategy()方法的返回接口对象的策略对象的一个实现SimpleInstantiationStrategy</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95BeanUtils-instantiateClass-constructorToUse-%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82"><span class="toc-text">静态方法BeanUtils.instantiateClass(constructorToUse)的实现细节</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#AbstractAutowireCapableBeanFactory%E6%8A%BD%E8%B1%A1%E7%B1%BB%E7%9A%84%E4%B8%ADdoCreateBean%E6%96%B9%E6%B3%95%E4%B8%AD%E8%B0%83%E7%94%A8%E7%9A%84populateBean-beanName-mbd-instanceWrapper-%E6%96%B9%E6%B3%95"><span class="toc-text">AbstractAutowireCapableBeanFactory抽象类的中doCreateBean方法中调用的populateBean(beanName, mbd, instanceWrapper)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#valueResolver-resolveValueIfNecessary-pv-originalValue-%E5%AF%B9%E5%BA%94%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text">valueResolver.resolveValueIfNecessary(pv, originalValue);对应的方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#AbstractPropertyAccessor%E7%9A%84setPropertyValues-PropertyValues-pvs-%E6%96%B9%E6%B3%95"><span class="toc-text">AbstractPropertyAccessor的setPropertyValues(PropertyValues pvs)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link" href="#AbstractNestablePropertyAccessor%E7%9A%84-setPropertyValue-PropertyValue-pv-%E6%96%B9%E6%B3%95"><span class="toc-text">AbstractNestablePropertyAccessor的 setPropertyValue(PropertyValue pv)方法</span></a></li><li class="toc-item toc-level-4"><a class="list-group-item toc-link"><span class="toc-text"></span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#15-finishRefresh-%E6%96%B9%E6%B3%95"><span class="toc-text">15. finishRefresh();方法</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#16refresh-%E8%BF%87%E7%A8%8B%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E6%97%B6"><span class="toc-text">16refresh()过程抛出异常时</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#16-1-destroyBeans-%E6%96%B9%E6%B3%95"><span class="toc-text">16.1 destroyBeans();方法</span></a></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#16-2-cancelRefresh-ex-%E6%96%B9%E6%B3%95"><span class="toc-text">16.2 cancelRefresh(ex);方法</span></a></li><li class="toc-item toc-level-2"><a class="list-group-item toc-link" href="#16-3%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8BeansException"><span class="toc-text">16.3抛出异常BeansException</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#17-resetCommonCaches-%E6%96%B9%E6%B3%95"><span class="toc-text">17 resetCommonCaches();方法</span></a></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a><ol class="list-group toc-child"><li class="toc-item toc-level-3"><a class="list-group-item toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-text">模板</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="list-group-item toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">参考资料</span></a></li></ol></div>
    </div>
    
    
    
    <hr>
    <div class="social-link sidebar-item">
      <div><i class="far fa-address-card"></i>Social Links</p></div>
      <ul>
        
        <li><i class="fas fa-envelope"></i><a href="mailto:acanx@qq.com" target="_blank">电子邮箱</a></li>
        
        <li><i class="fab fa-github"></i><a href="https://github.com/acxnx" target="_blank">GitHub</a></li>
        
        <li><i class="fab fa-weibo"></i><a href="https://weibo.com/acanx" target="_blank">微博</a></li>
        
        <li><i class="fab fa-blog"></i><a href="https://blog.acanx.com/" target="_blank">个人博客</a></li>
        
        <li><i class="fab fa-blog"></i><a href="https://my.oschina.net/Adven" target="_blank">开源中国</a></li>
        
      </ul>
    </div>
    
    
    <hr>
    <div class="blogroll sidebar-item">
      <div><i class="fas fa-link"></i>Blogroll</div>
      <ul>
        
        <li><i class="fas fa-link"></i><a href="https://github.com/acxnx" target="_blank">GitHub</a></li>
        
        <li><i class="fas fa-link"></i><a href="https://developer.mozilla.org/" target="_blank">MDN</a></li>
        
        <li><i class="fas fa-link"></i><a href="https://mozilla.github.io/nunjucks/" target="_blank">Nunjucks</a></li>
        
      </ul>
    </div>
    
  </div>
</aside>


          
        </div>
      </div>
    </main>
    
<footer id="footer" class="footer" style="background: #33363b;">
  <div class="container">
    <div class="back-to-top">
      <button id="back-to-top"><i class="fas fa-angle-double-up" aria-label="Back to Top"></i></button>
    </div>
    <div class="footer-container">
      <div class="footer-left">
        <div class="copyright">
          <span class="author">ACANX</span><span class="year"><i class="far fa-copyright"></i>2015 - 2021</span>
        </div>
        
        <div class="busuanzi">
          <span id="busuanzi_container_site_pv"><i class="fas fa-eye" aria-label="Site Visit Count" aria-hidden="false"></i><span id="busuanzi_value_site_pv"></span></span><span id="busuanzi_container_site_uv"><i class="fas fa-user" aria-label="Site User Count" aria-hidden="false"></i><span id="busuanzi_value_site_uv"></span></span><span id="busuanzi_container_page_pv"><i class="far fa-file-alt"></i><span id="busuanzi_value_page_pv" aria-label="Page Click Count" aria-hidden="false"></span></span>
        </div>
        
      </div>
      <div class="footer-right">
        <div class="custom-info">
          
          托管于<i class="fab fa-github-alt"></i><a href="https://pages.gitee.com/" target="_blank">Gitee Pages</a>
          
        </div>
        <div class="powered-by">
          Proudly Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> | Theme is <a href="https://github.com/AlynxZhou/hexo-theme-aria/" target="_blank">ARIA</a>
        </div>
      </div>
    </div>
  </div>
</footer>


  </body>
</html>
